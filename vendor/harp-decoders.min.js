!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=54)}([function(e,t){e.exports=THREE},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(58)),i(r(59)),i(r(63)),i(r(64)),i(r(65)),i(r(66)),i(r(67)),i(r(68)),i(r(69)),i(r(70)),i(r(71)),i(r(26)),i(r(72)),i(r(73))},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(23)),i(r(30)),i(r(24)),i(r(11)),i(r(16)),i(r(75)),i(r(76)),i(r(77)),i(r(36)),i(r(91)),i(r(108)),i(r(35))},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(12)),i(r(78)),i(r(4)),i(r(79)),i(r(80)),i(r(13)),i(r(37)),i(r(81)),i(r(10)),i(r(17)),i(r(38)),i(r(82)),i(r(39)),i(r(40)),i(r(18)),i(r(83)),i(r(41)),i(r(19)),i(r(42)),i(r(43)),i(r(14)),i(r(84)),i(r(85)),i(r(86)),i(r(87)),i(r(88)),i(r(8)),i(r(9)),i(r(5)),i(r(89)),i(r(90))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(0);class n{constructor(e,t,r){this.latitude=e,this.longitude=t,this.altitude=r}static fromDegrees(e,t,r){return new n(e,t,r)}static fromRadians(e,t,r){return new n(i.Math.radToDeg(e),i.Math.radToDeg(t),r)}static fromLatLng(e){return new n(e.lat,e.lng)}static fromGeoPoint(e){return new n(e[1],e[0],e[2])}get latitudeInRadians(){return i.Math.degToRad(this.latitude)}get longitudeInRadians(){return i.Math.degToRad(this.longitude)}get latitudeInDegrees(){return this.latitude}get longitudeInDegrees(){return this.longitude}get lat(){return this.latitude}get lng(){return this.longitude}isValid(){return!isNaN(this.latitude)&&!isNaN(this.longitude)}normalized(){let{latitude:e,longitude:t}=this;if(isNaN(e)||isNaN(t))return this;if(e>90){let r=(e+90)%360;r>=180&&(t+=180,r=360-r),e=r-90}if(e<-90){let r=(e-90)%360;r<=-180&&(t+=180,r=-360-r),e=r+90}if(t<-180||t>180){const e=Math.sign(t);t=(t%360+180*e)%360-180*e}return e===this.latitude&&t===this.longitude?this:new n(e,t,this.altitude)}equals(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude}copy(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this}clone(){return new n(this.latitude,this.longitude,this.altitude)}toLatLng(){return{lat:this.latitude,lng:this.longitude}}toGeoPoint(){return void 0!==this.altitude?[this.longitude,this.latitude,this.altitude]:[this.longitude,this.latitude]}}t.GeoCoordinates=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(0);!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function r(e,r){const i=(e=t(e))-(r=t(r));return i>180?i-360:i<=-180?i+360:i}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.newVector3=function(e,t,r,i){return void 0===i?{x:e,y:t,z:r}:(i.x=e,i.y=t,i.z=r,i)},e.degToRad=i.Math.degToRad,e.radToDeg=i.Math.radToDeg,e.clamp=i.Math.clamp,e.normalizeAngleDeg=t,e.angleDistanceDeg=r,e.interpolateAnglesDeg=function(e,t,i){return(e+r(t,e)*i)%360}}(t.MathUtils||(t.MathUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(92),n=r(105),o=r(11),s=r(16),a=r(24);!function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(106));const u=new i.ExprEvaluator;class l{constructor(){this.properties=new Set}}t.ExprDependencies=l;class c{static of(e){const t=new l;return e.accept(this.instance,t),t}visitNullLiteralExpr(e,t){}visitBooleanLiteralExpr(e,t){}visitNumberLiteralExpr(e,t){}visitStringLiteralExpr(e,t){}visitObjectLiteralExpr(e,t){}visitVarExpr(e,t){t.properties.add(e.name)}visitHasAttributeExpr(e,t){t.properties.add(e.name)}visitContainsExpr(e,t){e.value.accept(this,t)}visitCallExpr(e,t){"zoom"===e.op&&0===e.args.length?t.zoom=!0:e.args.forEach(e=>e.accept(this,t))}visitMatchExpr(e,t){e.value.accept(this,t),e.branches.forEach(([e,r])=>r.accept(this,t)),e.fallback.accept(this,t)}visitCaseExpr(e,t){e.branches.forEach(([e,r])=>{e.accept(this,t),r.accept(this,t)}),e.fallback.accept(this,t)}}function h(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]}var d;c.instance=new c,t.isJsonExpr=h,function(e){e[e.Value=0]="Value",e[e.Condition=1]="Condition"}(d=t.ExprScope||(t.ExprScope={}));class p{static parse(e){return new n.ExprParser(e).parse()}static fromJSON(e,t,r){const i=void 0!==t?{definitions:t,lockedNames:new Set,cache:r||new Map}:void 0;return p.parseNode(e,i)}static parseNode(e,t){if(Array.isArray(e))return p.parseCall(e,t);if(null===e)return g.instance;if("boolean"==typeof e)return new y(e);if("number"==typeof e)return new v(e);if("string"==typeof e)return new x(e);throw new Error(`failed to create expression from: ${JSON.stringify(e)}`)}static parseCall(e,t){const r=e[0];if("string"!=typeof r)throw new Error("expected a builtin function name");switch(r){case"!has":case"!in":return new _("!",[this.parseCall([r.slice(1),...e.slice(1)])]);case"ref":return p.resolveReference(e,t);case"get":return p.parseGetExpr(e,t);case"has":return p.parseHasExpr(e,t);case"in":return p.parseInExpr(e,t);case"literal":return p.parseLiteralExpr(e);case"match":return p.parseMatchExpr(e,t);case"case":return p.parseCaseExpr(e,t);default:return this.makeCallExpr(r,e,t)}}static parseGetExpr(e,t){if(void 0!==e[2])return p.makeCallExpr("get",e,t);const r=e[1];if("string"!=typeof r)throw new Error("expected the name of an attribute");return new f(r)}static parseHasExpr(e,t){if(void 0!==e[2])return p.makeCallExpr("has",e,t);const r=e[1];if("string"!=typeof r)throw new Error("expected the name of an attribute");return new w(r)}static parseInExpr(e,t){const r=e[2];if(!T.isValidElementsArray(r))throw new Error("'in' expects an array of number or string literals");return new T(this.parseNode(e[1],t),r)}static parseLiteralExpr(e){const t=e[1];if(null===t||"object"!=typeof t)throw new Error("expected an object or array literal");return new b(t)}static parseMatchExpr(e,t){if(e.length<4)throw new Error("not enough arguments");if(!(e.length%2))throw new Error("fallback is missing in 'match' expression");const r=this.parseNode(e[1],t),i=[];for(let r=2;r<e.length-1;r+=2){const n=e[r];if(!S.isValidMatchLabel(n))throw new Error(`'${JSON.stringify(n)}' is not a valid label for 'match'`);const o=this.parseNode(e[r+1],t);i.push([n,o])}const n=this.parseNode(e[e.length-1],t);return new S(r,i,n)}static parseCaseExpr(e,t){if(e.length<3)throw new Error("not enough arguments");if(e.length%2)throw new Error("fallback is missing in 'case' expression");const r=[];for(let i=1;i<e.length-1;i+=2){const n=this.parseNode(e[i],t),o=this.parseNode(e[i+1],t);r.push([n,o])}const i=this.parseNode(e[e.length-1],t);return new E(r,i)}static makeCallExpr(e,t,r){return new _(e,t.slice(1).map(e=>this.parseNode(e,r)))}static resolveReference(e,t){if("string"!=typeof e[1])throw new Error("expected the name of an attribute");if(void 0===t)throw new Error("ref used with no definitions");const r=e[1];if(t.lockedNames.has(r))throw new Error(`circular referene to '${r}'`);if(!(r in t.definitions))throw new Error(`definition '${r}' not found`);const i=t.cache.get(r);if(void 0!==i)return i;let n,u=t.definitions[r];if(a.isSelectorDefinition(u)&&(u=u.value),a.isValueDefinition(u)){if(o.isInterpolatedPropertyDefinition(u.value))return p.fromJSON(s.interpolatedPropertyDefinitionToJsonExpr(u.value));if(!h(u.value))return p.fromJSON(u.value);u=u.value}if(!h(u))throw new Error(`unsupported definition ${r}`);t.lockedNames.add(r);try{n=p.parseNode(u,t)}finally{t.lockedNames.delete(r)}return t.cache.set(r,n),n}evaluate(e,t=d.Value,r){return this.accept(u,new i.ExprEvaluatorContext(u,e,t,r))}dependencies(){return c.of(this)}intern(e){return e.add(this)}toJSON(){return(new M).serialize(this)}}t.Expr=p;class f extends p{constructor(e){super(),this.name=e}accept(e,t){return e.visitVarExpr(this,t)}}t.VarExpr=f;class m extends p{}t.LiteralExpr=m;class g extends p{constructor(){super(),this.value=null}accept(e,t){return e.visitNullLiteralExpr(this,t)}}t.NullLiteralExpr=g,g.instance=new g;class y extends m{constructor(e){super(),this.value=e}accept(e,t){return e.visitBooleanLiteralExpr(this,t)}}t.BooleanLiteralExpr=y;class v extends m{constructor(e){super(),this.value=e}accept(e,t){return e.visitNumberLiteralExpr(this,t)}}t.NumberLiteralExpr=v;class x extends m{constructor(e){super(),this.value=e}accept(e,t){return e.visitStringLiteralExpr(this,t)}}t.StringLiteralExpr=x;class b extends m{constructor(e){super(),this.value=e}get isArrayLiteral(){return Array.isArray(this.value)}accept(e,t){return e.visitObjectLiteralExpr(this,t)}}t.ObjectLiteralExpr=b;class w extends p{constructor(e){super(),this.name=e}accept(e,t){return e.visitHasAttributeExpr(this,t)}}t.HasAttributeExpr=w;class T extends p{constructor(e,t){super(),this.value=e,this.elements=t}static isValidElementsArray(e){if(!Array.isArray(e)||0===e.length)return!1;const t=typeof e[0];return("number"===t||"string"===t)&&e.every(e=>typeof e===t)}accept(e,t){return e.visitContainsExpr(this,t)}}t.ContainsExpr=T;class _ extends p{constructor(e,t){super(),this.op=e,this.args=t}get children(){return this.args}accept(e,t){return e.visitCallExpr(this,t)}}t.CallExpr=_;class S extends p{constructor(e,t,r){super(),this.value=e,this.branches=t,this.fallback=r}static isValidMatchLabel(e){switch(typeof e){case"number":case"string":return!0;case"object":if(!Array.isArray(e)||0===e.length)return!1;const t=typeof e[0];return("number"===t||"string"===t)&&e.every(e=>typeof e===t);default:return!1}}accept(e,t){return e.visitMatchExpr(this,t)}}t.MatchExpr=S;class E extends p{constructor(e,t){super(),this.branches=e,this.fallback=t}accept(e,t){return e.visitCaseExpr(this,t)}}t.CaseExpr=E;class M{serialize(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return["literal",e.value]}visitVarExpr(e,t){return["get",e.name]}visitHasAttributeExpr(e,t){return["has",e.name]}visitContainsExpr(e,t){return["in",this.serialize(e.value),e.elements]}visitCallExpr(e,t){return[e.op,...e.args.map(e=>this.serialize(e))]}visitMatchExpr(e,t){const r=[];for(const[t,i]of e.branches)r.push(t,this.serialize(i));return["match",this.serialize(e.value),...r,this.serialize(e.fallback)]}visitCaseExpr(e,t){const r=[];for(const[t,i]of e.branches)r.push(this.serialize(t),this.serialize(i));return["case",...r,this.serialize(e.fallback)]}}},function(e,t,r){"use strict";(function(e){var i=t;function n(e,t,r){for(var i=Object.keys(t),n=0;n<i.length;++n)void 0!==e[i[n]]&&r||(e[i[n]]=t[i[n]]);return e}function o(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&n(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}i.asPromise=r(125),i.base64=r(126),i.EventEmitter=r(127),i.float=r(128),i.inquire=r(129),i.utf8=r(130),i.pool=r(131),i.LongBits=r(132),i.global="undefined"!=typeof window&&window||void 0!==e&&e||"undefined"!=typeof self&&self||this,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isNode=Boolean(i.global.process&&i.global.process.versions&&i.global.process.versions.node),i.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},i.isString=function(e){return"string"==typeof e||e instanceof String},i.isObject=function(e){return e&&"object"==typeof e},i.isset=i.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},i.Buffer=function(){try{var e=i.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(e){return"number"==typeof e?i.Buffer?i._Buffer_allocUnsafe(e):new i.Array(e):i.Buffer?i._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},i.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(e){return e?i.LongBits.from(e).toHash():i.LongBits.zeroHash},i.longFromHash=function(e,t){var r=i.LongBits.fromHash(e);return i.Long?i.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},i.merge=n,i.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},i.newError=o,i.ProtocolError=o("ProtocolError"),i.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},i.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var e=i.Buffer;e?(i._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},i._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):i._Buffer_from=i._Buffer_allocUnsafe=null}}).call(this,r(124))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBox3Like=function(e){const t=e;return void 0!==t.min&&void 0!==t.max}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOrientedBox3Like=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis&&void 0!==t.extents}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(5);!function(e){e[e.Planar=0]="Planar",e[e.Spherical=1]="Spherical"}(t.ProjectionType||(t.ProjectionType={}));t.Projection=class{constructor(e){this.unitScale=e}localTangentSpace(e,t){return this.projectPoint(e,t.position),i.MathUtils.newVector3(1,0,0,t.xAxis),i.MathUtils.newVector3(0,1,0,t.yAxis),i.MathUtils.newVector3(0,0,1,t.zAxis),t}reprojectPoint(e,t,r){return e===this?void 0===r?{x:t.x,y:t.y,z:t.z}:(r.x=t.x,r.y=t.y,r.z=t.z,r):this.projectPoint(e.unprojectPoint(t),r)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),n=r(1),o=r(74),s=r(16),a=r(35),u=n.LoggerManager.instance.create("InterpolatedProperty"),l=[i.DiscreteInterpolant,i.LinearInterpolant,i.CubicInterpolant,o.ExponentialInterpolant],c=new i.Color;function h(e){return!!(e&&void 0===e.interpolationMode&&Array.isArray(e.values)&&e.values.length>0&&void 0!==e.values[0]&&Array.isArray(e.zoomLevels)&&e.zoomLevels.length>0&&void 0!==e.zoomLevels[0]&&e.values.length===e.zoomLevels.length)}function d(e){return void 0!==e&&void 0!==e.interpolationMode&&e.zoomLevels instanceof Float32Array&&void 0!==e.values&&e.values.length>0&&(e.zoomLevels.length===e.values.length/3||e.zoomLevels.length===e.values.length)}function p(e,t,r){const i=e.values.length/e.zoomLevels.length,n=new l[e.interpolationMode](e.zoomLevels,e.values,i);if(e.interpolationMode===s.InterpolationMode.Exponential&&void 0!==e.exponent&&(n.exponent=e.exponent),n.evaluate(t),void 0===e._stringEncodedNumeralDynamicMask)return n.resultBuffer[0];{const i=new l[e.interpolationMode](e.zoomLevels,e._stringEncodedNumeralDynamicMask,1);return e.interpolationMode===s.InterpolationMode.Exponential&&void 0!==e.exponent&&(i.exponent=e.exponent),i.evaluate(t),n.resultBuffer[0]*(1+i.resultBuffer[0]*(r-1))}}t.isInterpolatedPropertyDefinition=h,t.isInterpolatedProperty=d,t.getPropertyValue=function(e,t,r=1){if(h(e))throw new Error("Cannot interpolate a InterpolatedPropertyDefinition.");if(d(e)){if(void 0!==e._stringEncodedNumeralType)switch(e._stringEncodedNumeralType){case a.StringEncodedNumeralType.Meters:case a.StringEncodedNumeralType.Pixels:return p(e,t,r);case a.StringEncodedNumeralType.Hex:case a.StringEncodedNumeralType.RGB:case a.StringEncodedNumeralType.HSL:return function(e,t){const r=e.values.length/e.zoomLevels.length,i=new l[e.interpolationMode](e.zoomLevels,e.values,r);e.interpolationMode===s.InterpolationMode.Exponential&&void 0!==e.exponent&&(i.exponent=e.exponent);return i.evaluate(t),c.setHSL(i.resultBuffer[0],i.resultBuffer[1],i.resultBuffer[2]).getHex()}(e,t)}}else{if("string"!=typeof e)return e;{const t=a.StringEncodedNumeralFormats.find(t=>t.regExp.test(e));if(void 0===t)return e;switch(t.type){case a.StringEncodedNumeralType.Meters:return t.decoder(e)[0];case a.StringEncodedNumeralType.Pixels:return t.decoder(e)[0]*r;case a.StringEncodedNumeralType.Hex:case a.StringEncodedNumeralType.RGB:case a.StringEncodedNumeralType.HSL:const i=t.decoder(e);return c.setHSL(i[0],i[1],i[2]).getHex();default:return t.decoder(e)[0]}}}return p(e,t,r)},t.createInterpolatedProperty=function(e){!function(e){const t="Cubic"===e.interpolation;for(let r=0;r<e.values.length;++r){e.zoomLevels.findIndex(i=>t?Math.abs(i-e.zoomLevels[r])<.001:i===e.zoomLevels[r])!==r&&(e.zoomLevels.splice(--r,1),e.values.splice(--r,1))}}(e);const t=void 0!==e.interpolation?s.InterpolationMode[e.interpolation]:s.InterpolationMode.Discrete,r=new Float32Array(e.zoomLevels),i=e.values[0];switch(typeof i){default:case"number":case"boolean":return{interpolationMode:t,zoomLevels:r,values:new Float32Array(e.values),exponent:e.exponent};case"string":const n=a.StringEncodedNumeralFormats.find(e=>e.regExp.test(i));if(void 0===n)return t===s.InterpolationMode.Discrete?{interpolationMode:t,zoomLevels:r,values:e.values}:void u.error(`No StringEncodedNumeralFormat matched ${i}.`);let o=!1;const l=new Float32Array(e.values.length*n.size),c=new Float32Array(e.values.length);return o=function(e,t,r,i){let n=!1;const o=e.type===a.StringEncodedNumeralType.Meters||e.type===a.StringEncodedNumeralType.Pixels?m:f;for(let e=0;e<t.values.length;++e)for(const s of o){const o=t.values[e];if(!s.regExp.test(o))continue;void 0!==s.mask&&(i[e]=s.mask,n=!0);const a=s.decoder(o);for(let t=0;t<a.length;++t)r[e*s.size+t]=a[t];break}return n}(n,e,l,c),{interpolationMode:t,zoomLevels:r,values:l,exponent:e.exponent,_stringEncodedNumeralType:n.type,_stringEncodedNumeralDynamicMask:o?c:void 0}}};const f=[a.StringEncodedHSL,a.StringEncodedHex,a.StringEncodedRGB],m=[a.StringEncodedMeters,a.StringEncodedPixels]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),n=r(0);class o{constructor(e,t){this.southWest=e,this.northEast=t}static fromCoordinates(e,t){return new o(e,t)}get minAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)}get maxAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)}get south(){return this.southWest.latitude}get north(){return this.northEast.latitude}get west(){return this.southWest.longitude}get east(){return this.northEast.longitude}get center(){const e=.5*(this.south+this.north),{west:t,east:r}=this,{minAltitude:n,altitudeSpan:o}=this;let s;if(void 0!==n&&void 0!==o&&(s=n+.5*o),t<r)return new i.GeoCoordinates(e,.5*(t+r),s);let a=.5*(360+r+t);return a>360&&(a-=360),new i.GeoCoordinates(e,a,s)}get latitudeSpanInRadians(){return n.Math.degToRad(this.latitudeSpan)}get longitudeSpanInRadians(){return n.Math.degToRad(this.longitudeSpan)}get latitudeSpan(){return this.north-this.south}get altitudeSpan(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude}get longitudeSpan(){let e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e}get latitudeSpanInDegrees(){return this.latitudeSpan}get longitudeSpanInDegrees(){return this.longitudeSpan}contains(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);const t=this.minAltitude===this.maxAltitude,r=this.minAltitude===e.altitude,i=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!(t?!r:!i)&&this.containsHelper(e)}clone(){return new o(this.southWest,this.northEast)}growToContain(e){this.southWest.latitude=Math.min(this.southWest.latitude,e.latitude),this.southWest.longitude=Math.min(this.southWest.longitude,e.longitude),this.southWest.altitude=void 0!==this.southWest.altitude&&void 0!==e.altitude?Math.min(this.southWest.altitude,e.altitude):void 0!==this.southWest.altitude?this.southWest.altitude:void 0!==e.altitude?e.altitude:void 0,this.northEast.latitude=Math.max(this.northEast.latitude,e.latitude),this.northEast.longitude=Math.max(this.northEast.longitude,e.longitude),this.northEast.altitude=void 0!==this.northEast.altitude&&void 0!==e.altitude?Math.max(this.northEast.altitude,e.altitude):void 0!==this.northEast.altitude?this.northEast.altitude:void 0!==e.altitude?e.altitude:void 0}containsHelper(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;const{west:t,east:r}=this;return r>t?e.longitude>=t&&e.longitude<r:e.longitude>r||e.longitude<=t}}t.GeoBox=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{}t.EarthConstants=i,i.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,i.EQUATORIAL_RADIUS=6378137,i.MIN_ELEVATION=-433,i.MAX_ELEVATION=8848,i.MAX_BUILDING_HEIGHT=828},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(39),n=r(42),o=r(43);t.TilingScheme=class{constructor(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new i.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new o.TileTreeTraverse(e)}getSubTileKeys(e){return this.tileTreeTraverse.subTiles(e)}getTileKey(e,t){return n.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)}getTileKeys(e,t){return n.TileKeyUtils.geoRectangleToTileKeys(this,e,t)}getGeoBox(e){return this.boundingBoxGenerator.getGeoBox(e)}getWorldBox(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.tomTom=0]="tomTom"}(t.FeatureModifierId||(t.FeatureModifierId={})),function(e){let t;!function(e){e[e.Any=0]="Any",e[e.Match=1]="Match",e[e.StartsWith=2]="StartsWith",e[e.Contains=3]="Contains",e[e.EndsWith=4]="EndsWith"}(t=e.StringMatch||(e.StringMatch={})),e.matchString=function(t,r){switch(r.match){case e.StringMatch.Any:return!0;case e.StringMatch.Match:return t===r.value;case e.StringMatch.StartsWith:return r.value.startsWith(t);case e.StringMatch.EndsWith:return r.value.endsWith(t);default:return t.indexOf(r.value)>=0}}}(t.OmvFilterString||(t.OmvFilterString={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.POINT=1]="POINT",e[e.LINESTRING=2]="LINESTRING",e[e.POLYGON=3]="POLYGON"}(t.OmvGeometryType||(t.OmvGeometryType={})),t.OMV_TILE_DECODER_SERVICE_TYPE="omv-tile-decoder",t.OMV_TILER_SERVICE_TYPE="omv-tiler"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Discrete=0]="Discrete",e[e.Linear=1]="Linear",e[e.Cubic=2]="Cubic",e[e.Exponential=3]="Exponential"}(t.InterpolationMode||(t.InterpolationMode={})),t.interpolatedPropertyDefinitionToJsonExpr=function(e){if(void 0===e.interpolation||"Discrete"===e.interpolation){const t=["step",["zoom"],e.values[0]];for(let r=1;r<e.zoomLevels.length;++r)t.push(e.zoomLevels[r],e.values[r]);return t}const t=["interpolate"];switch(e.interpolation){case"Linear":t.push(["linear"]);break;case"Cubic":t.push(["cubic"]);break;case"Exponential":t.push(["exponential",void 0!==e.exponent?e.exponent:2]);break;default:throw new Error(`interpolation mode '${e.interpolation}' is not supported`)}t.push(["zoom"]);for(let r=0;r<e.zoomLevels.length;++r)t.push(e.zoomLevels[r],e.values[r]);return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(12),n=r(4),o=r(8),s=r(5),a=r(9),u=r(13),l=r(10);class c extends l.Projection{constructor(){super(...arguments),this.type=l.ProjectionType.Planar}static clamp(e,t,r){return Math.min(Math.max(t,e),r)}static latitudeClamp(e){return c.clamp(e,-h.MAXIMUM_LATITUDE,h.MAXIMUM_LATITUDE)}static latitudeProject(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI}static latitudeClampProject(e){return c.latitudeProject(c.latitudeClamp(e))}static unprojectLatitude(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI}getScaleFactor(e){return Math.cosh(2*Math.PI*(e.y/this.unitScale-.5))}worldExtent(e,t,r){return r||(r=s.MathUtils.newEmptyBox3()),r.min.x=0,r.min.y=0,r.min.z=e,r.max.x=this.unitScale,r.max.y=this.unitScale,r.max.z=t,r}projectPoint(e,t){let r;return r=e instanceof n.GeoCoordinates?e:new n.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(r.longitude+180)/360*this.unitScale,t.y=(.5*c.latitudeClampProject(r.latitudeInRadians)+.5)*this.unitScale,t.z=r.altitude||0,t}unprojectPoint(e){return n.GeoCoordinates.fromRadians(c.unprojectLatitude(2*(e.y/this.unitScale-.5)),e.x/this.unitScale*2*Math.PI-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){const r=this.projectPoint(e.center),i=(.5*c.latitudeClampProject(e.northEast.latitudeInRadians)+.5)*this.unitScale,n=(.5*c.latitudeClampProject(e.southWest.latitudeInRadians)+.5)*this.unitScale,u=.5*(i+n);r.y=u;const l=i-n,h=e.longitudeSpan/360*this.unitScale;if(t||(t=s.MathUtils.newEmptyBox3()),o.isBox3Like(t)){t.min.x=r.x-.5*h,t.min.y=r.y-.5*l,t.max.x=r.x+.5*h,t.max.y=r.y+.5*l;const i=e.altitudeSpan;void 0!==i?(t.min.z=r.z-.5*i,t.max.z=r.z+.5*i):(t.min.z=0,t.max.z=0)}else{if(!a.isOrientedBox3Like(t))throw new Error("invalid bounding box");s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,1,0,t.yAxis),s.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=r.x,t.position.y=r.y,t.position.z=r.z,t.extents.x=.5*h,t.extents.y=.5*l,t.extents.z=Math.max(Number.EPSILON,.5*(e.altitudeSpan||0))}return t}unprojectBox(e){const t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return i.GeoBox.fromCoordinates(t,r)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}reprojectPoint(e,r,i){return e===this||e!==t.webMercatorProjection&&e!==t.mercatorProjection?super.reprojectPoint(e,r,i):(void 0===i&&(i={}),i.x=r.x,i.y=this.unitScale-r.y,i.z=r.z,i)}}class h{}t.MercatorConstants=h,h.MAXIMUM_LATITUDE=1.4844222297453322,t.mercatorProjection=new c(u.EarthConstants.EQUATORIAL_CIRCUMFERENCE),t.webMercatorProjection=new class extends c{projectPoint(e,t){let r;r=e instanceof n.GeoCoordinates?e:new n.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(r.longitude+180)/360*this.unitScale;const i=Math.sin(c.latitudeClamp(r.latitudeInRadians));return t.y=(.5-Math.log((1+i)/(1-i))/(4*Math.PI))*this.unitScale,t.z=r.altitude||0,t}unprojectPoint(e){const t=e.x/this.unitScale-.5,r=.5-e.y/this.unitScale,i=360*t,o=90-360*Math.atan(Math.exp(2*-r*Math.PI))/Math.PI;return new n.GeoCoordinates(o,i,e.z)}projectBox(e,t){const r=super.projectBox(e,t);if(o.isBox3Like(r)){const e=r.max.y;r.max.y=this.unitScale-r.min.y,r.min.y=this.unitScale-e}else a.isOrientedBox3Like(r)&&(s.MathUtils.newVector3(1,0,0,r.xAxis),s.MathUtils.newVector3(0,-1,0,r.yAxis),s.MathUtils.newVector3(0,0,-1,r.zAxis),r.position.y=this.unitScale-r.position.y);return r}unprojectBox(e){const t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return new i.GeoBox(new n.GeoCoordinates(r.latitude,t.longitude,t.altitude),new n.GeoCoordinates(t.latitude,r.longitude,r.altitude))}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}localTangentSpace(e,t){return this.projectPoint(e,t.position),s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,-1,0,t.yAxis),s.MathUtils.newVector3(0,0,-1,t.zAxis),t}}(u.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.quadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(){return 2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 1<<e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];class n{constructor(e,t,r){this.row=e,this.column=t,this.level=r}static fromRowColumnLevel(e,t,r){return new n(e,t,r)}static fromQuadKey(e){const t=e.length;let r=0,i=0;for(let n=0;n<e.length;++n){const o=1<<n,s=parseInt(e.charAt(t-n-1),10);1&s&&(i|=o),2&s&&(r|=o)}return n.fromRowColumnLevel(r,i,t)}static fromMortonCode(e){let t=0,r=0,i=0,o=e;for(;o>1;){const e=1<<t;1&o&&(i|=e),2&o&&(r|=e),t++,o=(o-(3&o))/4}const s=n.fromRowColumnLevel(r,i,t);return s.m_mortonCode=e,s}static fromHereTile(e){const t=n.fromMortonCode(parseInt(e,10));return t.m_hereTile=e,t}static columnsAtLevel(e){return Math.pow(2,e)}static rowsAtLevel(e){return Math.pow(2,e)}static atCoords(e,t,r,i,o){return n.fromRowColumnLevel(Math.floor(r/(o/n.rowsAtLevel(e))),Math.floor(t/(i/n.columnsAtLevel(e))),e)}static parentMortonCode(e){return Math.floor(e/4)}parent(){if(0===this.level)throw new Error("Cannot get the parent of the root tile key");return n.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)}changedLevelBy(e){const t=Math.max(0,this.level+e);let r=this.row,i=this.column;return e>=0?(r<<=e,i<<=e):(r>>>=-e,i>>>=-e),n.fromRowColumnLevel(r,i,t)}changedLevelTo(e){return this.changedLevelBy(e-this.level)}mortonCode(){if(void 0===this.m_mortonCode){let e=this.column,t=this.row,r=i[this.level<<1];for(let n=0;n<this.level;++n)1&e&&(r+=i[2*n]),1&t&&(r+=i[2*n+1]),e>>>=1,t>>>=1;this.m_mortonCode=r}return this.m_mortonCode}toHereTile(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile}toQuadKey(){let e="";for(let t=this.level;t>0;--t){const r=1<<t-1,i=0!=(this.column&r),n=0!=(this.row&r);e+=i&&n?"3":n?"2":i?"1":"0"}return e}equals(e){return this.row===e.row&&this.column===e.column&&this.level===e.level}addedSubKey(e){const t=n.fromQuadKey(0===e.length?"-":e),r=this.changedLevelBy(t.level);return n.fromRowColumnLevel(r.row+t.row,r.column+t.column,r.level)}addedSubHereTile(e){const t=n.fromHereTile(e),r=this.changedLevelBy(t.level);return n.fromRowColumnLevel(r.row+t.row,r.column+t.column,r.level)}getSubHereTile(e){const t=1<<2*e;return(this.mortonCode()&t-1|t).toString()}rowCount(){return n.rowsAtLevel(this.level)}columnCount(){return n.columnsAtLevel(this.level)}}t.TileKey=n},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(44)),i(r(110)),i(r(111)),i(r(6)),i(r(112))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2),n=r(1).LoggerManager.instance.create("WorkerService",{enabled:!1});t.WorkerService=class{constructor(e){this.serviceId=e,this.m_pendingRequests=new Map,this.onMessage=e=>{if("string"==typeof e.data.service&&e.data.service===this.serviceId)try{if(i.WorkerServiceProtocol.isRequestMessage(e.data)){const t=e.data,r={service:t.service,messageId:t.messageId,responseSent:!1};this.m_pendingRequests.set(t.messageId,r),this.tryHandleRequest(t.request).then(e=>{this.doSendResponse(r,{service:this.serviceId,type:i.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,response:e.response},e.transferList)}).catch(e=>{this.doSendResponse(r,{service:this.serviceId,type:i.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,errorMessage:e.toString(),errorStack:e.stack})})}else this.tryHandleMessage(e.data)}catch(t){n.error(`[${this.serviceId}]: Unhandled exception when handling ${e.type}`)}},self.addEventListener("message",this.onMessage);const t={service:e,type:i.WorkerServiceProtocol.ServiceMessageName.Initialized};self.postMessage(t)}destroy(){this.cancelAllPendingRequests(),self.removeEventListener("message",this.onMessage)}handleMessage(e){n.error(`[${this.serviceId}]: Invalid message ${e.type}`)}handleRequest(e){throw new Error(`ServiceAdapter[${this.serviceId}]: Invalid request '${e.type}'`)}tryHandleMessage(e){try{this.handleMessage(e)}catch(t){n.error(`[${this.serviceId}]: Failed, handling message ${e.type}`)}}tryHandleRequest(e){try{return this.handleRequest(e)}catch(e){return n.error(`[${this.serviceId}]: Failure`,e),Promise.reject(e)}}doSendResponse(e,t,r){e.responseSent||(void 0!==r?self.postMessage(t,r):self.postMessage(t),e.responseSent=!0,this.m_pendingRequests.delete(e.messageId))}cancelAllPendingRequests(){this.m_pendingRequests.forEach(e=>{this.doSendResponse(e,{service:this.serviceId,type:i.WorkerServiceProtocol.ServiceMessageName.Response,messageId:e.messageId,errorMessage:"cancelled"})})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(3),n=r(0),o=r(50);function s(e,t,r=Math.floor){return r((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}function a(e,t){const{north:r,west:i}=t.geoBox,n=Math.log2(e),a=Math.pow(2,t.tileKey.level+n);return{extents:e,scale:a,top:s(r,t.tileKey.level+n,t.adapterId===o.VTJsonDataAdapterId?Math.round:Math.floor),left:(i+180)/360*a}}function u(e,t,r,n=!1,o){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=a(e,t));const{top:s,left:u,scale:l}=t.worldTileProjectionCookie,c=i.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return o.set((u+r.x)/l*c,(s+(n?-r.y:r.y))/l*c)}t.isArrayBufferLike=function(e){return"undefined"!=typeof SharedArrayBuffer?e instanceof ArrayBuffer||e instanceof SharedArrayBuffer:e instanceof ArrayBuffer},t.lat2tile=s,t.tile2lat=function(e,t){const r=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.createWorldTileTransformationCookie=a,t.tile2world=u,t.world2tile=function(e,t,r,n=!1,o){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=a(e,t));const{top:s,left:u,scale:l}=t.worldTileProjectionCookie,c=i.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return o.set(r.x/c*l-u,(n?-1:1)*(r.y/c*l-s))};const l=new n.Vector2;t.webMercatorTile2TargetWorld=function(e,t,r,n,o=!1){const s=u(e,t,r,o,l);n.set(s.x,s.y,0),t.targetProjection.reprojectPoint(i.webMercatorProjection,n,n).sub(t.center)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(30),n=r(31);t.TEXTURE_PROPERTY_KEYS=["map","normalMap","displacementMap","roughnessMap","emissiveMap","alphaMap","metalnessMap","bumpMap"],t.techniqueDescriptors={},t.baseTechniqueParamsDescriptor={attrScopes:{renderOrder:n.AttrScope.TechniqueGeometry,renderOrderOffset:n.AttrScope.TechniqueGeometry,enabled:n.AttrScope.TechniqueGeometry,kind:n.AttrScope.TechniqueGeometry,transient:n.AttrScope.TechniqueGeometry,fadeFar:n.AttrScope.TechniqueRendering,fadeNear:n.AttrScope.TechniqueRendering}},t.pointTechniquePropTypes=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{texture:n.AttrScope.TechniqueGeometry,enablePicking:n.AttrScope.TechniqueGeometry,color:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueGeometry}}),t.squaresTechniquePropTypes=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,t.pointTechniquePropTypes),t.techniqueDescriptors.squares=t.squaresTechniquePropTypes,t.circlesTechniquePropTypes=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,t.pointTechniquePropTypes),t.techniqueDescriptors.circles=t.circlesTechniquePropTypes;const o=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{text:n.AttrScope.FeatureGeometry,label:n.AttrScope.FeatureGeometry,useAbbreviation:n.AttrScope.FeatureGeometry,useIsoCode:n.AttrScope.FeatureGeometry,priority:n.AttrScope.TechniqueGeometry,textMinZoomLevel:n.AttrScope.TechniqueGeometry,textMaxZoomLevel:n.AttrScope.TechniqueGeometry,iconMinZoomLevel:n.AttrScope.TechniqueGeometry,iconMaxZoomLevel:n.AttrScope.TechniqueGeometry,distanceScale:n.AttrScope.TechniqueGeometry,textMayOverlap:n.AttrScope.TechniqueGeometry,iconMayOverlap:n.AttrScope.TechniqueGeometry,textReserveSpace:n.AttrScope.TechniqueGeometry,iconReserveSpace:n.AttrScope.TechniqueGeometry,renderTextDuringMovements:n.AttrScope.TechniqueGeometry,alwaysOnTop:n.AttrScope.TechniqueGeometry,textIsOptional:n.AttrScope.TechniqueGeometry,showOnMap:n.AttrScope.TechniqueGeometry,stackMode:n.AttrScope.TechniqueGeometry,minDistance:n.AttrScope.TechniqueGeometry,iconIsOptional:n.AttrScope.TechniqueGeometry,iconFadeTime:n.AttrScope.TechniqueGeometry,textFadeTime:n.AttrScope.TechniqueGeometry,xOffset:n.AttrScope.TechniqueGeometry,yOffset:n.AttrScope.TechniqueGeometry,iconXOffset:n.AttrScope.TechniqueGeometry,iconYOffset:n.AttrScope.TechniqueGeometry,iconScale:n.AttrScope.TechniqueGeometry,screenHeight:n.AttrScope.TechniqueGeometry,screenWidth:n.AttrScope.TechniqueGeometry,poiTable:n.AttrScope.TechniqueGeometry,poiName:n.AttrScope.FeatureGeometry,poiNameField:n.AttrScope.TechniqueGeometry,imageTexture:n.AttrScope.FeatureGeometry,imageTextureField:n.AttrScope.TechniqueGeometry,imageTexturePrefix:n.AttrScope.TechniqueGeometry,imageTexturePostfix:n.AttrScope.TechniqueGeometry,style:n.AttrScope.TechniqueGeometry,fontName:n.AttrScope.TechniqueGeometry,fontStyle:n.AttrScope.TechniqueGeometry,fontVariant:n.AttrScope.TechniqueGeometry,rotation:n.AttrScope.TechniqueGeometry,tracking:n.AttrScope.TechniqueGeometry,leading:n.AttrScope.TechniqueGeometry,maxLines:n.AttrScope.TechniqueGeometry,lineWidth:n.AttrScope.TechniqueGeometry,canvasRotation:n.AttrScope.TechniqueGeometry,lineRotation:n.AttrScope.TechniqueGeometry,wrappingMode:n.AttrScope.TechniqueGeometry,hAlignment:n.AttrScope.TechniqueGeometry,vAlignment:n.AttrScope.TechniqueGeometry,backgroundColor:n.AttrScope.TechniqueRendering,backgroundSize:n.AttrScope.TechniqueRendering,backgroundOpacity:n.AttrScope.TechniqueRendering,color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,size:n.AttrScope.TechniqueRendering}});t.techniqueDescriptors["line-marker"]=o,t.techniqueDescriptors["labeled-icon"]=o;const s={attrScopes:{polygonOffset:n.AttrScope.TechniqueRendering,polygonOffsetFactor:n.AttrScope.TechniqueRendering,polygonOffsetUnits:n.AttrScope.TechniqueRendering,lineColor:n.AttrScope.TechniqueRendering,lineFadeFar:n.AttrScope.TechniqueRendering,lineFadeNear:n.AttrScope.TechniqueRendering}};t.solidLineTechniqueDescriptor=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,s,{attrScopes:{clipping:n.AttrScope.TechniqueGeometry,secondaryRenderOrder:n.AttrScope.TechniqueGeometry,color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,lineWidth:n.AttrScope.TechniqueRendering,secondaryWidth:n.AttrScope.TechniqueRendering,secondaryColor:n.AttrScope.TechniqueRendering}}),t.techniqueDescriptors["solid-line"]=t.solidLineTechniqueDescriptor,t.dashedLineTechniqueDescriptor=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,s,{attrScopes:{color:n.AttrScope.TechniqueRendering,clipping:n.AttrScope.TechniqueGeometry,opacity:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,lineWidth:n.AttrScope.TechniqueRendering,dashSize:n.AttrScope.TechniqueRendering,gapSize:n.AttrScope.TechniqueRendering}}),t.techniqueDescriptors["dashed-line"]=t.dashedLineTechniqueDescriptor,t.lineTechniqueDescriptor=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,lineWidth:n.AttrScope.FeatureGeometry}}),t.techniqueDescriptors.line=t.lineTechniqueDescriptor;const a=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,s,{attrScopes:{color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,lineWidth:n.AttrScope.TechniqueRendering}});t.techniqueDescriptors.fill=a;const u=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{color:n.AttrScope.FeatureGeometry,vertexColors:n.AttrScope.FeatureGeometry,wireframe:n.AttrScope.TechniqueRendering,roughness:n.AttrScope.TechniqueRendering,metalness:n.AttrScope.TechniqueRendering,alphaTest:n.AttrScope.TechniqueRendering,depthTest:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,emissive:n.AttrScope.TechniqueRendering,emissiveIntensity:n.AttrScope.TechniqueRendering,refractionRatio:n.AttrScope.TechniqueRendering,map:n.AttrScope.TechniqueGeometry,mapProperties:n.AttrScope.TechniqueGeometry,normalMap:n.AttrScope.TechniqueGeometry,normalMapProperties:n.AttrScope.TechniqueGeometry,displacementMap:n.AttrScope.TechniqueGeometry,displacementMapProperties:n.AttrScope.TechniqueGeometry,roughnessMap:n.AttrScope.TechniqueGeometry,roughnessMapProperties:n.AttrScope.TechniqueGeometry,emissiveMap:n.AttrScope.TechniqueGeometry,emissiveMapProperties:n.AttrScope.TechniqueGeometry,bumpMap:n.AttrScope.TechniqueGeometry,bumpMapProperties:n.AttrScope.TechniqueGeometry,metalnessMap:n.AttrScope.TechniqueGeometry,metalnessMapProperties:n.AttrScope.TechniqueGeometry,alphaMap:n.AttrScope.TechniqueGeometry,alphaMapProperties:n.AttrScope.TechniqueGeometry}});t.techniqueDescriptors.standard=u;const l=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,u,{attrScopes:{height:n.AttrScope.FeatureGeometry,floorHeight:n.AttrScope.FeatureGeometry,color:n.AttrScope.FeatureGeometry,defaultColor:n.AttrScope.FeatureGeometry,defaultHeight:n.AttrScope.FeatureGeometry,constantHeight:n.AttrScope.FeatureGeometry,boundaryWalls:n.AttrScope.FeatureGeometry,footprint:n.AttrScope.FeatureGeometry,maxSlope:n.AttrScope.FeatureGeometry,enableDepthPrePass:n.AttrScope.TechniqueGeometry,animateExtrusionDuration:n.AttrScope.TechniqueGeometry,animateExtrusion:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,lineWidth:n.AttrScope.TechniqueRendering,lineFadeNear:n.AttrScope.TechniqueRendering,lineFadeFar:n.AttrScope.TechniqueRendering,lineColorMix:n.AttrScope.TechniqueGeometry,lineColor:n.AttrScope.TechniqueRendering}});t.techniqueDescriptors["extruded-polygon"]=l;const c=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{text:n.AttrScope.FeatureGeometry,label:n.AttrScope.FeatureGeometry,useAbbreviation:n.AttrScope.FeatureGeometry,useIsoCode:n.AttrScope.FeatureGeometry,minZoomLevel:n.AttrScope.TechniqueGeometry,maxZoomLevel:n.AttrScope.TechniqueGeometry,distanceScale:n.AttrScope.TechniqueGeometry,mayOverlap:n.AttrScope.TechniqueGeometry,reserveSpace:n.AttrScope.TechniqueGeometry,textFadeTime:n.AttrScope.TechniqueGeometry,xOffset:n.AttrScope.TechniqueGeometry,yOffset:n.AttrScope.TechniqueGeometry,style:n.AttrScope.TechniqueGeometry,fontName:n.AttrScope.TechniqueGeometry,fontStyle:n.AttrScope.TechniqueGeometry,fontVariant:n.AttrScope.TechniqueGeometry,rotation:n.AttrScope.TechniqueGeometry,tracking:n.AttrScope.TechniqueGeometry,leading:n.AttrScope.TechniqueGeometry,maxLines:n.AttrScope.TechniqueGeometry,lineWidth:n.AttrScope.TechniqueGeometry,canvasRotation:n.AttrScope.TechniqueGeometry,lineRotation:n.AttrScope.TechniqueGeometry,wrappingMode:n.AttrScope.TechniqueGeometry,hAlignment:n.AttrScope.TechniqueGeometry,vAlignment:n.AttrScope.TechniqueGeometry,backgroundColor:n.AttrScope.TechniqueRendering,backgroundSize:n.AttrScope.TechniqueRendering,backgroundOpacity:n.AttrScope.TechniqueRendering,color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,priority:n.AttrScope.TechniqueRendering,size:n.AttrScope.TechniqueRendering}});t.techniqueDescriptors.text=c;const h=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{primitive:n.AttrScope.TechniqueGeometry,params:n.AttrScope.TechniqueRendering}});function d(e){return"extruded-line"===e.name}function p(e){return d(e)&&"standard"===e.shading}function f(e){return"fill"===e.name}function m(e){return"extruded-polygon"===e.name}function g(e){return"standard"===e.name}function y(e){return"terrain"===e.name}t.techniqueDescriptors.shader=h,t.isCirclesTechnique=function(e){return"circles"===e.name},t.isSquaresTechnique=function(e){return"squares"===e.name},t.isPoiTechnique=function(e){return"labeled-icon"===e.name},t.isLineMarkerTechnique=function(e){return"line-marker"===e.name},t.isDashedLineTechnique=function(e){return"dashed-line"===e.name},t.isLineTechnique=function(e){return"line"===e.name},t.isSolidLineTechnique=function(e){return"solid-line"===e.name},t.isSegmentsTechnique=function(e){return"segments"===e.name},t.isExtrudedLineTechnique=d,t.isBasicExtrudedLineTechnique=function(e){return d(e)&&"basic"===e.shading},t.isStandardExtrudedLineTechnique=p,t.isFillTechnique=f,t.isExtrudedPolygonTechnique=m,t.isStandardTechnique=g,t.isTerrainTechnique=y,t.isTextTechnique=function(e){return"text"===e.name},t.isShaderTechnique=function(e){return"shader"===e.name},t.isLabelRejectionLineTechnique=function(e){return"label-rejection-line"===e.name},t.needsVertexNormals=function(e){return f(e)||g(e)||y(e)||p(e)},t.textureCoordinateType=function(e){return g(e)?e.textureCoordinateType:m(e)?e.textureCoordinateType:y(e)?e.textureCoordinateType:void 0},t.addBuffersToTransferList=function(e,r){if(g(e)||m(e)||y(e))for(const n of t.TEXTURE_PROPERTY_KEYS){const t=e[n];i.isTextureBuffer(t)&&t.buffer instanceof ArrayBuffer&&r.push(t.buffer)}},t.composeTechniqueTextureName=function(e,t){let r=e;return"string"==typeof t.imageTexturePrefix&&(r=t.imageTexturePrefix+r),"string"==typeof t.imageTexturePostfix&&(r+=t.imageTexturePostfix),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isValueDefinition=function(e){const t=e;return"object"==typeof t&&null!==t&&"string"==typeof t.type&&void 0!==t.value},t.isSelectorDefinition=function(e){const t=e;return"object"==typeof t&&null!==t&&"selector"===t.type&&("string"==typeof t.value||Array.isArray(t.value))},t.isJsonExprReference=function(e){return Array.isArray(e)&&2===e.length&&"ref"===e[0]&&"string"==typeof e[1]},t.isActualSelectorDefinition=function(e){const t=e;return"object"==typeof t&&null!==t&&!Array.isArray(t)&&"string"==typeof t.technique}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Log=2]="Log",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error"}(t.LogLevel||(t.LogLevel={}));t.LoggerOptions=class{}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveReferenceUri=function(e,t){if(i.test(t))return t;if(t.startsWith("/")){return o(e)+t}return t.startsWith("./")&&(t=t.substr(2)),n(e)+t};const i=new RegExp("^(?:[a-z]+:)?//","i");function n(e){if(void 0===e)return"./";let t=e.indexOf("?");return-1!==t&&(e=e.slice(0,t)),-1===(t=e.lastIndexOf("/"))?"./":e.substring(0,t+1)}function o(e){if(void 0===e)return"";const t=s(e);return"file:"===t.protocol?"file://":t.host&&t.protocol?t.protocol+"//"+t.host:t.host?"//"+t.host:t.protocol?t.protocol+"//":""}function s(e){const t=new RegExp(/^(?:([a-z]+:))?\/\/([^\/]*)/,"i"),r=e.match(t);if(!r)throw new Error(`getUrlHostAndProtocol: unable to parse URL '${e}'`);return{protocol:r[1],host:r[2]}}t.baseUrl=n,t.getUrlOrigin=o,t.getUrlHostAndProtocol=s},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(109)),i(r(46)),i(r(113)),i(r(21)),i(r(114)),i(r(47))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2),n=r(3),o=r(27),s=r(1),a=r(0),u=r(119),l=r(53),c=r(138),h=r(15),d=r(142),p=r(143),f=r(144),m=r(50),g=s.LoggerManager.instance.create("OmvDecoder",{enabled:!1});t.Ring=class{constructor(e,t,r){this.extents=e,this.vertexStride=t,this.contour=r,this.winding=this.area()<0}area(){const e=this.contour,t=this.vertexStride,r=e.length/t;let i=0;for(let n=r-1,o=0;o<r;n=o++)i+=e[n*t]*e[o*t+1]-e[o*t]*e[n*t+1];return i/2}};class y{constructor(e,t,r,i,n,o=!0,s=!1,a=!1,c=!0,h=0,d=!1,p){this.m_projection=e,this.m_styleSetEvaluator=t,this.m_showMissingTechniques=r,this.m_dataFilter=i,this.m_featureModifier=n,this.m_gatherFeatureIds=o,this.m_createTileInfo=s,this.m_gatherRoadSegments=a,this.m_skipShortLabels=c,this.m_storageLevelOffset=h,this.m_enableElevationOverlay=d,this.m_languages=p,this.m_dataAdapters=[];const y=new f.StyleSetDataFilter(t),v=i?new l.ComposedDataFilter([y,i]):y;this.m_dataAdapters.push(new u.OmvProtobufDataAdapter(this,v,g)),this.m_dataAdapters.push(new m.VTJsonDataAdapter(this,v,g))}get storageLevelOffset(){return this.m_storageLevelOffset}getDecodedTile(e,t){let r;for(const e of this.m_dataAdapters.values())if(e.canProcess(t)){r=e;break}if(void 0===r)return{techniques:[],geometries:[]};const i=this.estimatedTileSizeOnScreen(),n=new y.DecodeInfo(r.id,this.m_projection,e,i);if(this.m_decodedTileEmitter=new c.OmvDecodedTileEmitter(n,this.m_styleSetEvaluator,this.m_gatherFeatureIds,this.m_skipShortLabels,this.m_enableElevationOverlay,this.m_languages),this.m_createTileInfo){const e=!0;this.m_infoTileEmitter=new d.OmvTileInfoEmitter(n,this.m_styleSetEvaluator,e,this.m_gatherRoadSegments)}r.process(t,e,n.geoBox);const o=this.m_decodedTileEmitter.getDecodedTile();return this.m_createTileInfo&&(o.tileInfo=this.m_infoTileEmitter.getTileInfo()),o}getTileInfo(e,t){let r;for(const e of this.m_dataAdapters.values())if(e.canProcess(t)){r=e;break}if(void 0===r)return new i.ExtendedTileInfo(e,!1);const n=this.estimatedTileSizeOnScreen(),o=new y.DecodeInfo(r.id,this.m_projection,e,n);this.m_infoTileEmitter=new d.OmvTileInfoEmitter(o,this.m_styleSetEvaluator,!0,this.m_gatherRoadSegments);for(const r of this.m_dataAdapters.values())if(r.canProcess(t)){r.process(t,e,o.geoBox);break}return this.m_infoTileEmitter.getTileInfo()}processPointFeature(e,t,r,n,o){if(void 0!==this.m_featureModifier&&!this.m_featureModifier.doProcessPointFeature(e,n,o))return;const s=this.applyKindFilter(this.m_styleSetEvaluator.getMatchingTechniques(n,e,"point"),i.GeometryKind.Label);if(0===s.length)return void(this.m_showMissingTechniques&&g.log("OmvDecoder#processPointFeature: no techniques for object:",JSON.stringify(n.unmap())));const a={env:n,storageLevel:o,zoomLevel:this.getZoomLevel(o),cachedExprResults:this.m_styleSetEvaluator.expressionEvaluatorCache},u=n.lookup("$id");this.m_decodedTileEmitter&&this.m_decodedTileEmitter.processPointFeature(e,t,r,a,s,u),this.m_infoTileEmitter&&this.m_infoTileEmitter.processPointFeature(e,t,r,a,s,u)}processLineFeature(e,t,r,n,o){if(void 0!==this.m_featureModifier&&!this.m_featureModifier.doProcessLineFeature(e,n,o))return;const s=this.applyKindFilter(this.m_styleSetEvaluator.getMatchingTechniques(n,e,"line"),i.GeometryKind.Line);if(0===s.length)return void(this.m_showMissingTechniques&&g.log("OmvDecoder#processLineFeature: no techniques for object:",JSON.stringify(n.unmap())));const a={env:n,storageLevel:o,zoomLevel:this.getZoomLevel(o),cachedExprResults:this.m_styleSetEvaluator.expressionEvaluatorCache},u=n.lookup("$id");this.m_decodedTileEmitter&&this.m_decodedTileEmitter.processLineFeature(e,t,r,a,s,u),this.m_infoTileEmitter&&this.m_infoTileEmitter.processLineFeature(e,t,r,a,s,u)}processPolygonFeature(e,t,r,n,o){if(void 0!==this.m_featureModifier&&!this.m_featureModifier.doProcessPolygonFeature(e,n,o))return;const s=this.applyKindFilter(this.m_styleSetEvaluator.getMatchingTechniques(n,e,"polygon"),i.GeometryKind.Area);if(0===s.length)return void(this.m_showMissingTechniques&&g.log("OmvDecoder#processPolygonFeature: no techniques for object:",JSON.stringify(n.unmap())));const a={env:n,storageLevel:o,zoomLevel:this.getZoomLevel(o),cachedExprResults:this.m_styleSetEvaluator.expressionEvaluatorCache},u=n.lookup("$id");this.m_decodedTileEmitter&&this.m_decodedTileEmitter.processPolygonFeature(e,t,r,a,s,u),this.m_infoTileEmitter&&this.m_infoTileEmitter.processPolygonFeature(e,t,r,a,s,u)}estimatedTileSizeOnScreen(){return 256*Math.pow(2,-this.m_storageLevelOffset)}getZoomLevel(e){return Math.max(0,e-(this.m_storageLevelOffset||0))}applyKindFilter(e,t){return void 0!==this.m_dataFilter&&this.m_dataFilter.hasKindFilter&&(e=e.filter(e=>void 0===e.kind?this.m_dataFilter.wantsKind(t):this.m_dataFilter.wantsKind(e.kind))),e}}t.OmvDecoder=y,function(e){e.DecodeInfo=class{constructor(e,t,r,i){this.adapterId=e,this.targetProjection=t,this.tileKey=r,this.tileSizeOnScreen=i,this.projectedBoundingBox=new n.OrientedBox3,this.tileBounds=new a.Box3,this.tileSize=new a.Vector3,this.center=new a.Vector3,this.projectedTileBounds=new a.Box3,this.geoBox=this.tilingScheme.getGeoBox(r),this.targetProjection.projectBox(this.geoBox,this.projectedTileBounds),this.targetProjection.projectBox(this.geoBox,this.projectedBoundingBox),this.projectedBoundingBox.getCenter(this.center),this.tilingScheme.getWorldBox(r,this.tileBounds),this.tileBounds.getSize(this.tileSize)}get tilingScheme(){return n.webMercatorTilingScheme}get sourceProjection(){return this.tilingScheme.projection}}}(y=t.OmvDecoder||(t.OmvDecoder={}));class v extends o.ThemedTileDecoder{constructor(){super(...arguments),this.m_showMissingTechniques=!1,this.m_gatherFeatureIds=!0,this.m_createTileInfo=!1,this.m_gatherRoadSegments=!1,this.m_skipShortLabels=!0,this.m_enableElevationOverlay=!1}connect(){return Promise.resolve()}decodeThemedTile(e,t,r,i){const n=s.PerformanceTimer.now(),o=new y(i,r,this.m_showMissingTechniques,this.m_featureFilter,this.m_featureModifier,this.m_gatherFeatureIds,this.m_createTileInfo,this.m_gatherRoadSegments,this.m_skipShortLabels,this.m_storageLevelOffset,this.m_enableElevationOverlay,this.languages).getDecodedTile(t,e);return o.decodeTime=s.PerformanceTimer.now()-n,Promise.resolve(o)}getTileInfo(e,t,r){const i=s.PerformanceTimer.now(),n=this.m_styleSetEvaluator;if(void 0===n)return Promise.reject(new Error("no theme loaded"));const o=new y(r,n,this.m_showMissingTechniques,this.m_featureFilter,this.m_featureModifier,this.m_gatherFeatureIds,this.m_createTileInfo,this.m_gatherRoadSegments,this.m_skipShortLabels,this.m_storageLevelOffset,this.m_enableElevationOverlay,this.languages).getTileInfo(t,e);return o.setupTime=s.PerformanceTimer.now()-i,Promise.resolve(o)}configure(e,t,r,i){if(super.configure(e,t,r,i),i){const e=i;void 0!==e.showMissingTechniques&&(this.m_showMissingTechniques=!0===e.showMissingTechniques),e&&void 0!==e.filterDescription&&(null!==e.filterDescription?(this.m_featureFilter=new l.OmvGenericFeatureFilter(e.filterDescription),this.m_featureModifier=this.createFeatureModifier(e.filterDescription,e.featureModifierId)):(this.m_featureFilter=void 0,this.m_featureModifier=void 0)),void 0!==e.gatherFeatureIds&&(this.m_gatherFeatureIds=!0===e.gatherFeatureIds),void 0!==e.createTileInfo&&(this.m_createTileInfo=!0===e.createTileInfo),void 0!==e.gatherRoadSegments&&(this.m_gatherRoadSegments=!0===e.gatherRoadSegments),void 0!==e.skipShortLabels&&(this.m_skipShortLabels=e.skipShortLabels),void 0!==e.enableElevationOverlay&&(this.m_enableElevationOverlay=e.enableElevationOverlay)}void 0!==r&&(this.languages=r)}createFeatureModifier(e,t){return t===h.FeatureModifierId.tomTom?new p.OmvTomTomFeatureModifier(e):new l.OmvGenericFeatureModifier(e)}}t.OmvTileDecoder=v;class x{static start(){o.WorkerServiceManager.getInstance().register({serviceType:h.OMV_TILE_DECODER_SERVICE_TYPE,factory:e=>o.TileDecoderService.start(e,new v)})}}t.OmvTileDecoderService=x;t.default=class{constructor(){g.warn("OmvWorkerClient class is deprecated, please use OmvTileDecoderService.start"),x.start()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),self.THREE||console.warn("harp-decoders.js: It looks like 'Three.js' is not loaded. This script requires 'THREE' object to be defined. See https://github.com/heremaps/harp.gl/@here/harp.gl.");const i=r(56),n=r(118);n.OmvTilerService.start(),n.OmvTileDecoderService.start(),i.GeoJsonTileDecoderService.start()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.All="_all_",e.Background="background",e.Terrain="terrain",e.Area="area",e.Line="line",e.Water="water",e.Border="border",e.Road="road",e.Building="building",e.Label="label",e.Detail="detail"}(t.GeometryKind||(t.GeometryKind={}));t.GeometryKindSet=class extends Set{isSuperset(e){for(const t of e)if(!this.has(t))return!1;return!0}hasIntersection(e){for(const t of e)if(this.has(t))return!0;return!1}hasOrIntersects(e){return e instanceof Set?this.hasIntersection(e):this.has(e)}hasOrIntersectsArray(e){for(const t of e)if(this.has(t))return!0;return!1}},function(e){e.TileSpace="tile-space",e.EquirectangularSpace="equirectangular-space"}(t.TextureCoordinateType||(t.TextureCoordinateType={})),function(e){e.Show="show-in-stack",e.Hide="hide-in-stack",e.ShowParent="show-parent"}(t.PoiStackMode||(t.PoiStackMode={})),t.isTextureBuffer=function(e){return e&&e.buffer&&"string"==typeof e.type}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.FeatureGeometry=0]="FeatureGeometry",e[e.TechniqueGeometry=1]="TechniqueGeometry",e[e.TechniqueRendering=2]="TechniqueRendering"}(t.AttrScope||(t.AttrScope={})),t.mergeTechniqueDescriptor=function(...e){const t={attrScopes:{}};for(const r of e)void 0!==r.attrScopes&&(t.attrScopes=Object.assign(Object.assign({},t.attrScopes),r.attrScopes));return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ConsoleChannel=class{error(e,...t){console.error(e,...t)}debug(e,...t){console.debug(e,...t)}info(e,...t){console.info(e,...t)}log(e,...t){console.log(e,...t)}trace(e,...t){console.trace(e,...t)}warn(e,...t){console.warn(e,...t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(25);t.Logger=class{constructor(e,t,r){this.name=e,this.m_channel=t,this.enabled=!0,this.level=i.LogLevel.Trace,void 0!==r&&this.update(r)}error(e,...t){this.enabled&&this.level<=i.LogLevel.Error&&this.m_channel.error(this.prefix,e,...t)}debug(e,...t){this.enabled&&this.level<=i.LogLevel.Debug&&this.m_channel.debug(this.prefix,e,...t)}info(e,...t){this.enabled&&this.level<=i.LogLevel.Info&&this.m_channel.info(this.prefix,e,...t)}log(e,...t){this.enabled&&this.level<=i.LogLevel.Log&&this.m_channel.log(this.prefix,e,...t)}trace(e,...t){this.enabled&&this.level<=i.LogLevel.Trace&&this.m_channel.trace(this.prefix,e,...t)}warn(e,...t){this.enabled&&this.level<=i.LogLevel.Warn&&this.m_channel.warn(this.prefix,e,...t)}update(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level}get prefix(){return this.name+":"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(25);t.WORKERCHANNEL_MSG_TYPE="worker-channel-message";t.WorkerChannel=class{error(e,...r){const n={message:[e,...r],type:t.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Error};self.postMessage(n)}debug(e,...r){const n={message:[e,...r],type:t.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Debug};self.postMessage(n)}info(e,...r){const n={message:[e,...r],type:t.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Info};self.postMessage(n)}log(e,...r){const n={message:[e,...r],type:t.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Log};self.postMessage(n)}trace(e,...r){const n={message:[e,...r],type:t.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Trace};self.postMessage(n)}warn(e,...r){const n={message:[e,...r],type:t.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Warn};self.postMessage(n)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=new(r(0).Color),n={h:0,s:0,l:0};var o;!function(e){e[e.Meters=0]="Meters",e[e.Pixels=1]="Pixels",e[e.Hex=2]="Hex",e[e.RGB=3]="RGB",e[e.HSL=4]="HSL"}(o=t.StringEncodedNumeralType||(t.StringEncodedNumeralType={})),t.StringEncodedMeters={type:o.Meters,size:1,regExp:/((?=\.\d|\d)(?:\d+)?(?:\.?\d*))m/,decoder:e=>[Number(t.StringEncodedMeters.regExp.exec(e)[1])]},t.StringEncodedPixels={type:o.Pixels,size:1,mask:1,regExp:/((?=\.\d|\d)(?:\d+)?(?:\.?\d*))px/,decoder:e=>[Number(t.StringEncodedPixels.regExp.exec(e)[1])]},t.StringEncodedHex={type:o.Hex,size:3,regExp:/#([0-9A-Fa-f]{1,2})([0-9A-Fa-f]{1,2})([0-9A-Fa-f]{1,2})/,decoder:e=>(i.set(e).getHSL(n),[n.h,n.s,n.l])},t.StringEncodedRGB={type:o.RGB,size:3,regExp:/rgb\((?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5]), ?)(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5]), ?)(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5]))\)/,decoder:e=>{const r=t.StringEncodedRGB.regExp.exec(e);return i.setRGB(parseInt(r[1],10)/255,parseInt(r[2],10)/255,parseInt(r[3],10)/255).getHSL(n),[n.h,n.s,n.l]}},t.StringEncodedHSL={type:o.HSL,size:3,regExp:/hsl\(((?:[0-9]|[1-9][0-9]|1[0-9]{1,2}|2[0-9]{1,2}|3[0-5][0-9]|360)), ?(?:([0-9]|[1-9][0-9]|100)%), ?(?:([0-9]|[1-9][0-9]|100)%)\)/,decoder:e=>{const r=t.StringEncodedHSL.regExp.exec(e);return[parseInt(r[1],10)/360,parseInt(r[2],10)/100,parseInt(r[3],10)/100]}},t.StringEncodedNumeralFormats=[t.StringEncodedMeters,t.StringEncodedPixels,t.StringEncodedHex,t.StringEncodedRGB,t.StringEncodedHSL]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(3);t.getArrayConstructor=function(e){switch(e){case"float":return Float32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array}},function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.SolidLine=3]="SolidLine",e[e.Text=4]="Text",e[e.TextPath=5]="TextPath",e[e.ExtrudedLine=6]="ExtrudedLine",e[e.Polygon=7]="Polygon",e[e.ExtrudedPolygon=8]="ExtrudedPolygon",e[e.Object3D=9]="Object3D",e[e.Other=1e3]="Other"}(t.GeometryType||(t.GeometryType={})),t.getProjection=function(e){switch(e){case"mercator":return i.mercatorProjection;case"webMercator":return i.webMercatorProjection;case"sphere":return i.sphereProjection;case"normalizedEquirectangular":return i.normalizedEquirectangularProjection;case"equirectangular":return i.equirectangularProjection;default:throw new Error(`Unknown projection ${e}`)}},t.getProjectionName=function(e){if(e===i.mercatorProjection)return"mercator";if(e===i.webMercatorProjection)return"webMercator";if(e===i.sphereProjection)return"sphere";if(e===i.normalizedEquirectangularProjection)return"normalizedEquirectangular";if(e===i.equirectangularProjection)return"equirectangular";throw new Error("Unknown projection")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(12),n=r(4),o=r(8),s=r(5),a=r(9),u=r(13),l=r(10),c=r(0);class h extends l.Projection{constructor(){super(...arguments),this.type=l.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,r){return r||(r=s.MathUtils.newEmptyBox3()),r.min.x=0,r.min.y=0,r.min.z=e,r.max.x=this.unitScale,r.max.y=this.unitScale/2,r.max.z=t,r}projectPoint(e,t){return void 0===t&&(t={x:0,y:0,z:0}),t.x=(c.Math.degToRad(e.longitude)+Math.PI)*h.geoToWorldScale*this.unitScale,t.y=(c.Math.degToRad(e.latitude)+.5*Math.PI)*h.geoToWorldScale*this.unitScale,t.z=e.altitude||0,t}unprojectPoint(e){return n.GeoCoordinates.fromRadians(e.y*h.worldToGeoScale/this.unitScale-.5*Math.PI,e.x*h.worldToGeoScale/this.unitScale-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){const r=this.projectPoint(new n.GeoCoordinates(e.center.latitude,e.center.longitude,0)),{latitudeSpanInRadians:i,longitudeSpanInRadians:u,altitudeSpan:l}=e,c=u*h.geoToWorldScale,d=i*h.geoToWorldScale;return t||(t=s.MathUtils.newEmptyBox3()),o.isBox3Like(t)?(t.min.x=r.x-.5*c*this.unitScale,t.min.y=r.y-.5*d*this.unitScale,t.max.x=r.x+.5*c*this.unitScale,t.max.y=r.y+.5*d*this.unitScale,void 0!==l?(t.min.z=r.z-.5*l,t.max.z=r.z+.5*l):(t.min.z=0,t.max.z=0)):a.isOrientedBox3Like(t)&&(s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,1,0,t.yAxis),s.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=r.x,t.position.y=r.y,t.position.z=r.z,t.extents.x=.5*c*this.unitScale,t.extents.y=.5*d*this.unitScale,t.extents.z=Math.max(Number.EPSILON,.5*(l||0))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return i.GeoBox.fromCoordinates(t,r)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}h.geoToWorldScale=1/(2*Math.PI),h.worldToGeoScale=2*Math.PI/1,t.normalizedEquirectangularProjection=new h(1),t.equirectangularProjection=new h(u.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(12),n=r(4),o=r(8),s=r(5),a=r(9),u=r(13),l=r(10);class c extends l.Projection{constructor(e){super(e),this.unitScale=e,this.type=l.ProjectionType.Planar,this.m_phi0=0,this.m_lambda0=0}static clampGeoPoint(e,t){const r=e.latitude,i=e.longitude,o=h.POLE_RADIUS,s=h.POLE_RADIUS_SQ,a=Math.round(i/90),u=90*a-i;if(a%2==0||Math.abs(u)>o)return e;const l=r-0,c=u*u+l*l;if(c<s){const e=Math.sqrt(c),t=(o-e)/e,s=1,a=0===u&&0===l?o*s:u;return new n.GeoCoordinates(r+l*t,i+a*t)}return e}getScaleFactor(e){return Math.cosh(2*(e.x/this.unitScale-.5)*Math.PI)}worldExtent(e,t,r){return r||(r=s.MathUtils.newEmptyBox3()),r.min.x=0,r.min.y=0,r.min.z=e,r.max.x=this.unitScale,r.max.y=this.unitScale,r.max.z=t,r}projectPoint(e,t){t||(t={x:0,y:0,z:0});const r=c.clampGeoPoint(e,this.unitScale),i=r.longitude/360+.5,n=1===i?0:Math.floor(i),o=s.MathUtils.degToRad(r.latitude),a=s.MathUtils.degToRad(r.longitude-360*n)-this.m_lambda0,u=Math.cos(o)*Math.sin(a);t.x=Math.atanh(u),t.y=Math.atan2(Math.tan(o),Math.cos(a))-this.m_phi0;const l=.5/Math.PI;return t.x=this.unitScale*(s.MathUtils.clamp(t.x*l+.5,0,1)+n),t.y=this.unitScale*s.MathUtils.clamp(t.y*l+.5,0,1),t.z=e.altitude||0,t}unprojectPoint(e){const t=2*Math.PI,r=e.x/this.unitScale,i=e.y/this.unitScale,o=1===r?0:Math.floor(r),s=t*(r-.5-o),a=t*(i-.5),u=e.z||0,l=a+this.m_phi0,c=Math.asin(Math.sin(l)/Math.cosh(s)),h=this.m_lambda0+Math.atan2(Math.sinh(s),Math.cos(l))+o*t;return n.GeoCoordinates.fromRadians(c,h,u)}projectBox(e,t){const{north:r,south:i,east:u,west:l}=e,c=[e.center,e.northEast,e.southWest,new n.GeoCoordinates(i,u),new n.GeoCoordinates(r,l)],d=h.POLE_EDGE_DEG,p=l<90&&u>90,f=l<0&&u>0,m=l<d&&u>-d&&r>0&&i<0;l<-90&&u>-90&&(c.push(new n.GeoCoordinates(r,-90)),c.push(new n.GeoCoordinates(i,-90))),p&&(c.push(new n.GeoCoordinates(r,90)),c.push(new n.GeoCoordinates(i,90))),f&&(c.push(new n.GeoCoordinates(r,0)),c.push(new n.GeoCoordinates(i,0))),m&&(c.push(new n.GeoCoordinates(0,l)),c.push(new n.GeoCoordinates(0,u))),h.alignLatitude(c,c[0]);const g=c.map(e=>this.projectPoint(e)),y=g.map(e=>e.x),v=g.map(e=>e.y),x=g.map(e=>e.z),b=Math.min(...y),w=Math.min(...v),T=Math.min(...x),_=Math.max(...y),S=Math.max(...v),E=Math.max(...x);if(t||(t=s.MathUtils.newEmptyBox3()),o.isBox3Like(t))t.min.x=b,t.min.y=w,t.min.z=T,t.max.x=_,t.max.y=S,t.max.z=E;else{if(!a.isOrientedBox3Like(t))throw new Error("invalid bounding box");s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,1,0,t.yAxis),s.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=(b+_)/2,t.position.y=(w+S)/2,t.position.z=(T+E)/2,t.extents.x=(_-b)/2,t.extents.y=(S-w)/2,t.extents.z=(E-T)/2}return t}unprojectBox(e){const t=this.unitScale,r=e.min,o=e.max,s=[{x:(r.x+o.x)/2,y:(r.y+o.y)/2,z:0},r,o,{x:r.x,y:o.y,z:0},{x:o.x,y:r.y,z:0}],a=.5*t,u=.25*t,l=.75*t,c=r.x<a&&o.x>a,d=r.y<a&&o.y>a,p=r.y<u&&o.y>u,f=r.y<l&&o.y>l;d&&(s.push({x:r.x,y:a,z:0}),s.push({x:o.x,y:a,z:0}),c&&s.push({x:a,y:a,z:0})),p&&(s.push({x:r.x,y:u,z:0}),s.push({x:o.x,y:u,z:0}),c&&s.push({x:a,y:u,z:0})),f&&(s.push({x:r.x,y:l,z:0}),s.push({x:o.x,y:l,z:0}),c&&s.push({x:a,y:l,z:0}));const m=s.map(e=>this.unprojectPoint(e));h.alignLongitude(m,m[0]);const g=m.map(e=>e.latitude),y=m.filter(e=>Math.abs(e.latitude)<90).map(e=>e.longitude),v=m.map(e=>e.altitude||0),x=new n.GeoCoordinates(Math.min(...g),Math.min(...y),Math.min(...v)),b=new n.GeoCoordinates(Math.max(...g),Math.max(...y),Math.max(...v));return i.GeoBox.fromCoordinates(x,b)}unprojectAltitude(e){return e.z}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}}class h{static alignLatitude(e,t){for(const r of e)0===r.latitude&&(r.latitude=1e-9*t.latitude)}static alignLongitude(e,t){const r=t.longitude<0?180:-180,i=t.longitude<0?-180:180;for(const t of e)t.longitude===r&&(t.longitude=i)}}t.TransverseMercatorUtils=h,h.POLE_EDGE=1.4844222297453322,h.POLE_EDGE_DEG=s.MathUtils.radToDeg(h.POLE_EDGE),h.POLE_RADIUS=90-h.POLE_EDGE_DEG,h.POLE_RADIUS_SQ=Math.pow(h.POLE_RADIUS,2),t.transverseMercatorProjection=new c(u.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(5);t.FlatTileBoundingBoxGenerator=class{constructor(e,t=0,r=0){this.tilingScheme=e,this.minElevation=t,this.maxElevation=r,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,r);const{min:i,max:n}=this.m_worldBox;this.m_worldDimensions={x:n.x-i.x,y:n.y-i.y,z:n.z-i.z}}get projection(){return this.m_tilingScheme.projection}get subdivisionScheme(){return this.m_tilingScheme.subdivisionScheme}getWorldBox(e,t){const r=e.level,n=this.subdivisionScheme.getLevelDimensionX(r),o=this.subdivisionScheme.getLevelDimensionY(r),s=this.m_worldDimensions.x/n,a=this.m_worldDimensions.y/o,u=this.m_worldBox.min.x+s*e.column,l=this.m_worldBox.min.y+a*e.row;return t||(t=i.MathUtils.newEmptyBox3()),t.min.x=u,t.min.y=l,t.min.z=this.m_worldBox.min.z,t.max.x=u+s,t.max.y=l+a,t.max.z=this.m_worldBox.max.z,t}getGeoBox(e){const t=this.getWorldBox(e);return this.projection.unprojectBox(t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.halfQuadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(e){return 0===e?1:2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 0!==e?1<<e-1:1}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(19);class n{constructor(e,t,r){this.tileKey=e,this.sizeX=t,this.sizeY=r}[Symbol.iterator](){return 2===this.sizeX&&2===this.sizeY?n.ZCurveIterator(this.tileKey):n.RowColumnIterator(this.tileKey,this.sizeX,this.sizeY)}}t.SubTiles=n,function(e){e.RowColumnIterator=function*(e,t,r){for(let n=0;n<r;n++)for(let o=0;o<t;o++)yield i.TileKey.fromRowColumnLevel(e.row*r+n,e.column*t+o,e.level+1)},e.ZCurveIterator=function*(e){for(let t=0;t<4;t++)yield i.TileKey.fromRowColumnLevel(e.row<<1|t>>1,e.column<<1|1&t,e.level+1)}}(n=t.SubTiles||(t.SubTiles={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),n=r(19);class o{static geoCoordinatesToTileKey(e,t,r){const i=e.projection.projectPoint(t);return this.worldCoordinatesToTileKey(e,i,r)}static worldCoordinatesToTileKey(e,t,r){const i=e.projection,o=e.subdivisionScheme,s=o.getLevelDimensionX(r),a=o.getLevelDimensionY(r),{min:u,max:l}=i.worldExtent(0,0),c=l.x-u.x,h=l.y-u.y;if(t.x<u.x||t.x>l.x)return null;if(t.y<u.y||t.y>l.y)return null;const d=Math.min(s-1,Math.floor(s*(t.x-u.x)/c)),p=Math.min(a-1,Math.floor(a*(t.y-u.y)/h));return n.TileKey.fromRowColumnLevel(p,d,r)}static geoRectangleToTileKeys(e,t,r){const s=(e,t,r)=>e<t?r-(t-e)%(r-t):t+(e-t)%(r-t),a=(e,t,r)=>Math.min(Math.max(e,t),r),u=s(t.southWest.longitudeInRadians,-Math.PI,Math.PI),l=a(t.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),c=s(t.northEast.longitudeInRadians,-Math.PI,Math.PI),h=a(t.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),d=o.geoCoordinatesToTileKey(e,i.GeoCoordinates.fromRadians(l,u),r),p=o.geoCoordinatesToTileKey(e,i.GeoCoordinates.fromRadians(h,c),r),f=e.subdivisionScheme.getLevelDimensionX(r);if(!d||!p)throw new Error("Invalid coordinates");const m=d.column;let g=p.column;u>c&&(g+=g!==m?f:f-1);const y=Math.min(d.row,p.row),v=Math.max(d.row,p.row),x=new Array;for(let e=y;e<=v;++e)for(let t=m;t<=g;++t)x.push(n.TileKey.fromRowColumnLevel(e,t%f,r));return x}}t.TileKeyUtils=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(41);t.TileTreeTraverse=class{constructor(e){this.m_subdivisionScheme=e}subTiles(e){const t=this.m_subdivisionScheme.getSubdivisionX(e.level),r=this.m_subdivisionScheme.getSubdivisionY(e.level);return new i.SubTiles(e,t,r)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),n=r(6),o=r(107),s=r(11),a=r(16),u=r(31),l=r(23),c=r(24),h=i.LoggerManager.instance.create("StyleSetEvaluator"),d=u.mergeTechniqueDescriptor({});class p{classify(e){if(e._whenExpr){const t=this.switchStyle(e);e._whenExpr=e._whenExpr.accept(this,void 0),this._style=t}}visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){return e}visitHasAttributeExpr(e,t){return e}visitContainsExpr(e,t){return e}visitMatchExpr(e,t){return e}visitCaseExpr(e,t){return e}visitCallExpr(e,t){if("all"===e.op){const t=e.args.map(t=>t.accept(this,e)).filter(e=>void 0!==e);return new n.CallExpr(e.op,t)}if(t){const t=this.matchVarStringComparison(e);if(t){if(void 0===this._style.layer&&"$layer"===t.name)return void(this._style.layer=t.value);if(void 0===this._style._geometryType&&"$geometryType"===t.name)return void(this._style._geometryType=t.value)}}return e}matchVarStringComparison(e){if("=="===e.op){const t=e.args[0],r=e.args[1];if(t instanceof n.VarExpr&&r instanceof n.StringLiteralExpr)return{name:t.name,value:r.value};if(r instanceof n.VarExpr&&t instanceof n.StringLiteralExpr)return{name:r.name,value:t.value}}}switchStyle(e){const t=this._style;return this._style=e,t}}class f{constructor(e,t){this.key="",this.set(e,t)}set(e,t,r){let i=!1;if(void 0===e){const t=void 0!==r?r.lookup("$layer"):void 0;e="string"==typeof t?t:void 0}if(this.layer!==e&&(this.layer=e,i=!0),void 0===t){const e=void 0!==r?r.lookup("$geometryType"):void 0;t="string"==typeof e?e:void 0}return this.geometryType!==t&&(this.geometryType=t,i=!0),i&&this.updateKey(),this}updateKey(){void 0!==this.layer?void 0!==this.geometryType?this.key=`${this.layer}:${this.geometryType}`:this.key=`${this.layer}:`:void 0!==this.geometryType?this.key=`:${this.geometryType}`:this.key="all",this.cachedStyleSet=void 0}}function m(e,t){if(void 0!==e.renderOrderBiasGroup){const r=e.renderOrderBiasGroup?t.renderOrderBiasGroups.get(e.renderOrderBiasGroup):void 0;if(void 0!==e.renderOrderBiasRange&&void 0===r){void 0!==e.renderOrder&&h.warn("WARN: style.renderOrder will be overridden if renderOrderBiasGroup is set:",e);const[r,i]=e.renderOrderBiasRange;e.renderOrder=r<0?t.techniqueRenderOrder+Math.abs(r):t.techniqueRenderOrder,t.techniqueRenderOrder+=Math.abs(r)+i,e.renderOrderBiasGroup&&t.renderOrderBiasGroups.set(e.renderOrderBiasGroup,e.renderOrder),t.techniqueRenderOrder++}else r&&(void 0!==e.renderOrder&&h.warn("WARN: style.renderOrder will be overridden if renderOrderBiasGroup is set:",e),e.renderOrder=r)}if(void 0!==e.styles)for(const r of e.styles)m(r,t);else e._styleSetIndex=t.styleSetIndex++,void 0!==e.technique&&void 0===e.renderOrder&&(e.renderOrder=t.techniqueRenderOrder++)}function g(e){const t={};for(const r in e){if(!e.hasOwnProperty(r))continue;const i=e[r];i instanceof n.Expr||(t[r]=i)}return t}t.StyleSetEvaluator=class{constructor(e,t){this.m_techniques=[],this.m_exprPool=new o.ExprPool,this.m_cachedResults=new Map,this.m_styleConditionClassifier=new p,this.m_subStyleSetCache=new Map,this.m_definitionExprCache=new Map,this.m_tmpOptimizedSubSetKey=new f,this.m_emptyEnv=new n.Env,this.m_definitions=t,this.styleSet=function(e,t){return e.map(e=>(function e(t,r){if(n.isJsonExpr(t)){if(!c.isJsonExprReference(t))throw new Error("invalid expression in this context, only 'ref's are supported");const i=t[1],n=r&&r[i];if(!n)throw new Error(`invalid reference '${i}' - not found`);if(!c.isActualSelectorDefinition(n))throw new Error(`invalid reference '${i}' - expected style definition`);return e(n,r)}const i=t.styles&&t.styles.map(t=>e(t,r)).filter(e=>void 0!==e);return Object.assign(Object.assign({},t),{styles:i})})(e,t))}(e,t),function(e){const t={techniqueRenderOrder:0,styleSetIndex:0,renderOrderBiasGroups:new Map};for(const r of e)m(r,t)}(this.styleSet),this.compileStyleSet()}getMatchingTechniques(e,t,r){const i=[],n=new Array;this.m_cachedResults.clear();const o=this.m_tmpOptimizedSubSetKey;o.set(t,r,e);const s=o.layer,a=o.geometryType,u=this.getOptimizedStyleSet(o),l=this.changeLayer("string"==typeof s?s:void 0),c=this.changeGeometryType("string"==typeof a?a:void 0);for(const t of u){if(0!==n.length)throw this.changeLayer(l),this.changeGeometryType(c),new Error("Internal error: style stack cleanup failed");if(this.processStyle(e,n,t,i))break}return this.changeLayer(l),this.changeGeometryType(c),i}wantsLayer(e){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,void 0)).length>0}wantsFeature(e,t){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,t)).length>0}get expressionEvaluatorCache(){return this.m_cachedResults}get techniques(){return this.m_techniques}get decodedTechniques(){return this.m_techniques.map(g)}changeLayer(e){const t=this.m_layer;return this.m_layer=e,t}changeGeometryType(e){const t=this.m_geometryType;return this.m_geometryType=e,t}getOptimizedStyleSet(e){if(void 0!==e.cachedStyleSet)return e.cachedStyleSet;let t=this.m_subStyleSetCache.get(e.key);return void 0!==t?(e.cachedStyleSet=t,t):(t=this.createPreFilteredStyleSet(e),this.m_subStyleSetCache.set(e.key,t),e.cachedStyleSet=t,t)}createPreFilteredStyleSet(e){const{layer:t,geometryType:r}=e;return this.styleSet.filter(e=>(void 0===t||void 0===e.layer||e.layer===t)&&(void 0===r||void 0===e._geometryType||e._geometryType===r))}compileStyleSet(){this.styleSet.forEach(e=>this.compileStyle(e)),this.styleSet.forEach(e=>{this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e.layer,e._geometryType))})}compileStyle(e){if(void 0!==e.when)try{e._whenExpr=Array.isArray(e.when)?n.Expr.fromJSON(e.when,this.m_definitions,this.m_definitionExprCache):n.Expr.parse(e.when),this.m_styleConditionClassifier.classify(e),void 0!==e._whenExpr&&(e._whenExpr=e._whenExpr.intern(this.m_exprPool))}catch(t){h.log("failed to evaluate expression",JSON.stringify(e.when),"error",String(t))}Array.isArray(e.styles)&&e.styles.forEach(e=>this.compileStyle(e))}processStyle(e,t,r,i){if(void 0!==this.m_layer&&void 0!==r.layer&&r.layer!==this.m_layer)return!1;if(void 0!==this.m_geometryType&&void 0!==r._geometryType&&r._geometryType!==this.m_geometryType)return!1;if(r._whenExpr)try{if(!r._whenExpr.evaluate(e,n.ExprScope.Condition,this.m_cachedResults))return!1}catch(e){return h.error(`failed to evaluate expression '${JSON.stringify(r.when)}': ${e}`),!1}if(void 0!==r.styles){t.push(r);for(const n of r.styles)if(this.processStyle(e,t,n,i))return t.pop(),!0;return t.pop(),!1}return void 0!==r.technique&&("none"!==r.technique&&i.push(this.getTechniqueForStyleMatch(e,t,r)),!0===r.final)}getTechniqueForStyleMatch(e,t,r){if(this.checkStyleDynamicAttributes(r,t),void 0!==r._dynamicTechniques){const t=this.evaluateTechniqueProperties(r,e),i=this.getDynamicTechniqueKey(r,t);let n=r._dynamicTechniques.get(i);return void 0===n&&(n=this.createTechnique(r,i,t),r._dynamicTechniques.set(i,n)),n}{let e=r._staticTechnique;return void 0===e&&(r._staticTechnique=e=this.createTechnique(r,`${r._styleSetIndex}`,[])),e}}getDynamicTechniqueKey(e,t){const r=t.map(([e,t])=>void 0===t?"U":JSON.stringify(t)).join(":");return`${e._styleSetIndex}:${r}`}checkStyleDynamicAttributes(e,t){if(void 0!==e._dynamicTechniqueAttributes||"none"===e.technique)return;e._dynamicTechniqueAttributes=[],e._dynamicFeatureAttributes=[],e._dynamicForwardedAttributes=[],e._staticAttributes=[];const r=e._dynamicFeatureAttributes,i=e._dynamicTechniqueAttributes,o=e._dynamicForwardedAttributes,c=e._staticAttributes,h=l.techniqueDescriptors[e.technique]||d,p=(e,t)=>{if(void 0===t)return;const l=h.attrScopes[e];if(n.isJsonExpr(t)?t=n.Expr.fromJSON(t,this.m_definitions,this.m_definitionExprCache).intern(this.m_exprPool):s.isInterpolatedPropertyDefinition(t)&&(t=n.Expr.fromJSON(a.interpolatedPropertyDefinitionToJsonExpr(t)).intern(this.m_exprPool)),t instanceof n.Expr){0===t.dependencies().properties.size&&(t=t.evaluate(this.m_emptyEnv))}if(s.isInterpolatedProperty(t)||t instanceof n.Expr)switch(l){case u.AttrScope.FeatureGeometry:r.push([e,t]);break;case u.AttrScope.TechniqueRendering:case u.AttrScope.TechniqueGeometry:t instanceof n.Expr?i.push([e,t]):o.push([e,t])}else null!=t&&c.push([e,t])};function f(e){if(p("renderOrder",e.renderOrder),p("renderOrderOffset",e.renderOrderOffset),p("label",e.labelProperty),p("secondaryRenderOrder",e.secondaryRenderOrder),void 0!==e.attr)for(const t in e.attr)e.attr.hasOwnProperty(t)&&p(t,e.attr[t])}for(const e of t)f(e);f(e),i.length>0&&(e._dynamicTechniques=new Map)}evaluateTechniqueProperties(e,t){return void 0===e._dynamicTechniqueAttributes?[]:e._dynamicTechniqueAttributes.map(([e,r])=>{try{return[e,r.evaluate(t,n.ExprScope.Value,this.m_cachedResults)]}catch(t){return h.error(`failed to evaluate expression '${r.toJSON()}': ${t}`),[e,null]}})}createTechnique(e,t,r){const i={};if(i.name=e.technique,void 0!==e._staticAttributes)for(const[t,r]of e._staticAttributes)null!==r&&(i[t]=r);for(const[e,t]of r)null!==t&&(i[e]=t);if(void 0!==e._dynamicFeatureAttributes)for(const[t,r]of e._dynamicFeatureAttributes)i[t]=r;if(void 0!==e._dynamicForwardedAttributes)for(const[t,r]of e._dynamicForwardedAttributes)r instanceof n.Expr||(i[t]=r);return i._index=this.m_techniques.length,i._styleSetIndex=e._styleSetIndex,i._key=t,this.m_techniques.push(i),i}},t.makeDecodedTechnique=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),n=r(6),o=r(11),s=i.LoggerManager.instance.create("TechniqueAttr");t.evaluateTechniqueAttr=function(e,t,r){const i=e instanceof n.Env?e:e.env;let a;if(t instanceof n.Expr)try{a=t.evaluate(i,n.ExprScope.Value,e instanceof n.Env?void 0:e.cachedExprResults)}catch(e){s.error(`failed to evaluate expression '${JSON.stringify(t)}': ${e}`),a=void 0}else if(o.isInterpolatedProperty(t)){const r=e instanceof n.Env?e.lookup("$zoom"):e.zoomLevel;a=o.getPropertyValue(t,r)}else a=t;return null==a?r:a}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2),n=r(3),o=r(1),s=r(21),a=o.LoggerManager.instance.create("TileDecoderService");class u extends s.WorkerService{constructor(e,t){super(e),this.serviceId=e,this.m_decoder=t,this.m_decoder.connect()}static start(e,t){return new u(e,t)}handleRequest(e){return i.WorkerDecoderProtocol.isDecodeTileRequest(e)?this.handleDecodeTileRequest(e):i.WorkerDecoderProtocol.isTileInfoRequest(e)?this.handleTileInfoRequest(e):super.handleRequest(e)}handleMessage(e){i.WorkerDecoderProtocol.isConfigurationMessage(e)?this.handleConfigurationMessage(e):a.error(`[${this.serviceId}]: invalid message ${e.type}`)}handleDecodeTileRequest(e){const t=n.TileKey.fromMortonCode(e.tileKey),r=i.getProjection(e.projection);return this.m_decoder.decodeTile(e.data,t,r).then(e=>{const t=[];return e.geometries.forEach(e=>{e.vertexAttributes.forEach(e=>{e.buffer instanceof ArrayBuffer&&t.push(e.buffer)}),e.index&&e.index.buffer instanceof ArrayBuffer&&t.push(e.index.buffer),void 0!==e.objInfos&&1===e.objInfos.length&&void 0!==e.objInfos[0]&&"displacementMap"in e.objInfos[0]&&t.push(e.objInfos[0].displacementMap.buffer)}),e.techniques.forEach(e=>{i.addBuffersToTransferList(e,t)}),{response:e,transferList:t}})}handleTileInfoRequest(e){const t=n.TileKey.fromMortonCode(e.tileKey),r=i.getProjection(e.projection);return this.m_decoder.getTileInfo(e.data,t,r).then(e=>{return{response:e,transferList:void 0!==e&&void 0!==e.transferList?e.transferList:[]}})}handleConfigurationMessage(e){this.m_decoder.configure(e.styleSet,e.definitions,e.languages,e.options)}}t.TileDecoderService=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(146),n=i.default||i;t.GeoJsonTiler=class{constructor(){this.indexes=new Map}dispose(){}async connect(){return Promise.resolve()}async registerIndex(e,t){if(!this.indexes.has(e))return this.updateIndex(e,t)}async updateIndex(e,t){if(t instanceof URL){const e=await fetch(t.href);if(!e.ok)throw new Error(`GeoJsonTiler: Unable to fetch ${t.href}: ${e.statusText}`);t=await e.json()}else t=t;this.indexes.set(e,n(t,{maxZoom:20,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:0,lineMetrics:!1,promoteId:null,generateId:!0,debug:0}))}async getTile(e,t){const r=this.indexes.get(e);if(void 0===r)throw new Error("Tile not found");const i=r.getTile(t.level,t.column,t.row);return null!==i&&(i.layer=e),i||{}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),n=r(0),o=new n.Vector3,s=new n.Vector3,a=new n.Vector3,u=new n.Vector3,l=new n.Vector3,c=.1,h={attributes:[{name:"uv",itemSize:2,offset:13},{name:"normal",itemSize:3,offset:15}],stride:5},d={attributes:[{name:"extrusionCoord",itemSize:3,offset:0},{name:"position",itemSize:3,offset:3},{name:"tangent",itemSize:3,offset:6},{name:"bitangent",itemSize:4,offset:9}],stride:13},p={attributes:[...d.attributes,...h.attributes],stride:d.stride+h.stride},f={attributes:[{name:"extrusionCoord",itemSize:2,offset:0},{name:"position",itemSize:3,offset:2},{name:"positionLow",itemSize:3,offset:5},{name:"tangent",itemSize:3,offset:8},{name:"bitangent",itemSize:4,offset:11}],stride:15},m={attributes:[...f.attributes,...h.attributes],stride:f.stride+h.stride};class g{constructor(){this.vertices=[],this.vertexColors=[],this.indices=[]}}function y(e,t){return t?e?m:f:e?p:d}function v(e,t,r,n,h=new g,d=!1){if(0===t.length)return h;const p=y(void 0!==r,d).stride,f=t.length/3,m=new Array(f),v=new Array(t.length-3),x=h.vertices.length/p,b=void 0!==r&&r.length>0,w=void 0!==n&&n.length&&t.length;i.assert(!b||r.length/2===f),i.assert(!w||n.length===t.length);let T=c;m[0]=T;let _=!0;for(let e=0;e<f-1;++e){let r=0;for(let i=0;i<3;++i){const n=t[3*(e+1)+i]-t[3*e+i];v[3*e+i]=n,r+=n*n,_=2===i?_&&0===t[3*(e+1)+i]:_}T+=Math.sqrt(r),m[e+1]=T}const S=m[m.length-1];let E=!0;for(let e=0;e<3;++e)E=E&&t[e]===t[t.length-3+e];const M=[],P=(i,c,p,f,m)=>{M.length=0,h.vertices.push(f,-1*m,S),M.push(f,1*m,S);for(let e=0;e<3;++e){if(d){const r=Math.fround(t[3*i+e]),n=t[3*i+e]-r;h.vertices.push(r,n),M.push(r,n)}else h.vertices.push(t[3*i+e]),M.push(t[3*i+e]);s.setComponent(e,t[3*i+e])}for(let e=0;e<3;++e)a.setComponent(e,v[c+e]),u.setComponent(e,v[p+e]);a.normalize(),h.vertices.push(a.x,a.y,a.z),M.push(a.x,a.y,a.z);const g=function(e,t,r,i){let n=0;t.equals(r)||(n=Math.acos(t.dot(r))*Math.sign(e.dot(o.copy(t).cross(r))),Number.isNaN(n)&&(n=0));return i.copy(t).add(r).normalize().cross(e).normalize(),n}(_?s.set(0,0,1):s.add(e).normalize(),a,u.normalize(),l);h.vertices.push(l.x,l.y,l.z,g),M.push(l.x,l.y,l.z,g),b&&(h.vertices.push(r[2*i],r[2*i+1]),M.push(r[2*i],r[2*i+1]),h.vertices.push(s.x,s.y,s.z),M.push(s.x,s.y,s.z)),h.vertices.push(...M),w&&(h.vertexColors.push(n[3*i],n[3*i+1],n[3*i+2]),h.vertexColors.push(n[3*i],n[3*i+1],n[3*i+2]))};for(let e=0;e<f;++e){const t=E&&0===e?v.length-3:3*Math.max(0,e-1),r=E&&e===f-1?0:Math.min(3*e,v.length-3);e>0&&P(e,t,r,m[e-1],m[e]),e+1<f&&P(e,t,r,-1*m[Math.min(e,m.length-1)],m[Math.min(e+1,m.length-1)])}for(let e=0;e<f-1;++e){const t=x+4*e;h.indices.push(t,t+1,t+2,t+2,t+1,t+3)}return h}function x(e,t,r=new g){if(0===e.length)return r;const i=e.length/3;let n=r.vertices.length/3;const o=void 0!==t&&t.length&&e.length;for(let s=0;s<i;++s,n++){s>0&&r.indices.push(n),s<i-1&&r.indices.push(n);for(let i=0;i<3;++i)r.vertices.push(e[3*s+i]),o&&r.vertexColors.push(t[3*s+i])}return r}t.LineGeometry=g,t.createLineGeometry=v,t.createSimpleLineGeometry=x;class b{constructor(e=!1,t=!1,r=!1){this.hasNormalsAndUvs=e,this.highPrecision=t,this.isSimple=r,this.m_geometry=new g}static createGeometry(e,t,r,i,o=!1,s=!1,a=!1){if(a)return i.setAttribute("position",new n.BufferAttribute(new Float32Array(e),3)),t.length===e.length&&i.setAttribute("color",new n.BufferAttribute(new Float32Array(t),3)),i.setIndex(new n.BufferAttribute(new Uint32Array(r),1)),i;{const a=y(o,s),u=new n.InterleavedBuffer(new Float32Array(e),a.stride);return a.attributes.forEach(e=>{const t=new n.InterleavedBufferAttribute(u,e.itemSize,e.offset,!1);i.setAttribute(e.name,t)}),t.length===e.length&&i.setAttribute("color",new n.BufferAttribute(new Float32Array(t),3)),i.setIndex(new n.BufferAttribute(new Uint32Array(r),1)),i}}clear(){this.m_geometry.vertices=[],this.m_geometry.vertexColors=[],this.m_geometry.indices=[]}add(e,t,r,n){return this.isSimple?x(t,n,this.m_geometry):(i.assert(!this.hasNormalsAndUvs||void 0!==r),v(e,t,r,n,this.m_geometry,this.highPrecision)),this}get vertices(){return this.m_geometry.vertices}get vertexColors(){return this.m_geometry.vertexColors}get indices(){return this.m_geometry.indices}get vertexAttributes(){return y(this.hasNormalsAndUvs,this.highPrecision).attributes}get stride(){return y(this.hasNormalsAndUvs,this.highPrecision).stride}createGeometry(e){return void 0===e&&(e=new n.BufferGeometry),b.createGeometry(this.m_geometry.vertices,this.m_geometry.vertexColors,this.m_geometry.indices,e,this.hasNormalsAndUvs,this.highPrecision)}}t.LineGroup=b},function(e,t,r){"use strict";function i(e,t,r){r=r||2;var i,a,u,l,c,p,m,g=t&&t.length,y=g?t[0]*r:e.length,v=n(e,0,y,r,!0),x=[];if(!v||v.next===v.prev)return x;if(g&&(v=function(e,t,r,i){var s,a,u,l,c,p=[];for(s=0,a=t.length;s<a;s++)u=t[s]*i,l=s<a-1?t[s+1]*i:e.length,(c=n(e,u,l,i,!1))===c.next&&(c.steiner=!0),p.push(f(c));for(p.sort(h),s=0;s<p.length;s++)d(p[s],r),r=o(r,r.next);return r}(e,t,v,r)),e.length>80*r){i=u=e[0],a=l=e[1];for(var b=r;b<y;b+=r)(c=e[b])<i&&(i=c),(p=e[b+1])<a&&(a=p),c>u&&(u=c),p>l&&(l=p);m=0!==(m=Math.max(u-i,l-a))?1/m:0}return s(v,x,r,i,a,m),x}function n(e,t,r,i,n){var o,s;if(n===E(e,t,r,i)>0)for(o=t;o<r;o+=i)s=T(o,e[o],e[o+1],s);else for(o=r-i;o>=t;o-=i)s=T(o,e[o],e[o+1],s);return s&&v(s,s.next)&&(_(s),s=s.next),s}function o(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!v(i,i.next)&&0!==y(i.prev,i,i.next))i=i.next;else{if(_(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function s(e,t,r,i,n,h,d){if(e){!d&&h&&function(e,t,r,i){var n=e;do{null===n.z&&(n.z=p(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,o,s,a,u,l=1;do{for(r=e,e=null,o=null,s=0;r;){for(s++,i=r,a=0,t=0;t<l&&(a++,i=i.nextZ);t++);for(u=l;a>0||u>0&&i;)0!==a&&(0===u||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,u--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;r=i}o.nextZ=null,l*=2}while(s>1)}(n)}(e,i,n,h);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?u(e,i,n,h):a(e))t.push(f.i/r),t.push(e.i/r),t.push(m.i/r),_(e),e=m.next,g=m.next;else if((e=m)===g){d?1===d?s(e=l(e,t,r),t,r,i,n,h,2):2===d&&c(e,t,r,i,n,h):s(o(e),t,r,i,n,h,1);break}}}function a(e){var t=e.prev,r=e,i=e.next;if(y(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(m(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&y(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function u(e,t,r,i){var n=e.prev,o=e,s=e.next;if(y(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,u=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,l=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,c=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,h=p(a,u,t,r,i),d=p(l,c,t,r,i),f=e.prevZ,g=e.nextZ;f&&f.z>=h&&g&&g.z<=d;){if(f!==e.prev&&f!==e.next&&m(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,g!==e.prev&&g!==e.next&&m(n.x,n.y,o.x,o.y,s.x,s.y,g.x,g.y)&&y(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&m(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;g&&g.z<=d;){if(g!==e.prev&&g!==e.next&&m(n.x,n.y,o.x,o.y,s.x,s.y,g.x,g.y)&&y(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function l(e,t,r){var i=e;do{var n=i.prev,o=i.next.next;!v(n,o)&&x(n,i,i.next,o)&&b(n,o)&&b(o,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(o.i/r),_(i),_(i.next),i=e=o),i=i.next}while(i!==e);return i}function c(e,t,r,i,n,a){var u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&g(u,l)){var c=w(u,l);return u=o(u,u.next),c=o(c,c.next),s(u,t,r,i,n,a),void s(c,t,r,i,n,a)}l=l.next}u=u.next}while(u!==e)}function h(e,t){return e.x-t.x}function d(e,t){if(t=function(e,t){var r,i=t,n=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>s){if(s=a,a===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===s)return r.prev;var u,l=r,c=r.x,h=r.y,d=1/0;i=r.next;for(;i!==l;)n>=i.x&&i.x>=c&&n!==i.x&&m(o<h?n:s,o,c,h,o<h?s:n,o,i.x,i.y)&&((u=Math.abs(o-i.y)/(n-i.x))<d||u===d&&i.x>r.x)&&b(i,e)&&(r=i,d=u),i=i.next;return r}(e,t)){var r=w(t,e);o(r,r.next)}}function p(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function m(e,t,r,i,n,o,s,a){return(n-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(i-a)-(r-s)*(t-a)>=0&&(r-s)*(o-a)-(n-s)*(i-a)>=0}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&x(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&b(e,t)&&b(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)}function y(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,r,i){return!!(v(e,t)&&v(r,i)||v(e,i)&&v(r,t))||y(e,t,r)>0!=y(e,t,i)>0&&y(r,i,e)>0!=y(r,i,t)>0}function b(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function w(e,t){var r=new S(e.i,e.x,e.y),i=new S(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function T(e,t,r,i){var n=new S(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function _(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(e,t,r,i){for(var n=0,o=t,s=r-i;o<r;o+=i)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}e.exports=i,e.exports.default=i,i.deviation=function(e,t,r,i){var n=t&&t.length,o=n?t[0]*r:e.length,s=Math.abs(E(e,0,o,r));if(n)for(var a=0,u=t.length;a<u;a++){var l=t[a]*r,c=a<u-1?t[a+1]*r:e.length;s-=Math.abs(E(e,l,c,r))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*r,p=i[a+1]*r,f=i[a+2]*r;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},i.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)r.vertices.push(e[n][o][s]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(20),n=r(0),o=r(22),s=4096;var a;!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(a||(a={})),t.VTJsonDataAdapterId="vt-json";t.VTJsonDataAdapter=class{constructor(e,r,i){this.m_processor=e,this.m_dataFilter=r,this.m_logger=i,this.id=t.VTJsonDataAdapterId}get dataFilter(){return this.m_dataFilter}set dataFilter(e){this.m_dataFilter=e}canProcess(e){if(o.isArrayBufferLike(e))return!1;const t=e;return void 0!==t.features&&void 0!==t.source&&void 0!==t.x&&void 0!==t.y&&void 0!==t.z}process(e,t,r){for(const r of e.features){const o=new i.MapEnv(Object.assign({$layer:e.layer,$geometryType:this.convertGeometryType(r.type),$level:t.level,$zoom:Math.max(0,t.level-(this.m_processor.storageLevelOffset||0)),$id:r.id},r.tags));switch(r.type){case a.Point:for(const i of r.geometry){const r=i[0],a=i[1],u=new n.Vector2(r,a);this.m_processor.processPointFeature(e.layer,s,[u],o,t.level)}break;case a.LineString:for(const i of r.geometry){const r={positions:[]};for(const[e,t]of i){const i=new n.Vector2(e,t);r.positions.push(i)}this.m_processor.processLineFeature(e.layer,s,[r],o,t.level)}break;case a.Polygon:{const i={rings:[]};for(const e of r.geometry){const t=[];for(const[r,i]of e){const e=new n.Vector2(r,i);t.push(e)}i.rings.push(t)}this.m_processor.processPolygonFeature(e.layer,s,[i],o,t.level);break}case a.Unknown:}}}convertGeometryType(e){switch(e){case a.Point:return"point";case a.LineString:return"line";case a.Polygon:return"polygon";default:return"unknown"}}}},function(e,t,r){"use strict";e.exports=h;var i,n=r(7),o=n.LongBits,s=n.base64,a=n.utf8;function u(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function l(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new u(l,0,0),this.tail=this.head,this.states=null}function d(e,t,r){t[r]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function f(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function m(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}h.create=n.Buffer?function(){return(h.create=function(){return new i})()}:function(){return new h},h.alloc=function(e){return new n.Array(e)},n.Array!==Array&&(h.alloc=n.pool(h.alloc,n.Array.prototype.subarray)),h.prototype._push=function(e,t,r){return this.tail=this.tail.next=new u(e,t,r),this.len+=t,this},p.prototype=Object.create(u.prototype),p.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(f,10,o.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=o.from(e);return this._push(f,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(f,t.length(),t)},h.prototype.bool=function(e){return this._push(d,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(m,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=o.from(e);return this._push(m,4,t.lo)._push(m,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(n.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(n.float.writeDoubleLE,8,e)};var g=n.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(d,1,0);if(n.isString(e)){var r=h.alloc(t=s.length(e));s.decode(e,r,0),e=r}return this.uint32(t)._push(g,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(d,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new u(l,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(l,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},h._configure=function(e){i=e}},function(e,t,r){"use strict";e.exports=u;var i,n=r(7),o=n.LongBits,s=n.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var l,c="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")};function h(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new o(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}u.create=n.Buffer?function(e){return(u.create=function(e){return n.Buffer.isBuffer(e)?new i(e):c(e)})(e)}:c,u.prototype._slice=n.Array.prototype.subarray||n.Array.prototype.slice,u.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return l;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return l}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return d(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|d(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=n.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=n.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},u.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},u.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){i=e;var t=n.Long?"toLong":"toNumber";n.merge(u.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2),n=r(15);t.OmvFeatureFilterDescriptionBuilder=class{constructor(e){this.m_processLayersDefault=!0,this.m_processPointsDefault=!0,this.m_processLinesDefault=!0,this.m_processPolygonsDefault=!0,this.m_layersToProcess=new Array,this.m_layersToIgnore=new Array,this.m_pointsToProcess=new Array,this.m_ignoredPoints=new Array,this.m_linesToProcess=new Array,this.m_linesToIgnore=new Array,this.m_polygonsToProcess=new Array,this.m_polygonsToIgnore=new Array,this.m_kindsToProcess=[],this.m_kindsToIgnore=[],e&&(this.m_processLayersDefault=void 0===e.processLayersDefault||e.processLayersDefault,this.m_processPointsDefault=void 0===e.processPointsDefault||e.processPointsDefault,this.m_processLinesDefault=void 0===e.processLinesDefault||e.processLinesDefault,this.m_processPolygonsDefault=void 0===e.processPolygonsDefault||e.processPolygonsDefault)}processLayer(e,t=n.OmvFilterString.StringMatch.Match,r=0,i=1/0){this.m_layersToProcess.push({name:{value:e,match:t},minLevel:r,maxLevel:i})}ignoreLayer(e,t=n.OmvFilterString.StringMatch.Match,r=0,i=1/0){this.m_layersToIgnore.push({name:{value:e,match:t},minLevel:r,maxLevel:i})}processPoint(e){this.addItem(this.m_pointsToProcess,e)}processPoints(e){this.addItems(this.m_pointsToProcess,e)}ignorePoint(e){this.addItem(this.m_ignoredPoints,e)}ignorePoints(e){this.addItems(this.m_ignoredPoints,e)}processLine(e){this.addItem(this.m_linesToProcess,e)}processLines(e){this.addItems(this.m_linesToProcess,e)}ignoreLine(e){this.addItem(this.m_linesToIgnore,e)}ignoreLines(e){this.addItems(this.m_linesToIgnore,e)}processPolygon(e){this.addItem(this.m_polygonsToProcess,e)}processPolygons(e){this.addItems(this.m_polygonsToProcess,e)}ignorePolygon(e){this.addItem(this.m_polygonsToIgnore,e)}ignorePolygons(e){this.addItems(this.m_polygonsToIgnore,e)}processKinds(e){this.m_kindsToProcess=this.m_kindsToProcess.concat(e)}ignoreKinds(e){this.m_kindsToIgnore=this.m_kindsToIgnore.concat(e)}createDescription(){return{processLayersDefault:this.m_processLayersDefault,processPointsDefault:this.m_processPointsDefault,processLinesDefault:this.m_processLinesDefault,processPolygonsDefault:this.m_processPolygonsDefault,layersToProcess:this.m_layersToProcess,layersToIgnore:this.m_layersToIgnore,pointsToProcess:this.m_pointsToProcess,pointsToIgnore:this.m_ignoredPoints,linesToProcess:this.m_linesToProcess,linesToIgnore:this.m_linesToIgnore,polygonsToProcess:this.m_polygonsToProcess,polygonsToIgnore:this.m_polygonsToIgnore,kindsToProcess:this.m_kindsToProcess,kindsToIgnore:this.m_kindsToIgnore}}addItem(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const r={layerName:{value:t.layer,match:void 0===t.matchLayer?n.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomType?Array.isArray(t.geomType)?t.geomType:[t.geomType]:void 0,classes:[{value:t.featureClass,match:void 0===t.matchClass?n.OmvFilterString.StringMatch.Match:t.matchClass}],minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(r)}addItems(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const r={layerName:{value:t.layer,match:void 0===t.matchLayer?n.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomTypes?Array.isArray(t.geomTypes)?t.geomTypes:[t.geomTypes]:void 0,classes:t.featureClasses,minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(r)}};class o{constructor(e){this.description=e,this.description.kindsToProcess.length>0&&(this.enabledKinds=new i.GeometryKindSet(this.description.kindsToProcess)),this.description.kindsToIgnore.length>0&&(this.disabledKinds=new i.GeometryKindSet(this.description.kindsToIgnore))}static matchLayer(e,t,r){for(const i of t)if(!(r<i.minLevel||r>i.maxLevel)&&n.OmvFilterString.matchString(e,i.name))return!0;return!1}wantsLayer(e,t){return!!o.matchLayer(e,this.description.layersToProcess,t)||!o.matchLayer(e,this.description.layersToIgnore,t)&&this.description.processLayersDefault}wantsPointFeature(e,t,r){return this.wantsFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,r,this.description.processPointsDefault)}wantsLineFeature(e,t,r){return this.wantsFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,r,this.description.processLinesDefault)}wantsPolygonFeature(e,t,r){return this.wantsFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,r,this.description.processPolygonsDefault)}wantsKind(e){return void 0===e||(!(void 0!==this.disabledKinds&&this.disabledKinds.hasOrIntersects(e))||void 0!==this.enabledKinds&&this.enabledKinds.hasOrIntersects(e))}get hasKindFilter(){return void 0!==this.enabledKinds||void 0!==this.disabledKinds}wantsFeature(e,t,r,i,o,s){for(const t of e)if(!(o<t.minLevel||o>t.maxLevel)&&n.OmvFilterString.matchString(r,t.layerName)&&void 0!==t.geometryTypes&&t.geometryTypes.indexOf(i)>=0)return!0;for(const e of t)if(n.OmvFilterString.matchString(r,e.layerName)&&void 0!==e.geometryTypes&&e.geometryTypes.indexOf(i)>=0)return!1;return s}}t.OmvGenericFeatureFilter=o;t.ComposedDataFilter=class{constructor(e){this.filters=e}get hasKindFilter(){return this.filters.reduce((e,t)=>e&&t.hasKindFilter,!0)}wantsLayer(e,t){return this.filters.reduce((r,i)=>r&&i.wantsLayer(e,t),!0)}wantsPointFeature(e,t,r){return this.filters.reduce((i,n)=>i&&n.wantsPointFeature(e,t,r),!0)}wantsLineFeature(e,t,r){return this.filters.reduce((i,n)=>i&&n.wantsLineFeature(e,t,r),!0)}wantsPolygonFeature(e,t,r){return this.filters.reduce((i,n)=>i&&n.wantsPolygonFeature(e,t,r),!0)}wantsKind(e){return this.filters.reduce((t,r)=>t&&r.wantsKind(e),!0)}};class s{constructor(e){this.description=e}static matchItems(e,t,r){for(const i of r)if(void 0!==i.classes){if(!n.OmvFilterString.matchString(e,i.layerName))continue;for(const e of i.classes)if(n.OmvFilterString.matchString(t,e))return!0}return!1}static matchAttribute(e,t,r){for(const i of r)if(void 0!==i.featureAttribute&&n.OmvFilterString.matchString(e,i.layerName)&&t.lookup(i.featureAttribute.key)===i.featureAttribute.value)return!0;return!1}doProcessPointFeature(e,t){return this.doProcessFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,this.description.processPointsDefault)}doProcessLineFeature(e,t){return this.doProcessFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,this.description.processLinesDefault)}doProcessPolygonFeature(e,t){return this.doProcessFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,this.description.processPolygonsDefault)}doProcessFeature(e,t,r,i,n){if(void 0===r||0===e.length&&0===t.length)return n;let o;const a=i.lookup("class");return null!=a&&(o=a.toString()),!(!o||!s.matchItems(r,o,e))||(!o||!s.matchItems(r,o,t))&&(!!s.matchAttribute(r,i,e)||!s.matchAttribute(r,i,t)&&n)}}t.OmvGenericFeatureModifier=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(55);var n;self.THREE?Promise.resolve().then(()=>r(29)):(n=["three"],new Promise((e,t)=>{self.postMessage({type:"worker-bootstrap-request",dependencies:n});let r=!1;const o=setTimeout(()=>{r=!0,t(new Error("#asyncWorkerBootstrap: Timeout waiting for `worker-bootstrap-response`."))},1e3);self.addEventListener("message",(function n(s){if(!r)try{const t=s.data;if(i.isWorkerBootstrapResponse(t)){clearTimeout(o),self.removeEventListener("message",n);const r=t.resolvedDependencies;for(const e of r)self.importScripts(e);e()}}catch(e){t(e)}}))})).then(()=>{Promise.resolve().then(()=>r(29))}).catch(e=>{console.error(`harp-decoders.js: failed to bootstrap: ${e}`,e)})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isWorkerBootstrapRequest=function(e){return e&&"worker-bootstrap-request"===e.type&&Array.isArray(e.dependencies)},t.isWorkerBootstrapResponse=function(e){return e&&"worker-bootstrap-response"===e.type&&Array.isArray(e.resolvedDependencies)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(57))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2),n=r(3),o=r(27),s=r(46),a=r(1),u=r(115),l=a.LoggerManager.instance.create("GeoJsonDecoder");class c extends o.ThemedTileDecoder{constructor(){super()}connect(){return Promise.resolve()}decodeThemedTile(e,t,r,i){const n=new h(i,r).getDecodedTile(t,e);return Promise.resolve(n)}}t.GeoJsonTileDecoder=c;class h{constructor(e,t){this.m_projection=e,this.m_styleSetEvaluator=t,this.m_storeExtendedTags=!0}getDecodedTile(e,t){const r=this.getTileCenter(e),n=new i.ExtendedTileInfo(e,this.m_storeExtendedTags),o={info:n,writer:new i.ExtendedTileInfoWriter(n,this.m_storeExtendedTags)},s=u.GeoJsonGeometryCreator.createGeometries(t,r,this.m_projection,this.m_styleSetEvaluator,o),a={geometries:s.geometries,techniques:this.m_styleSetEvaluator.techniques,tileInfo:this.getTileInfo(o)};return s.poiGeometries.length>0&&(a.poiGeometries=s.poiGeometries),s.textGeometries.length>0&&(a.textGeometries=s.textGeometries),s.textPathGeometries.length>0&&(a.textPathGeometries=s.textPathGeometries),a}getTileCenter(e){const t=n.webMercatorTilingScheme.getGeoBox(e);return this.m_projection.projectBox(t,new n.OrientedBox3).position}getTileInfo(e){return e.writer.finish(),e.info}}class d{static start(){o.WorkerServiceManager.getInstance().register({serviceType:"geojson-tile-decoder",factory:e=>s.TileDecoderService.start(e,new c)})}}t.GeoJsonTileDecoderService=d;t.GeoJsonWorkerClient=class{constructor(){l.warn("GeoJsonWorkerClient class is deprecated, please use GeoJsonTileDecoderService.start"),d.start()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t=new Array){this.priority=e,this.elements=t}clone(){return new i(this.priority,this.elements.slice())}}t.PriorityListGroup=i;t.GroupedPriorityList=class{constructor(){this.groups=new Map}add(e){this.getGroup(e.priority).elements.push(e)}remove(e){const t=this.getGroup(e.priority);if(void 0!==t){const r=t.elements.indexOf(e);if(r>=0){if(t.elements.splice(r,1),0===t.elements.length){const t=Math.floor(e.priority);this.groups.delete(t),this.m_sortedGroups&&(this.m_sortedGroups=[])}return!0}}return!1}clear(){this.groups.clear(),this.m_sortedGroups&&(this.m_sortedGroups=[])}merge(e){for(const t of e.groups){const e=this.findGroup(t[1].priority);void 0!==e?e.elements=e.elements.concat(t[1].elements):(this.groups.set(Math.floor(t[1].priority),t[1].clone()),this.m_sortedGroups&&(this.m_sortedGroups=[]))}return this}get sortedGroups(){if(this.m_sortedGroups&&this.m_sortedGroups.length>0)return this.m_sortedGroups;this.m_sortedGroups||(this.m_sortedGroups=[]);for(const e of this.groups)this.m_sortedGroups.push(e[1]);return this.m_sortedGroups.sort((e,t)=>t.priority-e.priority),this.m_sortedGroups}forEach(e){for(const t of this.groups)t[1].elements.forEach(e)}count(){let e=0;for(const t of this.groups)e+=t[1].elements.length;return e}findGroup(e){const t=Math.floor(e);return this.groups.get(t)}getGroup(e){let t=this.findGroup(e);if(void 0===t){const r=Math.floor(e);t=new i(r),this.groups.set(r,t),this.m_sortedGroups&&(this.m_sortedGroups=[])}return t}}},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(32)),i(r(25)),i(r(33)),i(r(60)),i(r(62)),i(r(34))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(61);t.LoggerManager=class{static get instance(){return this.m_instance||(this.m_instance=new i.LoggerManagerImpl)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(32),n=r(33),o=r(34);t.LoggerManagerImpl=class{constructor(){this.m_loggers=[],this.channel="undefined"==typeof self||void 0!==self.document?new i.ConsoleChannel:new o.WorkerChannel}getLoggerNames(){return this.m_loggers.map(e=>e.name)}getLogger(e){return this.m_loggers.find(t=>t.name===e)}create(e,t={}){void 0!==this.m_levelSetForAll&&(void 0===t.level||t.level<this.m_levelSetForAll)&&(t.level=this.m_levelSetForAll);const r=new n.Logger(e,this.channel,t);return this.m_loggers.push(r),r}dispose(e){const t=this.m_loggers.indexOf(e);if(t<0)throw new Error(`Cannot unregister "${e}" : no such logger registered.`);this.m_loggers.splice(t,1)}updateAll(e){for(const t of this.m_loggers)t.update(e)}update(e,t){for(const r of this.m_loggers)r.name===e&&r.update(t)}enableAll(e){for(const t of this.m_loggers)t.enabled=e}enable(e,t){this.update(e,{enabled:t})}setLogLevelForAll(e){this.m_levelSetForAll=e;for(const t of this.m_loggers)t.level=e}setLogLevel(e,t){this.update(e,{level:t})}setChannel(e){this.channel=e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MultiChannel=class{constructor(...e){this.channels=[],this.channels=e}error(e,...t){for(const r of this.channels)r.error(e,...t)}debug(e,...t){for(const r of this.channels)r.debug(e,...t)}info(e,...t){for(const r of this.channels)r.info(e,...t)}log(e,...t){for(const r of this.channels)r.log(e,...t)}trace(e,...t){for(const r of this.channels)r.trace(e,...t)}warn(e,...t){for(const r of this.channels)r.warn(e,...t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,r,i){return(e-r)*(e-r)+(t-i)*(t-i)}e.Box=class{constructor(e=0,t=0,r=0,i=0){this.x=e,this.y=t,this.w=r,this.h=i}set(e,t,r,i){this.x=e,this.y=t,this.w=r,this.h=i}contains(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t}intersects(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y}},e.distSquared=t,e.computeSquaredLineLength=function(e){let t=0;const r=e.length-4;for(let i=0;i<r;i+=3){const r=e[i+3]-e[i],n=e[i+4]-e[i+1];t+=r*r+n*n}return t},e.distToSegmentSquared=function(e,r,i,n,o,s){const a=t(i,n,o,s);if(0===a)return t(e,r,i,n);let u=((e-i)*(o-i)+(r-n)*(s-n))/a;return t(e,r,i+(u=Math.max(0,Math.min(1,u)))*(o-i),n+u*(s-n))}}(t.Math2D||(t.Math2D={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,r){return e<t?t:e>r?r:e}e.clamp=t,e.lerp=function(e,t,r){return e*(1-r)+t*r},e.smoothStep=function(e,r,i){return(i=t((i-e)/(r-e),0,1))*i*(3-2*i)},e.smootherStep=function(e,r,i){return(i=t((i-e)/(r-e),0,1))*i*i*(i*(6*i-15)+10)},e.map=function(e,t,r,i,n){return(e-t)*(n-i)/(r-t)+i},e.min2=function(e,t){let r;return void 0!==e&&(r=e),void 0!==t&&(r=void 0===r?t:Math.min(r,t)),r},e.max2=function(e,t){let r;return void 0!==e&&(r=e),void 0!==t&&(r=void 0===r?t:Math.max(r,t)),r},e.isClamped=function(e,t,r){return!(void 0!==t&&e<t)&&!(void 0!==r&&e>r)},e.easeInOutCubic=function(e,t,r){return e+(t-e)*(r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1)}}(t.MathUtils||(t.MathUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixins=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(r=>{e.prototype[r]=t.prototype[r]})})},t.applyMixinsWithoutProperties=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(r=>{const i=Object.getOwnPropertyDescriptor(t.prototype,r);void 0!==i&&void 0===i.get&&(e.prototype[r]=t.prototype[r])})})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=!0;t.assert=function(e,t){if(!i&&!e)throw new Error(void 0!==t?t:"ASSERTION failed")},t.assertExists=function(e,t){if(!i&&null==e)throw new Error(void 0!==t?t:"ASSERTION failed: Element is undefined or null");return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContextLogger=class{constructor(e,t){this.m_logger=e,this.headerMessage=t,this.context=[],this.m_headerLogged=!1,this.warn=this.createLogMethod("warn"),this.info=this.createLogMethod("info"),this.error=this.createLogMethod("error")}pushAttr(e){this.context.push(`${this.context.length>0?".":""}${e}`)}pushIndex(e){this.context.push(`[${e}]`)}pop(){this.context.pop()}createLogMethod(e){return(t,...r)=>{this.m_headerLogged||(this.m_logger.info(this.headerMessage),this.m_headerLogged=!0),this.m_logger[e](`${this.context.join("")}: ${t}`,...r)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{static now(){return i.nowFunc()}static getNowFunc(){return"undefined"!=typeof performance&&void 0!==performance.now?()=>performance.now():()=>(new Date).getTime()}}t.PerformanceTimer=i,i.instance=new i,i.nowFunc=i.getNowFunc()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cloneDeep=function(e){const t=new Map,r=function e(r){if(null===r)return null;if("object"==typeof r){const i=t.get(r);if(void 0!==i)return i;if(Array.isArray(r)){const i=[];t.set(r,i),i.length=r.length;for(let t=0;t<i.length;++t)i[t]=e(r[t]);return i}if(r instanceof Date){const e=new Date(r.getTime());return t.set(r,e),e}if(r instanceof RegExp){const e=new RegExp(r.source,r.flags);return t.set(r,e),e}if(r.constructor!==Object)throw new Error("cloneDeep doesn't support objects with custom prototypes");{const i={};t.set(r,i);for(const t in r)r.hasOwnProperty(t)&&(i[t]=e(r[t]));return i}}return r}(e);return t.clear(),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOptionValue=function(...e){for(const t of e)if(null!=t)return t},t.mergeWithOptions=function(e,t){const r=Object.assign({},e);if(null==t)return r;for(const i in e)if(e.hasOwnProperty(i)){const e=t[i];null!=e&&(r[i]=e)}return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(26);t.PrefixMapUriResolver=class{constructor(e){this.definitions=e}resolveUri(e){return Object.keys(this.definitions).reduce((e,t)=>{if(t.endsWith("/")&&e.startsWith(t)){return this.definitions[t]+e.substr(t.length)}return e===t?this.definitions[t]:e},e)}};t.RelativeUriResolver=class{constructor(e){this.parentUri=e}resolveUri(e){return i.resolveReferenceUri(this.parentUri,e)}},t.composeUriResolvers=function(...e){return{resolveUri:t=>e.reduce((e,t)=>void 0!==t?t.resolveUri(e):e,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(26);t.getAppBaseUrl=function(){return i.baseUrl(window.location.href)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chainCallbacks=function(e,t){return function(...r){return e&&e.apply(this,r),t.apply(this,r)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(0);t.ExponentialInterpolant=class extends i.Interpolant{constructor(){super(...arguments),this.exponent=2}interpolate_(e,t,r,i){const n=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,u=a-s,l=Math.pow((r-t)/(i-t),this.exponent),c=1-l;for(let e=0;e!==s;++e)n[e]=o[u+e]*c+o[a+e]*l;return n}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t,r;e.WORKER_SERVICE_MANAGER_SERVICE_ID="worker-service-manager",function(e){e.Initialized="initialized",e.Request="request",e.Response="response"}(t=e.ServiceMessageName||(e.ServiceMessageName={})),e.isInitializedMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Initialized},function(e){e.CreateService="create-service",e.DestroyService="destroy-service"}(r=e.Requests||(e.Requests={})),e.isUnknownServiceError=function(e){return/unknown targetServiceType requested: /.test(e.message)},e.isRequestMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Request},e.isResponseMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Response}}(t.WorkerServiceProtocol||(t.WorkerServiceProtocol={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t;!function(e){e.RegisterIndex="register-index",e.UpdateIndex="update-index",e.TileRequest="tile-request"}(t=e.Requests||(e.Requests={})),e.isRegisterIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.RegisterIndex},e.isUpdateIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.UpdateIndex},e.isTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.TileRequest}}(t.WorkerTilerProtocol||(t.WorkerTilerProtocol={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RequestController=class{constructor(e=0,t=new AbortController){this.priority=e,this.abortController=t}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}},function(e){let t,r;!function(e){e.Configuration="configuration"}(t=e.DecoderMessageName||(e.DecoderMessageName={})),e.isConfigurationMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Configuration},function(e){e.DecodeTileRequest="decode-tile-request",e.TileInfoRequest="tile-info-request"}(r=e.Requests||(e.Requests={})),e.isDecodeTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===r.DecodeTileRequest},e.isTileInfoRequest=function(e){return e&&"string"==typeof e.type&&e.type===r.TileInfoRequest}}(t.WorkerDecoderProtocol||(t.WorkerDecoderProtocol={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordinatesLike=function(e){return e&&"number"==typeof e.latitude&&"number"==typeof e.longitude&&("number"==typeof e.altitude||void 0===e.altitude)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoPointLike=function(e){if(Array.isArray(e)){const[t,r,i]=e;return"number"==typeof t&&"number"==typeof r&&(void 0===i||"number"==typeof i)}return!1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLatLngLike=function(e){return e&&"number"==typeof e.lat&&"number"==typeof e.lng}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(12),n=r(4),o=r(8),s=r(5),a=r(9),u=r(10),l=r(0);t.identityProjection=new class extends u.Projection{constructor(){super(...arguments),this.type=u.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,r){return r||(r=s.MathUtils.newEmptyBox3()),r.min.x=-Math.PI,r.min.y=.5*-Math.PI,r.min.z=e,r.max.x=Math.PI,r.max.y=.5*Math.PI,r.max.z=t,r}projectPoint(e,t){return t||(t={x:0,y:0,z:0}),t.x=l.Math.degToRad(e.longitude),t.y=l.Math.degToRad(e.latitude),t.z=e.altitude||0,t}unprojectPoint(e){return n.GeoCoordinates.fromRadians(e.y,e.x,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){t||(t=s.MathUtils.newEmptyBox3());const r=this.projectPoint(new n.GeoCoordinates(e.south,e.west,e.minAltitude)),i=this.projectPoint(new n.GeoCoordinates(e.north,e.east,e.maxAltitude));return o.isBox3Like(t)?(t.min.x=r.x,t.min.y=r.y,t.min.z=r.z,t.max.x=i.x,t.max.y=i.y,t.max.z=i.z):a.isOrientedBox3Like(t)&&(s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,1,0,t.yAxis),s.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(r.x+i.x),t.position.y=.5*(r.y+i.y),t.position.z=.5*(r.z+i.z),t.extents.x=.5*(i.x-r.x),t.extents.y=.5*(i.y-r.y),t.extents.z=Math.max(Number.EPSILON,.5*(i.z-r.z))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return i.GeoBox.fromCoordinates(t,r)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),n=r(8),o=r(5),s=r(9),a=r(13),u=r(17),l=r(10),c=r(0);function h(e){const t=1/Math.PI,r=Math.floor(2*(e*t+1));return c.Math.clamp(r,0,4)}function d(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}function p(e,t,r){const i=.5*(r+(e.maxAltitude||0)),n=c.Math.degToRad(e.west),o=c.Math.degToRad(e.east),s=h(n),a=h(o);let u=Math.cos(n),l=u,d=Math.sin(n),p=d;for(let e=s+1;e<=a;e++){const t=(e+1&1)*((2&e)-1);u=Math.min(t,u),l=Math.max(t,l);const r=(1&e)*((2&e)-1);d=Math.min(r,d),p=Math.max(r,p)}const f=Math.cos(o);u=Math.min(f,u),l=Math.max(f,l);const m=Math.sin(o);d=Math.min(m,d);const g=(l+u)*i,y=(l-u)*i,v=((p=Math.max(m,p))+d)*i,x=(p-d)*i,b=c.Math.degToRad(e.south),w=c.Math.degToRad(e.north),T=Math.sin(w),_=Math.sin(b),S=(T+_)*i,E=(T-_)*i;return t.min.x=g-y,t.min.y=v-x,t.min.z=S-E,t.max.x=g+y,t.max.y=v+x,t.max.z=S+E,t}t.sphereProjection=new class extends l.Projection{constructor(){super(...arguments),this.type=l.ProjectionType.Spherical}worldExtent(e,t,r=o.MathUtils.newEmptyBox3()){const i=this.unitScale+t;return r.min.x=-i,r.min.y=-i,r.min.z=-i,r.max.x=i,r.max.y=i,r.max.z=i,r}projectPoint(e,t=o.MathUtils.newVector3(0,0,0)){return function(e,t,r){const i=r+(e.altitude||0),n=c.Math.degToRad(e.latitude),o=c.Math.degToRad(e.longitude),s=Math.cos(n);return t.x=i*s*Math.cos(o),t.y=i*s*Math.sin(o),t.z=i*Math.sin(n),t}(e,t,this.unitScale)}unprojectPoint(e){const t=e.x*e.x+e.y*e.y,r=Math.sqrt(t),n=e.z/r;if(isNaN(n))return i.GeoCoordinates.fromRadians(0,0,-this.unitScale);const o=Math.sqrt(t+e.z*e.z);return i.GeoCoordinates.fromRadians(Math.atan(n),Math.atan2(e.y,e.x),o-this.unitScale)}unprojectAltitude(e){const t=e.x*e.x+e.y*e.y+e.z*e.z;return Math.sqrt(t)-a.EarthConstants.EQUATORIAL_RADIUS}projectBox(e,t=o.MathUtils.newEmptyBox3()){if(n.isBox3Like(t))return p(e,t,this.unitScale);if(s.isOrientedBox3Like(t)){if(e.longitudeSpan>=90){const r=p(e,o.MathUtils.newEmptyBox3(),this.unitScale);return o.MathUtils.newVector3(1,0,0,t.xAxis),o.MathUtils.newVector3(0,1,0,t.yAxis),o.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(r.max.x+r.min.x),t.position.y=.5*(r.max.y+r.min.y),t.position.z=.5*(r.max.z+r.min.z),t.extents.x=.5*(r.max.x-r.min.x),t.extents.y=.5*(r.max.y-r.min.y),t.extents.z=.5*(r.max.z-r.min.z),t}const{south:r,west:i,north:n,east:s,center:a}=e,u=a.longitude,l=a.latitude,h=Math.cos(c.Math.degToRad(r)),d=Math.sin(c.Math.degToRad(r)),f=Math.cos(c.Math.degToRad(i)),m=Math.sin(c.Math.degToRad(i)),g=Math.cos(c.Math.degToRad(n)),y=Math.sin(c.Math.degToRad(n)),v=Math.cos(c.Math.degToRad(s)),x=Math.sin(c.Math.degToRad(s)),b=Math.cos(c.Math.degToRad(u)),w=Math.sin(c.Math.degToRad(u)),T=Math.cos(c.Math.degToRad(l)),_=Math.sin(c.Math.degToRad(l));let S,E,M;o.MathUtils.newVector3(b*T,w*T,_,t.zAxis),o.MathUtils.newVector3(-w,b,0,t.xAxis),o.MathUtils.newVector3(-b*_,-w*_,T,t.yAxis),r>=0?(S=Math.abs(h*(b*(m-x)+w*(v-f))),E=T*d-_*h,M=T*y-_*g*(b*v+w*x)):(n<=0?(S=Math.abs(g*(b*(m-x)+w*(v-f))),M=T*y-_*g):(S=Math.abs(b*(m-x)+w*(v-f)),M=T*y-_*g*(w*x+b*v)),E=T*d-_*h*(b*v+w*x));const P=.5*(this.unitScale+(e.maxAltitude||0)),A=.5*(this.unitScale+(e.minAltitude||0)),L=T*(b*v+w*x),I=Math.min(g*L+y*_,h*L+d*_);return o.MathUtils.newVector3(S*P,(M-E)*P,P-I*A,t.extents),o.MathUtils.newVector3(0,(E+M)*P,P+P,t.position),function(e,t,r,i){const n=e.x*i.x+t.x*i.y+r.x*i.z,o=e.y*i.x+t.y*i.y+r.y*i.z,s=e.z*i.x+t.z*i.y+r.z*i.z;i.x=n,i.y=o,i.z=s}(t.xAxis,t.yAxis,t.zAxis,t.position),t.position.x=t.position.x-t.zAxis.x*t.extents.z,t.position.y=t.position.y-t.zAxis.y*t.extents.z,t.position.z=t.position.z-t.zAxis.z*t.extents.z,t}throw new Error("Invalid bounding box")}unprojectBox(e){throw new Error("Method not implemented.")}getScaleFactor(e){return 1}groundDistance(e){return d(e)-this.unitScale}scalePointToSurface(e){const t=this.unitScale/(d(e)||1);return e.x*=t,e.y*=t,e.z*=t,e}surfaceNormal(e,t){void 0===t&&(t={x:0,y:0,z:0});const r=1/(d(e)||1);return t.x=e.x*r,t.y=e.y*r,t.z=e.z*r,t}reprojectPoint(e,t,r){if(e===u.mercatorProjection||e===u.webMercatorProjection){const{x:i,y:n,z:o}=t,s=this.unitScale,a=i/s-Math.PI,l=n/s-Math.PI,c=Math.exp(l),h=c*c,d=2*c/(h+1),p=(h-1)/(h+1),f=s+o;return void 0===r&&(r={}),r.x=Math.cos(a)*d*f,r.y=Math.sin(a)*d*f,r.z=p*f,e===u.webMercatorProjection&&(r.z=-r.z),r}return super.reprojectPoint(e,t,r)}localTangentSpace(e,t){const r=c.Math.degToRad(e.latitude),i=c.Math.degToRad(e.longitude),n=Math.cos(i),s=Math.sin(i),a=Math.cos(r),u=Math.sin(r);return o.MathUtils.newVector3(n*a,s*a,u,t.zAxis),o.MathUtils.newVector3(-s,n,0,t.xAxis),o.MathUtils.newVector3(-n*u,-s*u,a,t.yAxis),this.projectPoint(e,t.position),t}}(a.EarthConstants.EQUATORIAL_RADIUS)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(19);t.QuadTree=class{constructor(e){this.tilingScheme=e}visit(e){this.visitTileKey(i.TileKey.fromRowColumnLevel(0,0,0),e)}visitTileKey(e,t){if(t(e,this.tilingScheme.getGeoBox(e)))for(const r of this.tilingScheme.getSubTileKeys(e))this.visitTileKey(r,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(37),n=r(40),o=r(14);t.hereTilingScheme=new o.TilingScheme(n.halfQuadTreeSubdivisionScheme,i.normalizedEquirectangularProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(17),n=r(18),o=r(14);t.webMercatorTilingScheme=new o.TilingScheme(n.quadTreeSubdivisionScheme,i.webMercatorProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(17),n=r(18),o=r(14);t.mercatorTilingScheme=new o.TilingScheme(n.quadTreeSubdivisionScheme,i.mercatorProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(38),n=r(18),o=r(14);t.polarTilingScheme=new o.TilingScheme(n.quadTreeSubdivisionScheme,i.transverseMercatorProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector3Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTransformLike=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(0);class n{constructor(e,t,r){this.position=new i.Vector3,this.xAxis=new i.Vector3(1,0,0),this.yAxis=new i.Vector3(0,1,0),this.zAxis=new i.Vector3(0,0,1),this.extents=new i.Vector3,void 0!==e&&this.position.copy(e),void 0!==t&&t.extractBasis(this.xAxis,this.yAxis,this.zAxis),void 0!==r&&this.extents.copy(r)}clone(){const e=new n;return e.copy(this),e}copy(e){this.position.copy(e.position),this.xAxis.copy(e.xAxis),this.yAxis.copy(e.yAxis),this.zAxis.copy(e.zAxis),this.extents.copy(e.extents)}getCenter(e=new i.Vector3){return e.copy(this.position)}getSize(e=new i.Vector3){return e.copy(this.extents).multiplyScalar(2)}getRotationMatrix(e=new i.Matrix4){return e.makeBasis(this.xAxis,this.yAxis,this.zAxis)}intersects(e){const t=Array.isArray(e)?e:e.planes;for(const e of t){const t=Math.abs(e.normal.dot(this.xAxis)*this.extents.x)+Math.abs(e.normal.dot(this.yAxis)*this.extents.y)+Math.abs(e.normal.dot(this.zAxis)*this.extents.z);if(e.distanceToPoint(this.position)+t<0)return!1}return!0}contains(e){const t=e.x-this.position.x,r=e.y-this.position.y,i=e.z-this.position.z,n=Math.abs(t*this.xAxis.x+r*this.xAxis.y+i*this.xAxis.z),o=Math.abs(t*this.yAxis.x+r*this.yAxis.y+i*this.yAxis.z),s=Math.abs(t*this.zAxis.x+r*this.zAxis.y+i*this.zAxis.z);return!(n>this.extents.x||o>this.extents.y||s>this.extents.z)}distanceToPoint(e){return Math.sqrt(this.distanceToPointSquared(e))}distanceToPointSquared(e){const t=new i.Vector3;t.subVectors(e,this.position);const r=[t.dot(this.xAxis),t.dot(this.yAxis),t.dot(this.zAxis)];let n=0;for(let e=0;e<3;++e){const t=r[e],i=this.extents.getComponent(e);if(t<-i){const e=i+t;n+=e*e}else if(t>i){const e=t-i;n+=e*e}}return n}}t.OrientedBox3=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),n=r(6),o=r(44),s=r(45),a=r(23);var u;!function(e){e[e.Point=0]="Point",e[e.Line=1]="Line",e[e.Polygon=2]="Polygon"}(u=t.FeatureGroupType||(t.FeatureGroupType={}));const l=100;class c{constructor(e,t=5e3){this.featureIds=new Array,this.numFeatures=0,this.numPositions=0,this.featureIds=new Array(t),this.featureIds.length=t,this.techniqueIndex=new Array(t),this.techniqueIndex.length=t,this.textIndex=new Array(t),this.textIndex.length=t,this.positionIndex=new Array(t),this.positionIndex.length=t,this.positions=new Array(10*t),this.positions.length=10*t,e&&(this.layerIndex=new Array(t),this.layerIndex.length=t,this.classIndex=new Array(t),this.classIndex.length=t,this.typeIndex=new Array(t),this.typeIndex.length=t)}getNumBytes(){return 8*(this.featureIds.length+this.techniqueIndex.length+this.textIndex.length+this.positionIndex.length+this.positions.length+(void 0!==this.layerIndex?this.layerIndex.length:0)+(void 0!==this.classIndex?this.classIndex.length:0)+(void 0!==this.typeIndex?this.typeIndex.length:0))}}t.FeatureGroup=c;class h extends c{constructor(){super(...arguments),this.userData=[]}getNumBytes(){return super.getNumBytes()+8*((void 0!==this.segmentIds?this.segmentIds.length:0)+(void 0!==this.segmentStartOffsets?this.segmentStartOffsets.length:0)+(void 0!==this.segmentEndOffsets?this.segmentEndOffsets.length:0))}}t.LineFeatureGroup=h;class d extends c{constructor(e,t=5e3){super(e,t),this.groupNumRings=0,this.outerRingStartIndex=new Array(t),this.outerRingStartIndex.length=t,this.innerRingIsOuterContour=new Array(t),this.innerRingIsOuterContour.length=t,this.innerRingStartIndex=new Array(t),this.innerRingStartIndex.length=t}getNumBytes(){return super.getNumBytes()+8*((void 0!==this.outerRingStartIndex?this.outerRingStartIndex.length:0)+(void 0!==this.innerRingIsOuterContour?this.innerRingIsOuterContour.length:0)+(void 0!==this.innerRingStartIndex?this.innerRingStartIndex.length:0))}}t.PolygonFeatureGroup=d;class p{constructor(e,t){this.tileKey=e,this.textCatalog=new Array,this.techniqueCatalog=new Array,this.setupTime=0,this.numBytes=0,this.pointGroup=new c(t),this.lineGroup=new h(t),this.polygonGroup=new d(t),t&&(this.layerCatalog=new Array,this.classCatalog=new Array,this.typeCatalog=new Array)}getNumBytes(){let e=l;for(const t of this.textCatalog)e+=2*t.length;if(e+=this.techniqueCatalog.length*l,e+=this.pointGroup.getNumBytes(),e+=this.lineGroup.getNumBytes(),e+=this.polygonGroup.getNumBytes(),void 0!==this.layerCatalog){for(const t of this.layerCatalog)e+=2*t.length;for(const t of this.classCatalog)e+=2*t.length;for(const t of this.typeCatalog)e+=2*t.length}return e}}t.ExtendedTileInfo=p,function(e){function t(e){e.featureIds.length=e.numFeatures,e.techniqueIndex.length=e.numFeatures,e.textIndex.length=e.numFeatures,e.positionIndex.length=e.numFeatures,e.positions.length=e.numPositions,void 0!==e.layerIndex&&(e.layerIndex.length=e.numFeatures),void 0!==e.classIndex&&(e.classIndex.length=e.numFeatures),void 0!==e.typeIndex&&(e.typeIndex.length=e.numFeatures)}function r(e){return e.numPositions===e.positions.length}function i(e,t,r,i){let n;if(t){const t=e.lookup("name:short");if("string"==typeof t&&t.length>0)return t}if(r){const t=e.lookup("iso_code");if("string"==typeof t&&t.length>0)return t}if(void 0!==i)for(const t of i)if("string"==typeof(n=e.lookup(`name:${t}`)||e.lookup(`name_${t}`))&&n.length>0)return n;if("string"==typeof(n=e.lookup("name")))return n}e.finish=function(e){var r,i;t(e.pointGroup),t(r=e.lineGroup),void 0!==r.segmentIds&&(r.segmentIds.length=r.numFeatures,r.segmentStartOffsets.length=r.numFeatures,r.segmentEndOffsets.length=r.numFeatures),t(i=e.polygonGroup),i.outerRingStartIndex.length=i.numFeatures,i.innerRingIsOuterContour.length=i.groupNumRings,i.innerRingStartIndex.length=i.groupNumRings,e.numBytes=e.getNumBytes()},e.featureGroupSize=function(e){return e.numFeatures},e.featureGroupFinished=r,e.tileInfoFinished=function(e){return r(e.pointGroup)&&r(e.lineGroup)&&r(e.polygonGroup)},e.getFeatureName=i,e.getFeatureText=function(e,t,r){let o,u;const l=e instanceof n.Env?e:e.env;if(a.isTextTechnique(t)||a.isPoiTechnique(t)||a.isLineMarkerTechnique(t)){if(void 0!==t.text)return s.evaluateTechniqueAttr(e,t.text);if(void 0!==t.label){const e=l.lookup(t.label);return"string"==typeof e?e:void 0}o=t.useAbbreviation,u=t.useIsoCode}return i(l,o,u,r)}}(p=t.ExtendedTileInfo||(t.ExtendedTileInfo={}));t.ExtendedTileInfoWriter=class{constructor(e,t){this.tileInfo=e,this.storeExtendedTags=t,this.techniqueIndexMap=new Map,this.stringMap=new Map,this.layerMap=new Map,this.classMap=new Map,this.typeMap=new Map}addTechnique(e){let t=this.techniqueIndexMap.get(e._index);if(void 0!==t)return t;const r=o.makeDecodedTechnique(e);return t=this.tileInfo.techniqueCatalog.length,this.techniqueIndexMap.set(r._index,t),this.tileInfo.techniqueCatalog.push(r),t}addFeature(e,t,r,n,o,s){let a=-1;switch(void 0!==n&&n.length>0&&(a=this.addText(n)),e.featureIds[e.numFeatures]=r,e.techniqueIndex[e.numFeatures]=o,e.textIndex[e.numFeatures]=a,e.positionIndex[e.numFeatures]=e.numPositions,s){case u.Polygon:const r=e;i.assert(void 0!==r.outerRingStartIndex),i.assert(void 0!==r.innerRingStartIndex),i.assert(void 0!==r.innerRingIsOuterContour),r.outerRingStartIndex[e.numFeatures]=r.groupNumRings;break;case u.Line:e.userData[e.numFeatures]=t.entries}this.storeExtendedTags&&(e.layerIndex[e.numFeatures]=this.addLayer(t.lookup("$layer")),e.classIndex[e.numFeatures]=this.addClass(t.lookup("class")),e.typeIndex[e.numFeatures]=this.addType(t.lookup("type"))),e.numFeatures++}addFeaturePoint(e,t,r){e.positions[e.numPositions++]=t,e.positions[e.numPositions++]=r}addFeaturePoints(e,t){const r=e.numPositions,i=t.length,n=e.positions;for(let e=0;e<i;e++)n[r+e]=t[e];e.numPositions+=t.length}addRoadSegments(e,t,r,i){void 0===e.segmentIds&&(e.segmentIds=new Array,e.segmentStartOffsets=new Array,e.segmentEndOffsets=new Array),e.segmentIds[e.numFeatures-1]=t,e.segmentStartOffsets[e.numFeatures-1]=r,e.segmentEndOffsets[e.numFeatures-1]=i}addRingPoints(e,t,r){e.innerRingStartIndex[e.groupNumRings]=e.numPositions,e.innerRingIsOuterContour[e.groupNumRings]=r?1:0,e.groupNumRings++;const i=e.numPositions,n=t.length,o=e.positions;for(let e=0;e<n;e++)o[i+e]=t[e];e.numPositions+=t.length}finish(){p.finish(this.tileInfo)}addText(e){return this.addStringValue(e,this.tileInfo.textCatalog,this.stringMap)}addLayer(e){return this.addStringValue(e,this.tileInfo.layerCatalog,this.layerMap)}addClass(e){return this.addStringValue(e,this.tileInfo.classCatalog,this.classMap)}addType(e){return this.addStringValue(e,this.tileInfo.typeCatalog,this.typeMap)}addStringValue(e,t,r){if(null==e)return-1;const i=e.toString();let n=r.get(i);return void 0!==n?n:(n=t.length,t.push(i),r.set(i,n),n)}};class f{constructor(e){this.tileInfo=e}visitAll(e){this.visitAllPointFeatures(e),this.visitAllLineFeatures(e),this.visitAllPolygonFeatures(e)}visitFeature(e,t){let r=0;const i=this.tileInfo.pointGroup.numFeatures,n=this.tileInfo.pointGroup.featureIds;for(let o=0;o<i;o++)n[o]===e&&(r++,this.visitPointFeature(o,t));const o=this.tileInfo.lineGroup.numFeatures,s=this.tileInfo.lineGroup.featureIds;for(let i=0;i<o;i++)s[i]===e&&(r++,this.visitLineFeature(i,t));const a=this.tileInfo.polygonGroup.numFeatures,u=this.tileInfo.polygonGroup.featureIds;for(let i=0;i<a;i++)u[i]===e&&(r++,this.visitPolygonFeature(i,t));return r}visitAllPointFeatures(e){const t=this.tileInfo.pointGroup.numFeatures;for(let r=0;r<t;r++)this.visitPointFeature(r,e)}visitAllLineFeatures(e){const t=this.tileInfo.lineGroup.numFeatures;for(let r=0;r<t;r++)this.visitLineFeature(r,e)}visitAllPolygonFeatures(e){const t=this.tileInfo.polygonGroup.numFeatures;for(let r=0;r<t;r++)this.visitPolygonFeature(r,e)}getTag(e,t){return void 0!==t&&t[e]>=0?t[e]:-1}visitPointFeature(e,t){const r=this.tileInfo.pointGroup,i=r.positionIndex[e],n=r.positions[i],o=r.positions[i+1];t.acceptPoint&&t.acceptPoint(r.featureIds[e],r.techniqueIndex[e],n,o,r.textIndex[e],this.getTag(e,r.layerIndex),this.getTag(e,r.classIndex),this.getTag(e,r.typeIndex))}visitLineFeature(e,t){const r=this.tileInfo,i=r.lineGroup,n=i.numFeatures,o=i.positionIndex[e],s=e===n-1?i.positions.length-o:i.positionIndex[e+1]-o;let a,u,l;void 0!==i.segmentIds&&(a=i.segmentIds[e],u=i.segmentStartOffsets[e],l=i.segmentEndOffsets[e]),t.acceptLine&&t.acceptLine(i.featureIds[e],i.techniqueIndex[e],i.textIndex[e],this.getTag(e,i.layerIndex),this.getTag(e,i.classIndex),this.getTag(e,i.typeIndex),r.lineGroup.positions,o,s,a,u,l)}visitPolygonFeature(e,t){if(void 0===t.acceptPolygon)return;const r=this.tileInfo.polygonGroup,i=r.numFeatures,n=r.outerRingStartIndex[e],o=e===i-1?r.innerRingStartIndex.length-n:r.outerRingStartIndex[e+1]-n;f.polygonAccessor.setup(r,e,n,o),t.acceptPolygon(r.featureIds[e],r.techniqueIndex[e],r.textIndex[e],this.getTag(e,r.layerIndex),this.getTag(e,r.classIndex),this.getTag(e,r.typeIndex),f.polygonAccessor),f.polygonAccessor.reset()}}t.ExtendedTileInfoVisitor=f,f.polygonAccessor=new class{constructor(){this.featureIndex=0,this.ringStart=0,this.numRings=0}setup(e,t,r,i){this.polygons=e,this.featureIndex=t,this.ringStart=r,this.numRings=i}reset(){this.polygons=void 0,this.featureIndex=0,this.ringStart=0,this.numRings=0}isOuterRing(e){if(i.assert(e>=0),i.assert(e<this.numRings),i.assert(void 0!==this.polygons),e<0||e>=this.numRings||void 0===this.polygons)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");return 0!==this.polygons.innerRingIsOuterContour[this.ringStart+e]}getPoints(e){if(i.assert(e>=0),i.assert(e<this.numRings),i.assert(void 0!==this.polygons),e<0||e>=this.numRings||void 0===this.polygons)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");const t=this.polygons.innerRingStartIndex[this.ringStart+e];let r;return r=e<this.numRings-1?this.polygons.innerRingStartIndex[this.ringStart+e+1]-t:this.ringStart+e<this.polygons.innerRingStartIndex.length-1?this.polygons.innerRingStartIndex[this.ringStart+e+1]-t:this.polygons.positions.length-t,{points:this.polygons.positions,pointsStart:t,numPointValues:r}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(93),n=r(94),o=r(95),s=r(96),a=r(97),u=r(98),l=r(99),c=r(100),h=r(101),d=r(102),p=r(103),f=r(104),m=new Map;t.ExprEvaluatorContext=class{constructor(e,t,r,i){this.evaluator=e,this.env=t,this.scope=r,this.cache=i}evaluate(e){if(void 0!==e)return e.accept(this.evaluator,this);throw new Error("Failed to evaluate expression")}};class g{static defineOperator(e,t){m.set(e,t)}static defineOperators(e){Object.getOwnPropertyNames(e).forEach(t=>{this.defineOperator(t,e[t])})}visitVarExpr(e,t){const r=t.env.lookup(e.name);return void 0!==r?r:null}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value}visitHasAttributeExpr(e,t){return void 0!==t.env.lookup(e.name)}visitContainsExpr(e,t){const r=e.value.accept(this,t),i=e.elements.includes(r);return void 0!==t.cache&&t.cache.set(e,i),i}visitMatchExpr(e,t){const r=t.evaluate(e.value);for(const[i,n]of e.branches){if(Array.isArray(i)&&i.includes(r))return t.evaluate(n);if(i===r)return t.evaluate(n)}return t.evaluate(e.fallback)}visitCaseExpr(e,t){for(const[r,i]of e.branches)if(t.evaluate(r))return t.evaluate(i);return t.evaluate(e.fallback)}visitCallExpr(e,t){switch(e.op){case"all":for(const r of e.args)if(!r.accept(this,t))return!1;return!0;case"any":for(const r of e.args)if(r.accept(this,t))return!0;return!1;case"none":for(const r of e.args)if(r.accept(this,t))return!1;return!0;default:{if(void 0!==t.cache){const r=t.cache.get(e);if(void 0!==r)return r}const r=e.descriptor||m.get(e.op);if(r){e.descriptor=r;const i=r.call(t,e);return t.cache&&t.cache.set(e,i),i}throw new Error(`undefined operator '${e.op}`)}}}}t.ExprEvaluator=g,g.defineOperators(n.CastOperators),g.defineOperators(s.ComparisonOperators),g.defineOperators(c.MathOperators),g.defineOperators(p.StringOperators),g.defineOperators(o.ColorOperators),g.defineOperators(f.TypeOperators),g.defineOperators(h.MiscOperators),g.defineOperators(u.FlowOperators),g.defineOperators(i.ArrayOperators),g.defineOperators(l.InterpolationOperators),g.defineOperators(d.ObjectOperators),g.defineOperators(a.FeatureOperators)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i={at:{call:(e,t)=>{const r=t.args,i=e.evaluate(r[0]);if("number"!=typeof i)throw new Error("expected the index of the element to retrieve");const n=e.evaluate(r[1]);if(!Array.isArray(n))throw new Error("expected an array");return i>=0&&i<n.length?n[i]:null}}};t.ArrayOperators=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i={"to-boolean":{call:(e,t)=>Boolean(e.evaluate(t.args[0]))},"to-string":{call:(e,t)=>String(e.evaluate(t.args[0]))},"to-number":{call:(e,t)=>{for(const r of t.args){const t=Number(e.evaluate(r));if(!isNaN(t))return t}throw new Error("cannot convert the value to a number")}}};t.CastOperators=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),n=new i.Color,o={rgb:{call:(e,t)=>{const r=e.evaluate(t.args[0]),o=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if("number"==typeof r&&"number"==typeof o&&"number"==typeof s)return"#"+n.setRGB(i.Math.clamp(r,0,255)/255,i.Math.clamp(o,0,255)/255,i.Math.clamp(s,0,255)/255).getHexString();throw new Error(`unknown color 'rgb(${r},${o},${s})'`)}},hsl:{call:(e,t)=>{const r=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]),n=e.evaluate(t.args[2]);if("number"==typeof r&&"number"==typeof i&&"number"==typeof n&&r>=0&&i>=0&&n>=0)return`hsl(${r},${Math.round(i)}%,${Math.round(n)}%)`;throw new Error(`unknown color 'hsl(${r},${i}%,${n}%)'`)}}};t.ColorOperators=o},function(e,t,r){"use strict";function i(e,t,r=!1){const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if(!("number"==typeof i&&"number"==typeof n||"string"==typeof i&&"string"==typeof n)&&r)throw new Error(`invalid operands '${i}' and '${n}' for operator '${t.op}'`);switch(t.op){case"<":return i<n;case">":return i>n;case"<=":return i<=n;case">=":return i>=n;default:throw new Error(`invalid comparison operator '${t.op}'`)}}Object.defineProperty(t,"__esModule",{value:!0});const n={"!":{call:(e,t)=>!e.evaluate(t.args[0])},"==":{call:(e,t)=>{return e.evaluate(t.args[0])===e.evaluate(t.args[1])}},"!=":{call:(e,t)=>{return e.evaluate(t.args[0])!==e.evaluate(t.args[1])}},"<":{call:(e,t)=>i(e,t)},">":{call:(e,t)=>i(e,t)},"<=":{call:(e,t)=>i(e,t)},">=":{call:(e,t)=>i(e,t)}};t.ComparisonOperators=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FeatureOperators={"geometry-type":{call:(e,t)=>{switch(e.env.lookup("$geometryType")){case"point":return"Point";case"line":return"LineString";case"polygon":return"Polygon";default:return null}}}}},function(e,t,r){"use strict";function i(e,t,r){switch(t){case"boolean":case"number":case"string":for(const i of r){const r=e.evaluate(i);if(typeof r===t)return r}throw new Error(`expected a '${t}'`);default:throw new Error(`invalid type '${t}'`)}}Object.defineProperty(t,"__esModule",{value:!0});const n={boolean:{call:(e,t)=>i(e,"boolean",t.args)},number:{call:(e,t)=>i(e,"number",t.args)},string:{call:(e,t)=>i(e,"string",t.args)}};t.FlowOperators=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(6),n=r(11);const o={zoom:{call:(e,t)=>{if(e.scope===i.ExprScope.Condition){const t=e.env.lookup("$zoom");if(void 0!==t)return t;throw new Error("failed to get the zoom level.")}throw new Error("invalid usage of the 'zoom' operator.")}},interpolate:{call:(e,t)=>{const r=t.args[0],o=t.args[1],s=t.args.slice(2);if(!(r instanceof i.CallExpr))throw new Error("expected an interpolation type");let a,u;if("linear"===r.op)a="Linear";else if("discrete"===r.op)a="Discrete";else if("cubic"===r.op)a="Cubic";else{if("exponential"!==r.op)throw new Error("unrecognized interpolation type");{a="Exponential";const e=r.args[0];if(!(e instanceof i.NumberLiteralExpr))throw new Error("expected the base of the exponential interpolation");u=e.value}}if(!(o instanceof i.CallExpr))throw new Error("expected the input of the interpolation");if("zoom"!==o.op)throw new Error("only 'zoom' is supported");if(0===s.length||s.length%2)throw new Error("invalid number of samples");const l=[],c=[];for(let t=0;t<s.length;t+=2){const r=s[t];if(!(r instanceof i.NumberLiteralExpr))throw new Error("expected a numeric literal");l.push(r.value),c.push(e.evaluate(s[t+1]))}const h=n.createInterpolatedProperty({interpolation:a,zoomLevels:l,values:c,exponent:u});if(void 0===h)throw new Error("failed to create interpolator");return h}},step:{call:(e,t)=>{if(void 0===t.args[0])throw new Error("expected the input of the 'step' operator");const r=t.args[0];if(e.scope===i.ExprScope.Value&&r instanceof i.CallExpr&&"zoom"===r.op){if(t.args.length<3||t.args.length%2)throw new Error("not enough arguments");const r=[],o=[];r.push(Number.MIN_SAFE_INTEGER),o.push(e.evaluate(t.args[1]));for(let n=2;n<t.args.length;n+=2){const s=t.args[n];if(!(s instanceof i.NumberLiteralExpr))throw new Error("expected a numeric literal");r.push(s.value),o.push(e.evaluate(t.args[n+1]))}const s=n.createInterpolatedProperty({interpolation:"Discrete",zoomLevels:r,values:o});if(void 0===s)throw new Error("failed to create interpolator");return s}return function(e,t){if(t.length<3||t.length%2)throw new Error("not enough arguments");const r=e.evaluate(t[0]);if(null===r)return e.evaluate(t[1]);if("number"!=typeof r)throw new Error("the input of a 'step' operator must have type 'number'");let n=1,o=t.length/2-1;for(;n<o;){const e=n+o>>>1,s=t[2*e];if(!(s instanceof i.NumberLiteralExpr))throw new Error("expected a numeric literal");r<s.value?o=e-1:r>s.value?n=e+1:o=e}const s=t[2*n];if(!(s instanceof i.NumberLiteralExpr))throw new Error("expected a numeric literal");const a=s.value<=r?n:n-1;return e.evaluate(t[2*a+1])}(e,t.args)}}};t.InterpolationOperators=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),n={"^":{call:(e,t)=>{const r=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);if("number"!=typeof r||"number"!=typeof i)throw new Error(`invalid operands '${typeof r}' and '${typeof i}' for operator '^'`);return Math.pow(r,i)}},"-":{call:(e,t)=>{const r=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);if("number"!=typeof r||"number"!=typeof i)throw new Error(`invalid operands '${typeof r}' and '${typeof i}' for operator '-'`);return r-i}},"/":{call:(e,t)=>{const r=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);if("number"!=typeof r||"number"!=typeof i)throw new Error(`invalid operands '${typeof r}' and '${typeof i}' for operator '/'`);return r/i}},"%":{call:(e,t)=>{const r=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);if("number"!=typeof r||"number"!=typeof i)throw new Error(`invalid operands '${typeof r}' and '${typeof i}' for operator '%'`);return r%i}},"+":{call:(e,t)=>t.args.reduce((t,r)=>Number(t)+Number(e.evaluate(r)),0)},"*":{call:(e,t)=>t.args.reduce((t,r)=>Number(t)*Number(e.evaluate(r)),1)},abs:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'abs'`);return Math.abs(r)}},acos:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'acos'`);return Math.acos(r)}},asin:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'asin'`);return Math.asin(r)}},atan:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'atan'`);return Math.atan(r)}},ceil:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'ceil'`);return Math.ceil(r)}},cos:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'cos'`);return Math.cos(r)}},e:{call:()=>Math.E},floor:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'floor'`);return Math.floor(r)}},ln:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'ln'`);return Math.log(r)}},ln2:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'ln2'`);return Math.log2(r)}},log10:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'log10'`);return Math.log10(r)}},max:{call:(e,t)=>Math.max(...t.args.map(t=>Number(e.evaluate(t))))},min:{call:(e,t)=>Math.min(...t.args.map(t=>Number(e.evaluate(t))))},clamp:{call:(e,t)=>{const r=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if("number"!=typeof r||"number"!=typeof n||"number"!=typeof o)throw new Error(`invalid operands '${r}', ${n}, ${o} for operator 'clamp'`);return i.Math.clamp(r,n,o)}},pi:{call:()=>Math.PI},round:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'round'`);return Math.round(r)}},sin:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'sin'`);return Math.sin(r)}},sqrt:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'sqrt'`);return Math.sqrt(r)}},tan:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'tan'`);return Math.tan(r)}}};t.MathOperators=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i={length:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if(Array.isArray(r)||"string"==typeof r)return r.length;throw new Error(`invalid operand '${r}' for operator 'length'`)}},coalesce:{call:(e,t)=>{for(const r of t.args){const t=e.evaluate(r);if(null!==t)return t}return null}}};t.MiscOperators=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=Object.prototype.hasOwnProperty;var n;function o(e,t,r){const o=e.evaluate(t[0]);if("string"!=typeof o)throw new Error("expected the name of an attribute");const s=e.evaluate(t[1]);return s&&"object"==typeof s&&i.call(s,o)?r!==n.get||s[o]:r===n.get&&null}!function(e){e[e.get=0]="get",e[e.has=1]="has"}(n||(n={}));const s={get:{call:(e,t)=>o(e,t.args,n.get)},has:{call:(e,t)=>o(e,t.args,n.has)}};t.ObjectOperators=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i={concat:{call:(e,t)=>"".concat(...t.args.map(t=>String(e.evaluate(t))))},downcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleLowerCase()},upcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleUpperCase()},"~=":{call:(e,t)=>{const r=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);return"string"==typeof r&&"string"==typeof i&&-1!==r.indexOf(i)}},"^=":{call:(e,t)=>{const r=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);return"string"==typeof r&&"string"==typeof i&&r.startsWith(i)}},"$=":{call:(e,t)=>{const r=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);return"string"==typeof r&&"string"==typeof i&&r.endsWith(i)}}};t.StringOperators=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TypeOperators={typeof:{call:(e,t)=>typeof e.evaluate(t.args[0])}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(6);var n,o;function s(e){switch(e){case n.Tab:case n.Lf:case n.Cr:case n.Space:return!0;default:return!1}}function a(e){return e>=n._0&&e<=n._9}function u(e){return e>=n.a&&e<=n.z||e>=n.A&&e<=n.Z}function l(e){return function(e){return u(e)||a(e)}(e)||e===n._||e===n.Dollar||e===n.Dot||e===n.LBracket||e===n.RBracket}function c(e){switch(e){case o.Eof:return"eof";case o.Error:return"error";case o.Identifier:return"identifier";case o.Number:return"number";case o.String:return"string";case o.Comma:return",";case o.LParen:return"(";case o.RParen:return")";case o.LBracket:return"[";case o.RBracket:return"]";case o.Exclaim:return"!";case o.TildeEqual:return"~=";case o.CaretEqual:return"^=";case o.DollarEqual:return"$=";case o.EqualEqual:return"==";case o.ExclaimEqual:return"!=";case o.Less:return"<";case o.Greater:return">";case o.LessEqual:return"<=";case o.GreaterEqual:return">=";case o.BarBar:return"||";case o.AmpAmp:return"&&";default:throw new Error(`invalid token ${e}`)}}!function(e){e[e.Tab=9]="Tab",e[e.Lf=10]="Lf",e[e.Cr=13]="Cr",e[e.Space=32]="Space",e[e.LParen=40]="LParen",e[e.RParen=41]="RParen",e[e.Comma=44]="Comma",e[e.Dot=46]="Dot",e[e.LBracket=91]="LBracket",e[e.Backslash=92]="Backslash",e[e.RBracket=93]="RBracket",e[e._0=48]="_0",e[e._9=57]="_9",e[e._=95]="_",e[e.A=64]="A",e[e.Z=90]="Z",e[e.a=97]="a",e[e.z=122]="z",e[e.DoubleQuote=34]="DoubleQuote",e[e.SingleQuote=39]="SingleQuote",e[e.Exclaim=33]="Exclaim",e[e.Equal=61]="Equal",e[e.Caret=94]="Caret",e[e.Tilde=126]="Tilde",e[e.Dollar=36]="Dollar",e[e.Less=60]="Less",e[e.Greater=62]="Greater",e[e.Bar=124]="Bar",e[e.Amp=38]="Amp"}(n||(n={})),function(e){e[e.Eof=0]="Eof",e[e.Error=1]="Error",e[e.Identifier=2]="Identifier",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Comma=5]="Comma",e[e.LParen=6]="LParen",e[e.RParen=7]="RParen",e[e.LBracket=8]="LBracket",e[e.RBracket=9]="RBracket",e[e.Exclaim=10]="Exclaim",e[e.TildeEqual=11]="TildeEqual",e[e.CaretEqual=12]="CaretEqual",e[e.DollarEqual=13]="DollarEqual",e[e.EqualEqual=14]="EqualEqual",e[e.ExclaimEqual=15]="ExclaimEqual",e[e.Less=16]="Less",e[e.Greater=17]="Greater",e[e.LessEqual=18]="LessEqual",e[e.GreaterEqual=19]="GreaterEqual",e[e.BarBar=20]="BarBar",e[e.AmpAmp=21]="AmpAmp"}(o||(o={}));class h{constructor(e){this.code=e,this.m_token=o.Error,this.m_index=0,this.m_char=n.Lf}token(){return this.m_token}text(){return this.m_text||""}next(){if(this.m_token=this.yylex(),this.m_token===o.Error)throw new Error(`unexpected character ${this.m_char}`);return this.m_token}yyinp(){this.m_char=this.code.codePointAt(this.m_index++)||0}yylex(){for(this.m_text=void 0;s(this.m_char);)this.yyinp();if(0===this.m_char)return o.Eof;const e=this.m_char;switch(this.yyinp(),e){case n.LParen:return o.LParen;case n.RParen:return o.RParen;case n.LBracket:return o.LBracket;case n.RBracket:return o.RBracket;case n.Comma:return o.Comma;case n.SingleQuote:case n.DoubleQuote:{const t=this.m_index-1;for(;this.m_char&&this.m_char!==e;)this.yyinp();if(this.m_char!==e)throw new Error("Unfinished string literal");return this.yyinp(),this.m_text=this.code.substring(t,this.m_index-2),o.String}case n.Exclaim:return this.m_char===n.Equal?(this.yyinp(),o.ExclaimEqual):o.Exclaim;case n.Caret:return this.m_char===n.Equal?(this.yyinp(),o.CaretEqual):o.Error;case n.Tilde:return this.m_char===n.Equal?(this.yyinp(),o.TildeEqual):o.Error;case n.Equal:return this.m_char===n.Equal?(this.yyinp(),o.EqualEqual):o.Error;case n.Less:return this.m_char===n.Equal?(this.yyinp(),o.LessEqual):o.Less;case n.Greater:return this.m_char===n.Equal?(this.yyinp(),o.GreaterEqual):o.Greater;case n.Bar:return this.m_char===n.Bar?(this.yyinp(),o.BarBar):o.Error;case n.Amp:return this.m_char===n.Amp?(this.yyinp(),o.AmpAmp):o.Error;default:{const t=this.m_index-2;if(u(e)||e===n._||e===n.Dollar&&l(this.m_char)){for(;l(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),o.Identifier}if(a(e)){for(;a(this.m_char);)this.yyinp();if(this.m_char===n.Dot)for(this.yyinp();a(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),o.Number}if(e===n.Dollar)return this.m_char===n.Equal?(this.yyinp(),o.DollarEqual):o.Error}}return o.Error}}function d(e){switch(e){case o.TildeEqual:return"~=";case o.CaretEqual:return"^=";case o.DollarEqual:return"$=";case o.EqualEqual:return"==";case o.ExclaimEqual:return"!=";default:return}}function p(e){switch(e){case o.Less:return"<";case o.Greater:return">";case o.LessEqual:return"<=";case o.GreaterEqual:return">=";default:return}}t.ExprParser=class{constructor(e){this.lex=new h(e),this.lex.next()}parse(){return this.parseLogicalOr()}yyexpect(e){if(this.lex.token()!==e)throw new Error(`Syntax error: Expected token '${c(e)}' but `+`found '${c(this.lex.token())}'`);this.lex.next()}parsePrimary(){switch(this.lex.token()){case o.Identifier:{const e=this.lex.text();switch(e){case"has":this.lex.next(),this.yyexpect(o.LParen);const t=this.lex.text();return this.yyexpect(o.Identifier),this.yyexpect(o.RParen),new i.HasAttributeExpr(t);case"length":this.lex.next(),this.yyexpect(o.LParen);const r=this.parseLogicalOr();return this.yyexpect(o.RParen),new i.CallExpr("length",[r]);default:const n=new i.VarExpr(e);return this.lex.next(),n}}case o.LParen:{this.lex.next();const e=this.parseLogicalOr();return this.yyexpect(o.RParen),e}default:return this.parseLiteral()}}parseLiteral(){switch(this.lex.token()){case o.Number:{const e=new i.NumberLiteralExpr(parseFloat(this.lex.text()));return this.lex.next(),e}case o.String:{const e=new i.StringLiteralExpr(this.lex.text());return this.lex.next(),e}default:throw new Error("Syntax error")}}parseUnary(){return this.lex.token()===o.Exclaim?(this.lex.next(),new i.CallExpr("!",[this.parseUnary()])):this.parsePrimary()}parseRelational(){let e=this.parseUnary();for(;;)if(this.lex.token()===o.Identifier&&"in"===this.lex.text()){this.lex.next(),this.yyexpect(o.LBracket);const t=[this.parseLiteral()];for(;this.lex.token()===o.Comma;)this.lex.next(),t.push(this.parseLiteral());this.yyexpect(o.RBracket),e=new i.ContainsExpr(e,t.map(e=>e.value))}else{const t=p(this.lex.token());if(void 0===t)break;this.lex.next();const r=this.parseUnary();e=new i.CallExpr(t,[e,r])}return e}parseEquality(){let e=this.parseRelational();for(;;){const t=d(this.lex.token());if(void 0===t)break;this.lex.next();const r=this.parseRelational();e=new i.CallExpr(t,[e,r])}return e}parseLogicalAnd(){const e=this.parseEquality();if(this.lex.token()!==o.AmpAmp)return e;const t=[e];do{this.lex.next(),t.push(this.parseEquality())}while(this.lex.token()===o.AmpAmp);return new i.CallExpr("all",t)}parseLogicalOr(){const e=this.parseLogicalAnd();if(this.lex.token()!==o.BarBar)return e;const t=[e];do{this.lex.next(),t.push(this.parseLogicalAnd())}while(this.lex.token()===o.BarBar);return new i.CallExpr("any",t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{lookup(e){}unmap(){return{}}}t.Env=i;t.MapEnv=class extends i{constructor(e,t){super(),this.entries=e,this.parent=t}lookup(e){if(this.entries.hasOwnProperty(e)){const t=this.entries[e];if(void 0!==t)return t}return this.parent?this.parent.lookup(e):void 0}unmap(){const e=this.parent?this.parent.unmap():{};for(const t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(6);t.ExprPool=class{constructor(){this.m_booleanLiterals=new Map,this.m_numberLiterals=new Map,this.m_stringLiterals=new Map,this.m_objectLiterals=new Map,this.m_varExprs=new Map,this.m_hasAttributeExprs=new Map,this.m_inExprs=new Map,this.m_callExprs=new Map}add(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return i.NullLiteralExpr.instance}visitBooleanLiteralExpr(e,t){const r=this.m_booleanLiterals.get(e.value);return r||(this.m_booleanLiterals.set(e.value,e),e)}visitNumberLiteralExpr(e,t){const r=this.m_numberLiterals.get(e.value);return r||(this.m_numberLiterals.set(e.value,e),e)}visitStringLiteralExpr(e,t){const r=this.m_stringLiterals.get(e.value);return r||(this.m_stringLiterals.set(e.value,e),e)}visitObjectLiteralExpr(e,t){const r=this.m_objectLiterals.get(e.value);return r||(this.m_objectLiterals.set(e.value,e),e)}visitVarExpr(e,t){const r=this.m_varExprs.get(e.name);return r||(this.m_varExprs.set(e.name,e),e)}visitHasAttributeExpr(e,t){const r=this.m_hasAttributeExprs.get(e.name);return r||(this.m_hasAttributeExprs.set(e.name,e),e)}visitContainsExpr(e,t){const r=e.value.accept(this,t);this.m_inExprs.has(r)||this.m_inExprs.set(r,[]);const n=this.m_inExprs.get(r);for(const t of n){if(t.elements.length!==e.elements.length)continue;if(-1===t.elements.findIndex(t=>!e.elements.includes(t)))return t}const o=new i.ContainsExpr(r,e.elements);return this.m_inExprs.set(r,[o]),o}visitMatchExpr(e,t){const r=e.value.accept(this,t),n=e.branches.map(([e,r])=>[e,r.accept(this,t)]),o=e.fallback.accept(this,t);return new i.MatchExpr(r,n,o)}visitCaseExpr(e,t){const r=e.branches.map(([e,r])=>[e.accept(this,t),r.accept(this,t)]),n=e.fallback.accept(this,t);return new i.CaseExpr(r,n)}visitCallExpr(e,t){const r=e.args.map(e=>e.accept(this,t));this.m_callExprs.has(e.op)||this.m_callExprs.set(e.op,[]);const n=this.m_callExprs.get(e.op);for(const e of n){if(e.args.length!==r.length)continue;let t=0;for(;t<e.args.length&&e.args[t]===r[t];++t);if(t===e.args.length)return e}const o=new i.CallExpr(e.op,r);return n.push(o),o}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(6);t.ThemeVisitor=class{constructor(e){this.theme=e}visitStyles(e){const t=r=>{if(i.isJsonExpr(r))return!1;if(e(r))return!0;if(void 0!==r.styles)for(const e of r.styles)if(t(e))return!0;return!1};if(void 0!==this.theme.styles)for(const e in this.theme.styles)if(void 0!==this.theme.styles[e])for(const r of this.theme.styles[e])if(t(r))return!0;return!1}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(20);t.ThemedTileDecoder=class{constructor(){this.m_storageLevelOffset=0}dispose(){}decodeTile(e,t,r){return void 0===this.m_styleSetEvaluator?Promise.reject(new Error("No style is defined")):this.decodeThemedTile(e,t,this.m_styleSetEvaluator,r)}getTileInfo(e,t,r){return Promise.resolve(void 0)}configure(e,t,r,n){void 0!==e&&(this.m_styleSetEvaluator=new i.StyleSetEvaluator(e,t)),void 0!==r&&(this.languages=r),void 0!==n&&void 0!==n.storageLevelOffset&&(this.m_storageLevelOffset=n.storageLevelOffset)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addExtrudedWalls=function(e,t,r,i,n,o){const s=i.length/r;for(let r=0;r<s;++r){const i=t+2*r,a=i+1,u=t+(r+1)%s*2,l=u+1;!1!==o||void 0===n?e.push(i,a,l,l,u,i):n[r]&&e.push(i,a,l,l,u,i)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),n=new i.Vector2,o=new i.Vector2,s=new i.Vector2,a=new i.Vector2;t.addPolygonEdges=function(e,t,r,i,u,l,c,h){for(let d=0;d<u.length;++d)if(u[d])if(!0===l){const l=t+2*d,p=l+1,f=t+(d+1)%u.length*2,m=f+1;!0===c&&e.push(l,f),e.push(p,m);const g=(0===d?u.length:d)-1;if(u[g])if(void 0!==h){const t=i[d*r],c=i[d*r+1],f=i[(d+1)%u.length*r],m=i[(d+1)%u.length*r+1];n.set(t,c),o.set(f,m),s.set(i[g*r],i[g*r+1]),a.set(n.x,n.y),a.sub(s).normalize().dot(o.sub(n).normalize())<=h&&e.push(l,p)}else e.push(l,p)}else{const r=t+d,i=t+(d+1)%u.length;e.push(r,i)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(36);!function(e){function t(e){if(e instanceof Int8Array)return"int8";if(e instanceof Uint8Array)return"uint8";if(e instanceof Int16Array)return"int16";if(e instanceof Uint16Array)return"uint16";if(e instanceof Int32Array)return"int32";if(e instanceof Uint32Array)return"uint32";if(e instanceof Float32Array)return"float";throw new Error(`Unsupported buffer type ${name}`)}function r(e){const r=e.array;return{name:e.name,buffer:r.buffer,type:t(r),itemCount:e.itemSize,normalized:e.normalized}}e.getBufferElementType=t,e.fromThreeBufferAttribute=r,e.fromThreeInterleavedBufferAttribute=function(e){throw new Error("Not implemented yet")},e.fromThreeBufferGeometry=function(e,t){const n=[],o=Object.getOwnPropertyNames(e.attributes);for(const t of o){const i=r(e.attributes[t]);i.name=t,n.push(i)}const s=r(e.index);return{type:i.GeometryType.Unspecified,vertexAttributes:n,index:s,groups:[{start:0,count:e.index.count,technique:t}]}}}(t.ThreeBufferUtils||(t.ThreeBufferUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2),n=r(3),o=r(47),s=r(21);class a extends s.WorkerService{constructor(e){super(e),this.serviceId=e,this.tiler=new o.GeoJsonTiler}static start(e){return new a(e)}handleRequest(e){return i.WorkerTilerProtocol.isRegisterIndexRequest(e)?this.handleRegisterIndexRequest(e):i.WorkerTilerProtocol.isUpdateIndexRequest(e)?this.handleUpdateIndexRequest(e):i.WorkerTilerProtocol.isTileRequest(e)?this.handleTileRequest(e):super.handleRequest(e)}async handleTileRequest(e){const t=n.TileKey.fromMortonCode(e.tileKey);return{response:await this.tiler.getTile(e.index,t)||{}}}async handleRegisterIndexRequest(e){const t="string"==typeof e.input?new URL(e.input):e.input;return await this.tiler.registerIndex(e.id,t),{response:{}}}async handleUpdateIndexRequest(e){const t="string"==typeof e.input?new URL(e.input):e.input;return this.tiler.updateIndex(e.id,t),{response:{}}}}t.TilerService=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2),n=r(21);class o extends n.WorkerService{constructor(e=i.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID){super(e),this.m_factories=new Map,this.m_services=new Map}static getInstance(){return void 0===this.m_service&&(this.m_service=new o(i.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID)),this.m_service}register(e){this.m_factories.set(e.serviceType,e.factory)}handleRequest(e){if(e.type===i.WorkerServiceProtocol.Requests.CreateService){if(void 0!==this.m_services.get(e.targetServiceId))throw Error(`error - service with targetServiceId='${e.targetServiceId}' already running, ignoring CreateService request`);const t=this.m_factories.get(e.targetServiceType);if(void 0===t)throw Error(`unknown targetServiceType requested: '${e.targetServiceType}'`);const r=t(e.targetServiceId);this.m_services.set(e.targetServiceId,r)}if(e.type===i.WorkerServiceProtocol.Requests.DestroyService){const t=this.m_services.get(e.targetServiceId);if(void 0===t)throw Error(`unknown targetServiceId '${e.targetServiceId}'`);t.destroy(),this.m_services.delete(e.targetServiceId)}return Promise.resolve({response:{}})}}t.WorkerServiceManager=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2),n=r(3),o=r(48),s=r(1),a=r(49),u=r(0),l=r(116);class c{constructor(){this.positions=[],this.indices=[],this.groups=[],this.outlineIndices=[],this.edgeIndices=[],this.featureStarts=[],this.featureIds=[],this.geojsonProperties=[]}}t.GeoJsonGeometryCreator=class{static createGeometries(e,t,r,i,o){const s={geometryBuffer:new Map,textGeometryBuffer:new Map,textPathGeometryBuffer:new Map,poiGeometryBuffer:new Map};l.GeoJsonParser.processGeoJson(e,o,t,r,i,s);const a={geometries:[],poiGeometries:[],textGeometries:[],textPathGeometries:[]},c=new u.Box3,h=n.webMercatorTilingScheme.getGeoBox(o.info.tileKey),d=r.projectBox(h,c),p=new u.Vector3;d.getCenter(p);const f=c.max.sub(p).x;return s.geometryBuffer.forEach((e,t)=>{switch(e.type){case"point":a.geometries.push(this.createPointGeometry(e,t));break;case"solid-line":case"dashed-line":a.geometries.push(this.createSolidLineGeometry(e,t));break;case"polygon":a.geometries.push(this.createPolygonGeometry(e,t));break;case"outline":a.geometries.push(this.createPolygonOutlineGeometry(e,t,f));break;case"segments":a.geometries.push(this.createSegmentsGeometry(e,t))}}),s.poiGeometryBuffer.forEach((e,t)=>{a.poiGeometries.push(this.createPoiGeometry(e,t))}),s.textGeometryBuffer.forEach((e,t)=>{a.textGeometries.push(this.createTextGeometry(e,t))}),s.textPathGeometryBuffer.forEach((e,t)=>{this.createTextPathGeometries(e,t,a)}),a}static createPoiGeometry(e,t){return{positions:{name:"position",type:"float",itemCount:3,buffer:new Float32Array(e.points.vertices).buffer},technique:t,texts:[0],objInfos:e.points.geojsonProperties}}static createTextGeometry(e,t){const r=e.labelProperty,i=e.points.geojsonProperties.map(e=>e[r].toString());return{positions:{name:"position",type:"float",itemCount:3,buffer:new Float32Array(e.points.vertices).buffer},technique:t,texts:[0],stringCatalog:i,objInfos:e.points.geojsonProperties}}static createTextPathGeometries(e,t,r){for(let i=0;i<e.lines.vertices.length;i++){const n=e.lines.vertices[i],o=[];o.push(...n);const a=s.Math2D.computeSquaredLineLength(o),u=e.lines.geojsonProperties[i],l={technique:t,path:o,pathLengthSqr:a,text:u[e.labelProperty].toString(),objInfos:u};r.textPathGeometries.push(l)}}static createPointGeometry(e,t){return{type:i.GeometryType.Point,vertexAttributes:[{name:"position",buffer:new Float32Array(e.points.vertices).buffer,itemCount:3,type:"float"}],groups:[{start:0,count:0,technique:t}],objInfos:e.points.geojsonProperties}}static createSolidLineGeometry(e,t){const r=new u.Vector3,n=new o.LineGroup,s=new Array;for(const t of e.lines.vertices)n.add(r,t),s.push(...t);return{type:i.GeometryType.SolidLine,index:{buffer:new Uint32Array(n.indices).buffer,itemCount:1,type:"uint32",name:"index"},interleavedVertexAttributes:[{type:"float",stride:n.stride,buffer:new Float32Array(n.vertices).buffer,attributes:n.vertexAttributes}],vertexAttributes:[{name:"points",buffer:new Float32Array(s).buffer,itemCount:2,type:"float"}],groups:[{start:0,count:0,technique:t}]}}static createPolygonGeometry(e,t){const r=new c,{positions:n,indices:o,groups:s,featureStarts:u,featureIds:l,geojsonProperties:h}=r,d=[];for(const t of e.polygons){const e=n.length/3;if(t.holes.length)for(let e=0;e<t.holes.length;e++)e===t.holes.length-1?d[e]=t.vertices.slice(3*t.holes[e]):d[e]=t.vertices.slice(3*t.holes[e],3*t.holes[e+1]);u.push(o.length/3),l.push(0),h.push(t.geojsonProperties);for(let e=0;e<t.vertices.length;e+=3)n.push(t.vertices[e],t.vertices[e+1],t.vertices[e+2]);const r=a.default(t.vertices,t.holes,3);for(let t=0;t<r.length;t+=3){const i=r[t],n=r[t+1],s=r[t+2];o.push(i+e,n+e,s+e)}}o.length>0&&s.push({start:0,count:o.length,technique:t});const p={type:i.GeometryType.Polygon,vertexAttributes:[{name:"position",buffer:new Float32Array(r.positions).buffer,itemCount:3,type:"float"}],groups:r.groups};return r.indices.length>0&&(p.index={name:"index",buffer:new Uint32Array(r.indices).buffer,itemCount:1,type:"uint32"},p.featureStarts=r.featureStarts,p.featureIds=r.featureIds,p.objInfos=r.geojsonProperties),p}static createPolygonOutlineGeometry(e,t,r){const n=new c,{indices:s,featureStarts:a,featureIds:u,geojsonProperties:l}=n;let h;const d=[],p=new o.LineGroup,f=new Array;for(const t of e.polygons){if(h=t.holes.length?t.vertices.slice(0,3*t.holes[0]):t.vertices,this.addOutlineVertices(h,r,p,f),t.holes.length)for(let e=0;e<t.holes.length;e++)e===t.holes.length-1?d[e]=t.vertices.slice(3*t.holes[e]):d[e]=t.vertices.slice(3*t.holes[e],3*t.holes[e+1]),this.addOutlineVertices(d[e],r,p,f);a.push(s.length/3),u.push(0),l.push(t.geojsonProperties)}const m={type:i.GeometryType.SolidLine,index:{buffer:new Uint32Array(p.indices).buffer,itemCount:1,type:"uint32",name:"index"},interleavedVertexAttributes:[{type:"float",stride:p.stride,buffer:new Float32Array(p.vertices).buffer,attributes:p.vertexAttributes}],vertexAttributes:[{name:"points",buffer:new Float32Array(f).buffer,itemCount:2,type:"float"}],groups:[{start:0,count:0,technique:t}]};return n.indices.length>0&&(m.index={name:"index",buffer:new Uint32Array(n.indices).buffer,itemCount:1,type:"uint32"},m.featureStarts=n.featureStarts,m.featureIds=n.featureIds,m.objInfos=n.geojsonProperties),m}static createSegmentsGeometry(e,t){return{type:i.GeometryType.Line,vertexAttributes:[{name:"position",buffer:new Float32Array(e.points.vertices).buffer,itemCount:3,type:"float"}],groups:[{start:0,count:0,technique:t}]}}static addOutlineVertices(e,t,r,i){const n=new u.Vector3;let o=[];for(let s=0;s<e.length;s+=3)o.push(e[s],e[s+1],e[s+2]),(this.isOnTileBorder(e[s],t)&&this.isOnTileBorder(e[s+3],t)||this.isOnTileBorder(e[s+1],t)&&this.isOnTileBorder(e[s+4],t))&&(r.add(n,[...o]),i.push(...o),o=[]);r.add(n,[...o]),i.push(...o)}static isOnTileBorder(e,t){return t-Math.abs(e)<=.01}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2),n=r(20),o=r(3),s=r(1),a=r(0),u=r(117),l=s.LoggerManager.instance.create("GeoJsonFeatureParser");class c{constructor(){this.points={vertices:[],geojsonProperties:[]},this.lines={vertices:[],geojsonProperties:[]},this.polygons=[]}}t.GeometryData=c;class h{static processGeoJson(e,t,r,i,n,o){switch(e.type){case"Feature":this.processFeature(e,t,r,i,n,o);break;case"FeatureCollection":e.features.forEach(e=>this.processFeature(e,t,r,i,n,o));break;default:const s={type:"Feature",geometry:e};this.processFeature(s,t,r,i,n,o)}}static processFeature(e,t,r,n,o,s){if(null===e.geometry)return;let a=[];switch(e.geometry.type){case"Point":a=this.findTechniqueIndices(e,"point",o);for(const t of a){const a=o.techniques[t];i.isPoiTechnique(a)?this.processPois([e.geometry.coordinates],r,n,t,s.poiGeometryBuffer,e.properties):i.isTextTechnique(a)?this.processPointLabels([e.geometry.coordinates],r,n,t,a.label,s.textGeometryBuffer,e.properties):(i.isCirclesTechnique(a)||i.isSquaresTechnique(a))&&this.processPoints([e.geometry.coordinates],r,n,t,s.geometryBuffer,e.properties)}break;case"MultiPoint":a=this.findTechniqueIndices(e,"point",o);for(const t of a){const a=o.techniques[t];i.isPoiTechnique(a)?this.processPois(e.geometry.coordinates,r,n,t,s.poiGeometryBuffer,e.properties):i.isTextTechnique(a)?this.processPointLabels(e.geometry.coordinates,r,n,t,a.label,s.textGeometryBuffer,e.properties):(i.isCirclesTechnique(a)||i.isSquaresTechnique(a))&&this.processPoints(e.geometry.coordinates,r,n,t,s.geometryBuffer,e.properties)}break;case"LineString":a=this.findTechniqueIndices(e,"line",o);for(const u of a){const a=o.techniques[u];i.isSolidLineTechnique(a)?this.processLines(t,[e.geometry.coordinates],r,n,u,o,s.geometryBuffer,e.id,e.properties):i.isTextTechnique(a)?this.processLineLabels([e.geometry.coordinates],r,n,u,a.label,s.textPathGeometryBuffer,e.properties):i.isDashedLineTechnique(a)&&this.processDashedLines(t,[e.geometry.coordinates],r,n,u,o,s.geometryBuffer,e.id,e.properties)}break;case"MultiLineString":a=this.findTechniqueIndices(e,"line",o);for(const u of a){const a=o.techniques[u];i.isSolidLineTechnique(a)?this.processLines(t,e.geometry.coordinates,r,n,u,o,s.geometryBuffer,e.id,e.properties):i.isTextTechnique(a)&&this.processLineLabels(e.geometry.coordinates,r,n,u,a.label,s.textPathGeometryBuffer,e.properties)}break;case"Polygon":a=this.findTechniqueIndices(e,"polygon",o);for(const t of a){const a=o.techniques[t];i.isFillTechnique(a)||i.isSolidLineTechnique(a)?this.processPolygons([e.geometry.coordinates],r,n,t,s.geometryBuffer,i.isSolidLineTechnique(a),e.properties):i.isTextTechnique(a)&&this.processMultiPolygonLabels([e.geometry.coordinates],r,n,t,a.label,s.textGeometryBuffer,e.properties)}break;case"MultiPolygon":a=this.findTechniqueIndices(e,"polygon",o);for(const t of a){const a=o.techniques[t];i.isFillTechnique(a)||i.isSolidLineTechnique(a)?this.processPolygons(e.geometry.coordinates,r,n,t,s.geometryBuffer,i.isSolidLineTechnique(a),e.properties):i.isTextTechnique(a)&&this.processMultiPolygonLabels(e.geometry.coordinates,r,n,t,a.label,s.textGeometryBuffer,e.properties)}break;case"GeometryCollection":e.geometry.geometries.forEach(i=>{const a={type:"Feature",properties:e.properties,geometry:i};this.processFeature(a,t,r,n,o,s)});break;default:l.warn("Invalid GeoJSON data. Unknown geometry type.")}}static processPoints(e,t,r,i,n,o){const s=this.findOrCreateGeometryBuffer(i,n);s.type="point";for(const i of e){this.m_cached_geoCoord.latitude=i[1],this.m_cached_geoCoord.longitude=i[0],r.projectPoint(this.m_cached_geoCoord,this.m_cached_worldCoord).sub(t),s.points.vertices.push(this.m_cached_worldCoord.x,this.m_cached_worldCoord.y,this.m_cached_worldCoord.z);const e=s.points.vertices.length/3-1;s.points.geojsonProperties[e]=o}}static processLines(e,t,r,i,o,s,a,u,c){const h=this.findOrCreateGeometryBuffer(o,a);h.type="solid-line";for(const e of t){h.lines.geojsonProperties.push(c);const t=[];for(const n of e){if(null===n||null===n[0]||void 0===n[0])return;this.m_cached_geoCoord.latitude=n[1],this.m_cached_geoCoord.longitude=n[0],i.projectPoint(this.m_cached_geoCoord,this.m_cached_worldCoord).sub(r),t.push(this.m_cached_worldCoord.x,this.m_cached_worldCoord.y,this.m_cached_worldCoord.z)}h.lines.vertices.push(t)}const d={};void 0!==u&&(d.featureId=u);const p=new n.MapEnv(Object.assign({type:"line"},d)),f=s.getMatchingTechniques(p);h.lines.vertices.length===h.lines.geojsonProperties.length?this.addTileInfo(e,f,h.lines.vertices,0,p,h.lines.geojsonProperties):l.log("The amount of lines and the amount of geo properties has to be the same")}static processDashedLines(e,t,r,i,o,s,a,u,c){const h=this.findOrCreateGeometryBuffer(o,a);h.type="dashed-line";for(const e of t){h.lines.geojsonProperties.push(c);const t=[];for(const n of e){if(null===n||null===n[0]||void 0===n[0])return;this.m_cached_geoCoord.latitude=n[1],this.m_cached_geoCoord.longitude=n[0],i.projectPoint(this.m_cached_geoCoord,this.m_cached_worldCoord).sub(r),t.push(this.m_cached_worldCoord.x,this.m_cached_worldCoord.y,this.m_cached_worldCoord.z)}h.lines.vertices.push(t)}const d={};void 0!==u&&(d.featureId=u);const p=new n.MapEnv(Object.assign({type:"line"},d)),f=s.getMatchingTechniques(p);h.lines.vertices.length===h.lines.geojsonProperties.length?this.addTileInfo(e,f,h.lines.vertices,0,p,h.lines.geojsonProperties):l.log("The amount of lines and the amount of geo properties has to be the same")}static processPolygons(e,t,r,i,n,o,s){const a=this.findOrCreateGeometryBuffer(i,n);a.type=o?"outline":"polygon";for(const i of e){const e=[],n=[];for(const o of i){if(null===o[0]||"number"!=typeof o[0][0])return;e.length&&n.push(e.length/3);for(const i of o)this.m_cached_geoCoord.latitude=i[1],this.m_cached_geoCoord.longitude=i[0],r.projectPoint(this.m_cached_geoCoord,this.m_cached_worldCoord).sub(t),i[0]>=180&&(this.m_cached_worldCoord.x=-1*this.m_cached_worldCoord.x),e.push(this.m_cached_worldCoord.x,this.m_cached_worldCoord.y,this.m_cached_worldCoord.z)}a.polygons.push({vertices:e,holes:n,geojsonProperties:s})}}static processLineLabels(e,t,r,i,n,o,s){const a=this.findOrCreateGeometryBuffer(i,o);a.type="text-path",a.labelProperty=n;const u=[];for(const i of e)for(const e of i)this.m_cached_geoCoord.latitude=e[1],this.m_cached_geoCoord.longitude=e[0],r.projectPoint(this.m_cached_geoCoord,this.m_cached_worldCoord).sub(t),u.push(this.m_cached_worldCoord.x,this.m_cached_worldCoord.y,this.m_cached_worldCoord.z);a.lines.vertices.push(u),a.lines.geojsonProperties.push(s)}static processMultiPolygonLabels(e,t,r,i,n,o,s){const a=this.findOrCreateGeometryBuffer(i,o);a.type="point",a.labelProperty=n;const u={x:[],y:[],z:[]};for(const i of e)for(const e of i)for(const i of e)this.m_cached_geoCoord.latitude=i[1],this.m_cached_geoCoord.longitude=i[0],r.projectPoint(this.m_cached_geoCoord,this.m_cached_worldCoord).sub(t),u.x.push(this.m_cached_worldCoord.x),u.y.push(this.m_cached_worldCoord.y),u.z.push(this.m_cached_worldCoord.z);const l=u.x.length;this.m_cached_worldCoord.setX(u.x.reduce((e,t)=>e+t)/l),this.m_cached_worldCoord.setY(u.y.reduce((e,t)=>e+t)/l),this.m_cached_worldCoord.setZ(u.z.reduce((e,t)=>e+t)/l),a.points.vertices.push(this.m_cached_worldCoord.x,this.m_cached_worldCoord.y,this.m_cached_worldCoord.z),a.points.geojsonProperties.push(s)}static processPointLabels(e,t,r,i,n,o,s){const a=this.findOrCreateGeometryBuffer(i,o);a.type="text",a.labelProperty=n;for(const i of e){this.m_cached_geoCoord.latitude=i[1],this.m_cached_geoCoord.longitude=i[0],r.projectPoint(this.m_cached_geoCoord,this.m_cached_worldCoord).sub(t),a.points.vertices.push(this.m_cached_worldCoord.x,this.m_cached_worldCoord.y,this.m_cached_worldCoord.z);const e=a.points.vertices.length/3-1;a.points.geojsonProperties[e]=s}}static processPois(e,t,r,i,n,o){const s=this.findOrCreateGeometryBuffer(i,n);s.type="poi";for(const i of e){this.m_cached_geoCoord.latitude=i[1],this.m_cached_geoCoord.longitude=i[0],r.projectPoint(this.m_cached_geoCoord,this.m_cached_worldCoord).sub(t),s.points.vertices.push(this.m_cached_worldCoord.x,this.m_cached_worldCoord.y,this.m_cached_worldCoord.z);const e=s.points.vertices.length/3-1;s.points.geojsonProperties[e]=o}}static findTechniqueIndices(e,t,r){const i=u.Flattener.flatten(e.properties,"properties");i.featureId=e.id;const o=new n.MapEnv(Object.assign({type:t},i));return r.getMatchingTechniques(o).map(e=>e._index)}static addTileInfo(e,t,r,n,o,s){if(s.length!==r.length)return void l.error("geojsonProperties and lines should have the same lenght");const a=e.writer;for(const u of t){if(void 0===u)continue;const t=a.addTechnique(u);let l=0;for(const c of r){const r=e.info.lineGroup;void 0===r.userData?r.userData=[s[l]]:r.userData.push(s[l]),l++;const h=i.ExtendedTileInfo.getFeatureText(o,u);a.addFeature(e.info.lineGroup,o,n,h,t,i.FeatureGroupType.Line),a.addFeaturePoints(e.info.lineGroup,c)}if(this.m_gatherRoadSegments){const t=o.lookup("segmentId");if(void 0!==t){const r=o.lookup("startOffset"),i=o.lookup("endOffset");a.addRoadSegments(e.info.lineGroup,t,void 0!==r?r:0,void 0!==i?i:1)}}}}static findOrCreateGeometryBuffer(e,t){let r=t.get(e);return void 0!==r?r:(r=new c,t.set(e,r),r)}}t.GeoJsonParser=h,h.m_cached_worldCoord=new a.Vector3,h.m_cached_geoCoord=new o.GeoCoordinates(0,0),h.m_gatherRoadSegments=!0},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Flattener=class{static flatten(e,t=""){const r={};return this.processObject(e,r,t),r}static processObject(e,t,r){for(const i in e)if(void 0!==e[i]){const n=r.length?r+"."+i:i;this.processValue(e[i],t,n)}}static processArray(e,t,r){for(let i=0;i<e.length;i++){const n=`${r}[${i}]`;this.processValue(e[i],t,n)}}static processValue(e,t,r){["number","string","boolean"].indexOf(typeof e)>-1||null===e?t[r]=e:Array.isArray(e)?this.processArray(e,t,r):this.processObject(e,t,r)}}},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(28)),i(r(145)),i(r(15))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(20),n=r(120),o=r(0),s=r(15),a=r(22),u=r(121);var l;function c(e){return e.kind===l.MoveTo}function h(e){return e.kind===l.LineTo}function d(e){return e.kind===l.ClosePath}function p(e,t){if(e.layers)for(const r of e.layers)t.visitLayer&&!t.visitLayer(r)||f(r,t),t.endVisitLayer&&t.endVisitLayer(r)}function f(e,t){if((!t.visitLayer||t.visitLayer(e))&&e.features)for(const r of e.features)switch(r.type){case u.com.mapbox.pb.Tile.GeomType.UNKNOWN:break;case u.com.mapbox.pb.Tile.GeomType.POINT:t.visitPointFeature&&t.visitPointFeature(r);break;case u.com.mapbox.pb.Tile.GeomType.LINESTRING:t.visitLineFeature&&t.visitLineFeature(r);break;case u.com.mapbox.pb.Tile.GeomType.POLYGON:t.visitPolygonFeature&&t.visitPolygonFeature(r)}t.endVisitLayer&&t.endVisitLayer(e)}!function(e){e[e.MoveTo=1]="MoveTo",e[e.LineTo=2]="LineTo",e[e.ClosePath=7]="ClosePath"}(l=t.CommandKind||(t.CommandKind={})),t.isMoveToCommand=c,t.isLineToCommand=h,t.isClosePathCommand=d,t.visitOmv=p,t.visitOmvLayer=f;class m{accept(e,t,r){const{keys:i,values:n}=e,o=t.tags;if(o&&i&&n)for(let e=0;e<o.length;e+=2){const t=i[o[e]],s=n[o[e+1]];if(!r.visitAttribute(t,s))break}}}t.FeatureAttributes=m;class g{accept(e,t){const r=e.length;let i=0,n=0;const s=[],a=[],u=[];for(let c=0;c<r;){const r=7&e[c],h=e[c]>>3;if(++c,r===l.MoveTo||r===l.LineTo)for(let l=0;l<h;++l){const l=e[c++],h=e[c++];i+=l>>1^-(1&l),n+=h>>1^-(1&h),"Polygon"===t.type&&(s.push(i),a.push(n));const d=new o.Vector2(i,n);u.push({kind:r,position:d})}else{for(const e of u)t.visitCommand(e);t.visitCommand({kind:r}),s.length=0,a.length=0,u.length=0}}if(u.length>0)for(const e of u)t.visitCommand(e)}}t.GeometryCommands=g;const y=["stringValue","floatValue","doubleValue","intValue","uintValue","sintValue","boolValue"];function v(e,t,r={}){const i=new m,o=r||{};return i.accept(e,t,{visitAttribute:(e,t)=>(o[function(e){switch(e){case"id":return"$id";default:return e}}(e)]=function(e){const t=Object.prototype.hasOwnProperty;for(const r of y)if(t.call(e,r)){const t=e[r];if(void 0===t)throw new Error("unpexted undefined value");return n.isLong(t)?t.toNumber():t}throw new Error("not happening")}(t),!0)}),o}function x(e,t,r,o,s,a,u){const l={$layer:e.name,$level:o,$zoom:Math.max(0,o-(s||0)),$geometryType:r};if(void 0!==t.id){const e=function(e,t){if(void 0!==e.id){if("number"==typeof e.id)return e.id;if(n.isLong(e.id))return e.id.greaterThan(Number.MAX_SAFE_INTEGER)&&void 0!==t&&t.error("Invalid ID: Larger than largest available Number in feature: ",e),e.id.toNumber()}}(t,a);void 0!==e&&(l.$id=e)}return v(e,t,l),new i.MapEnv(l,u)}function b(e){if(void 0===e)return s.OmvGeometryType.UNKNOWN;switch(e.type){case u.com.mapbox.pb.Tile.GeomType.UNKNOWN:return s.OmvGeometryType.UNKNOWN;case u.com.mapbox.pb.Tile.GeomType.POINT:return s.OmvGeometryType.POINT;case u.com.mapbox.pb.Tile.GeomType.LINESTRING:return s.OmvGeometryType.LINESTRING;case u.com.mapbox.pb.Tile.GeomType.POLYGON:return s.OmvGeometryType.POLYGON;default:return s.OmvGeometryType.UNKNOWN}}t.OmvProtobufDataAdapter=class{constructor(e,t,r){this.id="omv-protobuf",this.m_geometryCommands=new g,this.m_processor=e,this.m_dataFilter=t,this.m_logger=r}get dataFilter(){return this.m_dataFilter}set dataFilter(e){this.m_dataFilter=e}canProcess(e){return a.isArrayBufferLike(e)}process(e,t){const r=new Uint8Array(e),i=u.com.mapbox.pb.Tile.decode(r);this.m_tileKey=t,p(i,this)}visitLayer(e){this.m_layer=e;const t=this.m_tileKey.level,r=e.name;return!(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsLayer(r,t))}visitPointFeature(e){if(void 0===e.geometry)return;const t=this.m_tileKey.level,r=this.m_layer.name,i=this.m_layer.extent||4096;if(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsPointFeature(r,b(e),t))return;const n=[];if(this.m_geometryCommands.accept(e.geometry,{type:"Point",visitCommand:e=>{c(e)&&n.push(e.position)}}),0===n.length)return;const o=x(this.m_layer,e,"point",t,this.m_processor.storageLevelOffset,this.m_logger);this.m_processor.processPointFeature(r,i,n,o,t)}visitLineFeature(e){if(void 0===e.geometry)return;const t=this.m_tileKey.level,r=this.m_layer.name,i=this.m_layer.extent||4096;if(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsLineFeature(r,b(e),t))return;const n=[];let o;if(this.m_geometryCommands.accept(e.geometry,{type:"Line",visitCommand:e=>{c(e)?(o=[e.position],n.push({positions:o})):h(e)&&o.push(e.position)}}),0===n.length)return;const s=x(this.m_layer,e,"line",t,this.m_processor.storageLevelOffset,this.m_logger);this.m_processor.processLineFeature(r,i,n,s,t)}visitPolygonFeature(e){if(void 0===e.geometry)return;const t=this.m_tileKey.level,r=this.m_layer.name,i=this.m_layer.extent||4096;if(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsPolygonFeature(r,b(e),t))return;const n=[],o={rings:[]};let s;if(this.m_geometryCommands.accept(e.geometry,{type:"Polygon",visitCommand:e=>{c(e)?s=[e.position]:h(e)?s.push(e.position):d(e)&&o.rings.push(s)}}),o.rings.length>0&&n.push(o),0===n.length)return;const a=x(this.m_layer,e,"polygon",t,this.m_processor.storageLevelOffset,this.m_logger);this.m_processor.processPolygonFeature(r,i,n,a,t)}}},function(e,t){e.exports=i;var r=null;try{r=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function i(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function n(e){return!0===(e&&e.__isLong__)}i.prototype.__isLong__,Object.defineProperty(i.prototype,"__isLong__",{value:!0}),i.isLong=n;var o={},s={};function a(e,t){var r,i,n;return t?(n=0<=(e>>>=0)&&e<256)&&(i=s[e])?i:(r=l(e,(0|e)<0?-1:0,!0),n&&(s[e]=r),r):(n=-128<=(e|=0)&&e<128)&&(i=o[e])?i:(r=l(e,e<0?-1:0,!1),n&&(o[e]=r),r)}function u(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=f)return _}else{if(e<=-m)return S;if(e+1>=m)return T}return e<0?u(-e,t).neg():l(e%p|0,e/p|0,t)}function l(e,t,r){return new i(e,t,r)}i.fromInt=a,i.fromNumber=u,i.fromBits=l;var c=Math.pow;function h(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return y;if("number"==typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return h(e.substring(1),t,r).neg();for(var n=u(c(r,8)),o=y,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),l=parseInt(e.substring(s,s+a),r);if(a<8){var d=u(c(r,a));o=o.mul(d).add(u(l))}else o=(o=o.mul(n)).add(u(l))}return o.unsigned=t,o}function d(e,t){return"number"==typeof e?u(e,t):"string"==typeof e?h(e,t):l(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}i.fromString=h,i.fromValue=d;var p=4294967296,f=p*p,m=f/2,g=a(1<<24),y=a(0);i.ZERO=y;var v=a(0,!0);i.UZERO=v;var x=a(1);i.ONE=x;var b=a(1,!0);i.UONE=b;var w=a(-1);i.NEG_ONE=w;var T=l(-1,2147483647,!1);i.MAX_VALUE=T;var _=l(-1,-1,!0);i.MAX_UNSIGNED_VALUE=_;var S=l(0,-2147483648,!1);i.MIN_VALUE=S;var E=i.prototype;E.toInt=function(){return this.unsigned?this.low>>>0:this.low},E.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},E.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=u(e),r=this.div(t),i=r.mul(t).sub(this);return r.toString(e)+i.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var n=u(c(e,6),this.unsigned),o=this,s="";;){var a=o.div(n),l=(o.sub(a.mul(n)).toInt()>>>0).toString(e);if((o=a).isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}},E.getHighBits=function(){return this.high},E.getHighBitsUnsigned=function(){return this.high>>>0},E.getLowBits=function(){return this.low},E.getLowBitsUnsigned=function(){return this.low>>>0},E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},E.isZero=function(){return 0===this.high&&0===this.low},E.eqz=E.isZero,E.isNegative=function(){return!this.unsigned&&this.high<0},E.isPositive=function(){return this.unsigned||this.high>=0},E.isOdd=function(){return 1==(1&this.low)},E.isEven=function(){return 0==(1&this.low)},E.equals=function(e){return n(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},E.eq=E.equals,E.notEquals=function(e){return!this.eq(e)},E.neq=E.notEquals,E.ne=E.notEquals,E.lessThan=function(e){return this.comp(e)<0},E.lt=E.lessThan,E.lessThanOrEqual=function(e){return this.comp(e)<=0},E.lte=E.lessThanOrEqual,E.le=E.lessThanOrEqual,E.greaterThan=function(e){return this.comp(e)>0},E.gt=E.greaterThan,E.greaterThanOrEqual=function(e){return this.comp(e)>=0},E.gte=E.greaterThanOrEqual,E.ge=E.greaterThanOrEqual,E.compare=function(e){if(n(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},E.comp=E.compare,E.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(x)},E.neg=E.negate,E.add=function(e){n(e)||(e=d(e));var t=this.high>>>16,r=65535&this.high,i=this.low>>>16,o=65535&this.low,s=e.high>>>16,a=65535&e.high,u=e.low>>>16,c=0,h=0,p=0,f=0;return p+=(f+=o+(65535&e.low))>>>16,h+=(p+=i+u)>>>16,c+=(h+=r+a)>>>16,c+=t+s,l((p&=65535)<<16|(f&=65535),(c&=65535)<<16|(h&=65535),this.unsigned)},E.subtract=function(e){return n(e)||(e=d(e)),this.add(e.neg())},E.sub=E.subtract,E.multiply=function(e){if(this.isZero())return y;if(n(e)||(e=d(e)),r)return l(r.mul(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned);if(e.isZero())return y;if(this.eq(S))return e.isOdd()?S:y;if(e.eq(S))return this.isOdd()?S:y;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return u(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,i=65535&this.high,o=this.low>>>16,s=65535&this.low,a=e.high>>>16,c=65535&e.high,h=e.low>>>16,p=65535&e.low,f=0,m=0,v=0,x=0;return v+=(x+=s*p)>>>16,m+=(v+=o*p)>>>16,v&=65535,m+=(v+=s*h)>>>16,f+=(m+=i*p)>>>16,m&=65535,f+=(m+=o*h)>>>16,m&=65535,f+=(m+=s*c)>>>16,f+=t*p+i*h+o*c+s*a,l((v&=65535)<<16|(x&=65535),(f&=65535)<<16|(m&=65535),this.unsigned)},E.mul=E.multiply,E.divide=function(e){if(n(e)||(e=d(e)),e.isZero())throw Error("division by zero");var t,i,o;if(r)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?r.div_u:r.div_s)(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return b;o=v}else{if(this.eq(S))return e.eq(x)||e.eq(w)?S:e.eq(S)?x:(t=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?x:w:(i=this.sub(e.mul(t)),o=t.add(i.div(e)));if(e.eq(S))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=y}for(i=this;i.gte(e);){t=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(t)/Math.LN2),a=s<=48?1:c(2,s-48),h=u(t),p=h.mul(e);p.isNegative()||p.gt(i);)p=(h=u(t-=a,this.unsigned)).mul(e);h.isZero()&&(h=x),o=o.add(h),i=i.sub(p)}return o},E.div=E.divide,E.modulo=function(e){return n(e)||(e=d(e)),r?l((this.unsigned?r.rem_u:r.rem_s)(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},E.mod=E.modulo,E.rem=E.modulo,E.not=function(){return l(~this.low,~this.high,this.unsigned)},E.and=function(e){return n(e)||(e=d(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},E.or=function(e){return n(e)||(e=d(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},E.xor=function(e){return n(e)||(e=d(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},E.shiftLeft=function(e){return n(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},E.shl=E.shiftLeft,E.shiftRight=function(e){return n(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},E.shr=E.shiftRight,E.shiftRightUnsigned=function(e){if(n(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?l(this.low>>>e|t<<32-e,t>>>e,this.unsigned):l(32===e?t:t>>>e-32,0,this.unsigned)},E.shru=E.shiftRightUnsigned,E.shr_u=E.shiftRightUnsigned,E.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},E.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},E.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},E.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},E.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},i.fromBytes=function(e,t,r){return r?i.fromBytesLE(e,t):i.fromBytesBE(e,t)},i.fromBytesLE=function(e,t){return new i(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},i.fromBytesBE=function(e,t){return new i(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},function(e,t,r){"use strict";var i,n,o,s=r(122),a=s.Reader,u=s.util,l=s.roots.default||(s.roots.default={});l.com=((o={}).mapbox=((n={}).pb=((i={}).Tile=function(){function e(e){if(this.layers=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var t,r;return e.prototype.layers=u.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var r=void 0===t?e.len:e.pos+t,i=new l.com.mapbox.pb.Tile;e.pos<r;){var n=e.uint32();switch(n>>>3){case 3:i.layers&&i.layers.length||(i.layers=[]),i.layers.push(l.com.mapbox.pb.Tile.Layer.decode(e,e.uint32()));break;default:e.skipType(7&n)}}return i},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof l.com.mapbox.pb.Tile)return e;var t=new l.com.mapbox.pb.Tile;if(e.layers){if(!Array.isArray(e.layers))throw TypeError(".com.mapbox.pb.Tile.layers: array expected");t.layers=[];for(var r=0;r<e.layers.length;++r){if("object"!=typeof e.layers[r])throw TypeError(".com.mapbox.pb.Tile.layers: object expected");t.layers[r]=l.com.mapbox.pb.Tile.Layer.fromObject(e.layers[r])}}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.layers=[]),e.layers&&e.layers.length){r.layers=[];for(var i=0;i<e.layers.length;++i)r.layers[i]=l.com.mapbox.pb.Tile.Layer.toObject(e.layers[i],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e.GeomType=(t={},(r=Object.create(t))[t[0]="UNKNOWN"]=0,r[t[1]="POINT"]=1,r[t[2]="LINESTRING"]=2,r[t[3]="POLYGON"]=3,r),e.Value=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.stringValue="",e.prototype.floatValue=0,e.prototype.doubleValue=0,e.prototype.intValue=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.uintValue=u.Long?u.Long.fromBits(0,0,!0):0,e.prototype.sintValue=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.boolValue=!1,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var r=void 0===t?e.len:e.pos+t,i=new l.com.mapbox.pb.Tile.Value;e.pos<r;){var n=e.uint32();switch(n>>>3){case 1:i.stringValue=e.string();break;case 2:i.floatValue=e.float();break;case 3:i.doubleValue=e.double();break;case 4:i.intValue=e.int64();break;case 5:i.uintValue=e.uint64();break;case 6:i.sintValue=e.sint64();break;case 7:i.boolValue=e.bool();break;default:e.skipType(7&n)}}return i},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof l.com.mapbox.pb.Tile.Value)return e;var t=new l.com.mapbox.pb.Tile.Value;return null!=e.stringValue&&(t.stringValue=String(e.stringValue)),null!=e.floatValue&&(t.floatValue=Number(e.floatValue)),null!=e.doubleValue&&(t.doubleValue=Number(e.doubleValue)),null!=e.intValue&&(u.Long?(t.intValue=u.Long.fromValue(e.intValue)).unsigned=!1:"string"==typeof e.intValue?t.intValue=parseInt(e.intValue,10):"number"==typeof e.intValue?t.intValue=e.intValue:"object"==typeof e.intValue&&(t.intValue=new u.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber())),null!=e.uintValue&&(u.Long?(t.uintValue=u.Long.fromValue(e.uintValue)).unsigned=!0:"string"==typeof e.uintValue?t.uintValue=parseInt(e.uintValue,10):"number"==typeof e.uintValue?t.uintValue=e.uintValue:"object"==typeof e.uintValue&&(t.uintValue=new u.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0))),null!=e.sintValue&&(u.Long?(t.sintValue=u.Long.fromValue(e.sintValue)).unsigned=!1:"string"==typeof e.sintValue?t.sintValue=parseInt(e.sintValue,10):"number"==typeof e.sintValue?t.sintValue=e.sintValue:"object"==typeof e.sintValue&&(t.sintValue=new u.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber())),null!=e.boolValue&&(t.boolValue=Boolean(e.boolValue)),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if(r.stringValue="",r.floatValue=0,r.doubleValue=0,u.Long){var i=new u.Long(0,0,!1);r.intValue=t.longs===String?i.toString():t.longs===Number?i.toNumber():i}else r.intValue=t.longs===String?"0":0;u.Long?(i=new u.Long(0,0,!0),r.uintValue=t.longs===String?i.toString():t.longs===Number?i.toNumber():i):r.uintValue=t.longs===String?"0":0,u.Long?(i=new u.Long(0,0,!1),r.sintValue=t.longs===String?i.toString():t.longs===Number?i.toNumber():i):r.sintValue=t.longs===String?"0":0,r.boolValue=!1}return null!=e.stringValue&&e.hasOwnProperty("stringValue")&&(r.stringValue=e.stringValue),null!=e.floatValue&&e.hasOwnProperty("floatValue")&&(r.floatValue=t.json&&!isFinite(e.floatValue)?String(e.floatValue):e.floatValue),null!=e.doubleValue&&e.hasOwnProperty("doubleValue")&&(r.doubleValue=t.json&&!isFinite(e.doubleValue)?String(e.doubleValue):e.doubleValue),null!=e.intValue&&e.hasOwnProperty("intValue")&&("number"==typeof e.intValue?r.intValue=t.longs===String?String(e.intValue):e.intValue:r.intValue=t.longs===String?u.Long.prototype.toString.call(e.intValue):t.longs===Number?new u.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber():e.intValue),null!=e.uintValue&&e.hasOwnProperty("uintValue")&&("number"==typeof e.uintValue?r.uintValue=t.longs===String?String(e.uintValue):e.uintValue:r.uintValue=t.longs===String?u.Long.prototype.toString.call(e.uintValue):t.longs===Number?new u.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0):e.uintValue),null!=e.sintValue&&e.hasOwnProperty("sintValue")&&("number"==typeof e.sintValue?r.sintValue=t.longs===String?String(e.sintValue):e.sintValue:r.sintValue=t.longs===String?u.Long.prototype.toString.call(e.sintValue):t.longs===Number?new u.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber():e.sintValue),null!=e.boolValue&&e.hasOwnProperty("boolValue")&&(r.boolValue=e.boolValue),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e}(),e.Feature=function(){function e(e){if(this.tags=[],this.geometry=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id=u.Long?u.Long.fromBits(0,0,!0):0,e.prototype.tags=u.emptyArray,e.prototype.type=0,e.prototype.geometry=u.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var r=void 0===t?e.len:e.pos+t,i=new l.com.mapbox.pb.Tile.Feature;e.pos<r;){var n=e.uint32();switch(n>>>3){case 1:i.id=e.uint64();break;case 2:if(i.tags&&i.tags.length||(i.tags=[]),2==(7&n))for(var o=e.uint32()+e.pos;e.pos<o;)i.tags.push(e.uint32());else i.tags.push(e.uint32());break;case 3:i.type=e.int32();break;case 4:if(i.geometry&&i.geometry.length||(i.geometry=[]),2==(7&n))for(o=e.uint32()+e.pos;e.pos<o;)i.geometry.push(e.uint32());else i.geometry.push(e.uint32());break;default:e.skipType(7&n)}}return i},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof l.com.mapbox.pb.Tile.Feature)return e;var t=new l.com.mapbox.pb.Tile.Feature;if(null!=e.id&&(u.Long?(t.id=u.Long.fromValue(e.id)).unsigned=!0:"string"==typeof e.id?t.id=parseInt(e.id,10):"number"==typeof e.id?t.id=e.id:"object"==typeof e.id&&(t.id=new u.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0))),e.tags){if(!Array.isArray(e.tags))throw TypeError(".com.mapbox.pb.Tile.Feature.tags: array expected");t.tags=[];for(var r=0;r<e.tags.length;++r)t.tags[r]=e.tags[r]>>>0}switch(e.type){case"UNKNOWN":case 0:t.type=0;break;case"POINT":case 1:t.type=1;break;case"LINESTRING":case 2:t.type=2;break;case"POLYGON":case 3:t.type=3}if(e.geometry){if(!Array.isArray(e.geometry))throw TypeError(".com.mapbox.pb.Tile.Feature.geometry: array expected");for(t.geometry=[],r=0;r<e.geometry.length;++r)t.geometry[r]=e.geometry[r]>>>0}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.tags=[],r.geometry=[]),t.defaults){if(u.Long){var i=new u.Long(0,0,!0);r.id=t.longs===String?i.toString():t.longs===Number?i.toNumber():i}else r.id=t.longs===String?"0":0;r.type=t.enums===String?"UNKNOWN":0}if(null!=e.id&&e.hasOwnProperty("id")&&("number"==typeof e.id?r.id=t.longs===String?String(e.id):e.id:r.id=t.longs===String?u.Long.prototype.toString.call(e.id):t.longs===Number?new u.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0):e.id),e.tags&&e.tags.length){r.tags=[];for(var n=0;n<e.tags.length;++n)r.tags[n]=e.tags[n]}if(null!=e.type&&e.hasOwnProperty("type")&&(r.type=t.enums===String?l.com.mapbox.pb.Tile.GeomType[e.type]:e.type),e.geometry&&e.geometry.length)for(r.geometry=[],n=0;n<e.geometry.length;++n)r.geometry[n]=e.geometry[n];return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e}(),e.Layer=function(){function e(e){if(this.features=[],this.keys=[],this.values=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.version=1,e.prototype.name="",e.prototype.features=u.emptyArray,e.prototype.keys=u.emptyArray,e.prototype.values=u.emptyArray,e.prototype.extent=4096,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var r=void 0===t?e.len:e.pos+t,i=new l.com.mapbox.pb.Tile.Layer;e.pos<r;){var n=e.uint32();switch(n>>>3){case 15:i.version=e.uint32();break;case 1:i.name=e.string();break;case 2:i.features&&i.features.length||(i.features=[]),i.features.push(l.com.mapbox.pb.Tile.Feature.decode(e,e.uint32()));break;case 3:i.keys&&i.keys.length||(i.keys=[]),i.keys.push(e.string());break;case 4:i.values&&i.values.length||(i.values=[]),i.values.push(l.com.mapbox.pb.Tile.Value.decode(e,e.uint32()));break;case 5:i.extent=e.uint32();break;default:e.skipType(7&n)}}if(!i.hasOwnProperty("version"))throw u.ProtocolError("missing required 'version'",{instance:i});if(!i.hasOwnProperty("name"))throw u.ProtocolError("missing required 'name'",{instance:i});return i},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof l.com.mapbox.pb.Tile.Layer)return e;var t=new l.com.mapbox.pb.Tile.Layer;if(null!=e.version&&(t.version=e.version>>>0),null!=e.name&&(t.name=String(e.name)),e.features){if(!Array.isArray(e.features))throw TypeError(".com.mapbox.pb.Tile.Layer.features: array expected");t.features=[];for(var r=0;r<e.features.length;++r){if("object"!=typeof e.features[r])throw TypeError(".com.mapbox.pb.Tile.Layer.features: object expected");t.features[r]=l.com.mapbox.pb.Tile.Feature.fromObject(e.features[r])}}if(e.keys){if(!Array.isArray(e.keys))throw TypeError(".com.mapbox.pb.Tile.Layer.keys: array expected");for(t.keys=[],r=0;r<e.keys.length;++r)t.keys[r]=String(e.keys[r])}if(e.values){if(!Array.isArray(e.values))throw TypeError(".com.mapbox.pb.Tile.Layer.values: array expected");for(t.values=[],r=0;r<e.values.length;++r){if("object"!=typeof e.values[r])throw TypeError(".com.mapbox.pb.Tile.Layer.values: object expected");t.values[r]=l.com.mapbox.pb.Tile.Value.fromObject(e.values[r])}}return null!=e.extent&&(t.extent=e.extent>>>0),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.features=[],r.keys=[],r.values=[]),t.defaults&&(r.name="",r.extent=4096,r.version=1),null!=e.name&&e.hasOwnProperty("name")&&(r.name=e.name),e.features&&e.features.length){r.features=[];for(var i=0;i<e.features.length;++i)r.features[i]=l.com.mapbox.pb.Tile.Feature.toObject(e.features[i],t)}if(e.keys&&e.keys.length)for(r.keys=[],i=0;i<e.keys.length;++i)r.keys[i]=e.keys[i];if(e.values&&e.values.length)for(r.values=[],i=0;i<e.values.length;++i)r.values[i]=l.com.mapbox.pb.Tile.Value.toObject(e.values[i],t);return null!=e.extent&&e.hasOwnProperty("extent")&&(r.extent=e.extent),null!=e.version&&e.hasOwnProperty("version")&&(r.version=e.version),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e}(),e}(),i),n),o),e.exports=l},function(e,t,r){"use strict";e.exports=r(123)},function(e,t,r){"use strict";var i=t;function n(){i.Reader._configure(i.BufferReader),i.util._configure()}i.build="minimal",i.Writer=r(51),i.BufferWriter=r(133),i.Reader=r(52),i.BufferReader=r(134),i.util=r(7),i.rpc=r(135),i.roots=r(137),i.configure=n,i.Writer._configure(i.BufferWriter),n()},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";e.exports=function(e,t){var r=new Array(arguments.length-1),i=0,n=2,o=!0;for(;n<arguments.length;)r[i++]=arguments[n++];return new Promise((function(n,s){r[i]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];n.apply(null,t)}};try{e.apply(t||null,r)}catch(e){o&&(o=!1,s(e))}}))}},function(e,t,r){"use strict";var i=t;i.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var n=new Array(64),o=new Array(123),s=0;s<64;)o[n[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;i.encode=function(e,t,r){for(var i,o=null,s=[],a=0,u=0;t<r;){var l=e[t++];switch(u){case 0:s[a++]=n[l>>2],i=(3&l)<<4,u=1;break;case 1:s[a++]=n[i|l>>4],i=(15&l)<<2,u=2;break;case 2:s[a++]=n[i|l>>6],s[a++]=n[63&l],u=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return u&&(s[a++]=n[i],s[a++]=61,1===u&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};i.decode=function(e,t,r){for(var i,n=r,s=0,a=0;a<e.length;){var u=e.charCodeAt(a++);if(61===u&&s>1)break;if(void 0===(u=o[u]))throw Error("invalid encoding");switch(s){case 0:i=u,s=1;break;case 1:t[r++]=i<<2|(48&u)>>4,i=u,s=2;break;case 2:t[r++]=(15&i)<<4|(60&u)>>2,i=u,s=3;break;case 3:t[r++]=(3&i)<<6|u,s=0}}if(1===s)throw Error("invalid encoding");return r-n},i.test=function(e){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(e)}},function(e,t,r){"use strict";function i(){this._listeners={}}e.exports=i,i.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},i.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this},i.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}},function(e,t,r){"use strict";function i(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),i=128===r[3];function n(e,i,n){t[0]=e,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3]}function o(e,i,n){t[0]=e,i[n]=r[3],i[n+1]=r[2],i[n+2]=r[1],i[n+3]=r[0]}function s(e,i){return r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],r[3]=e[i+3],t[0]}function a(e,i){return r[3]=e[i],r[2]=e[i+1],r[1]=e[i+2],r[0]=e[i+3],t[0]}e.writeFloatLE=i?n:o,e.writeFloatBE=i?o:n,e.readFloatLE=i?s:a,e.readFloatBE=i?a:s}():function(){function t(e,t,r,i){var n=t<0?1:0;if(n&&(t=-t),0===t)e(1/t>0?0:2147483648,r,i);else if(isNaN(t))e(2143289344,r,i);else if(t>34028234663852886e22)e((n<<31|2139095040)>>>0,r,i);else if(t<11754943508222875e-54)e((n<<31|Math.round(t/1401298464324817e-60))>>>0,r,i);else{var o=Math.floor(Math.log(t)/Math.LN2);e((n<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,r,i)}}function r(e,t,r){var i=e(t,r),n=2*(i>>31)+1,o=i>>>23&255,s=8388607&i;return 255===o?s?NaN:n*(1/0):0===o?1401298464324817e-60*n*s:n*Math.pow(2,o-150)*(s+8388608)}e.writeFloatLE=t.bind(null,n),e.writeFloatBE=t.bind(null,o),e.readFloatLE=r.bind(null,s),e.readFloatBE=r.bind(null,a)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),i=128===r[7];function n(e,i,n){t[0]=e,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3],i[n+4]=r[4],i[n+5]=r[5],i[n+6]=r[6],i[n+7]=r[7]}function o(e,i,n){t[0]=e,i[n]=r[7],i[n+1]=r[6],i[n+2]=r[5],i[n+3]=r[4],i[n+4]=r[3],i[n+5]=r[2],i[n+6]=r[1],i[n+7]=r[0]}function s(e,i){return r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],r[3]=e[i+3],r[4]=e[i+4],r[5]=e[i+5],r[6]=e[i+6],r[7]=e[i+7],t[0]}function a(e,i){return r[7]=e[i],r[6]=e[i+1],r[5]=e[i+2],r[4]=e[i+3],r[3]=e[i+4],r[2]=e[i+5],r[1]=e[i+6],r[0]=e[i+7],t[0]}e.writeDoubleLE=i?n:o,e.writeDoubleBE=i?o:n,e.readDoubleLE=i?s:a,e.readDoubleBE=i?a:s}():function(){function t(e,t,r,i,n,o){var s=i<0?1:0;if(s&&(i=-i),0===i)e(0,n,o+t),e(1/i>0?0:2147483648,n,o+r);else if(isNaN(i))e(0,n,o+t),e(2146959360,n,o+r);else if(i>17976931348623157e292)e(0,n,o+t),e((s<<31|2146435072)>>>0,n,o+r);else{var a;if(i<22250738585072014e-324)e((a=i/5e-324)>>>0,n,o+t),e((s<<31|a/4294967296)>>>0,n,o+r);else{var u=Math.floor(Math.log(i)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(a=i*Math.pow(2,-u))>>>0,n,o+t),e((s<<31|u+1023<<20|1048576*a&1048575)>>>0,n,o+r)}}}function r(e,t,r,i,n){var o=e(i,n+t),s=e(i,n+r),a=2*(s>>31)+1,u=s>>>20&2047,l=4294967296*(1048575&s)+o;return 2047===u?l?NaN:a*(1/0):0===u?5e-324*a*l:a*Math.pow(2,u-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,n,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=r.bind(null,s,0,4),e.readDoubleBE=r.bind(null,a,4,0)}(),e}function n(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function o(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function s(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=i(i)},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(e,t,r){"use strict";var i=t;i.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)(r=e.charCodeAt(i))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(i+1))?(++i,t+=4):t+=3;return t},i.read=function(e,t,r){if(r-t<1)return"";for(var i,n=null,o=[],s=0;t<r;)(i=e[t++])<128?o[s++]=i:i>191&&i<224?o[s++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(i>>10),o[s++]=56320+(1023&i)):o[s++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,o)),s=0);return n?(s&&n.push(String.fromCharCode.apply(String,o.slice(0,s))),n.join("")):String.fromCharCode.apply(String,o.slice(0,s))},i.write=function(e,t,r){for(var i,n,o=r,s=0;s<e.length;++s)(i=e.charCodeAt(s))<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=63&i|128):55296==(64512&i)&&56320==(64512&(n=e.charCodeAt(s+1)))?(i=65536+((1023&i)<<10)+(1023&n),++s,t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=63&i|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=63&i|128);return r-o}},function(e,t,r){"use strict";e.exports=function(e,t,r){var i=r||8192,n=i>>>1,o=null,s=i;return function(r){if(r<1||r>n)return e(r);s+r>i&&(o=e(i),s=0);var a=t.call(o,s,s+=r);return 7&s&&(s=1+(7|s)),a}}},function(e,t,r){"use strict";e.exports=n;var i=r(7);function n(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=n.zero=new n(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var s=n.zeroHash="\0\0\0\0\0\0\0\0";n.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new n(r,i)},n.from=function(e){if("number"==typeof e)return n.fromNumber(e);if(i.isString(e)){if(!i.Long)return n.fromNumber(parseInt(e,10));e=i.Long.fromString(e)}return e.low||e.high?new n(e.low>>>0,e.high>>>0):o},n.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},n.prototype.toLong=function(e){return i.Long?new i.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;n.fromHash=function(e){return e===s?o:new n((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},n.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},n.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},n.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},n.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},function(e,t,r){"use strict";e.exports=s;var i=r(51);(s.prototype=Object.create(i.prototype)).constructor=s;var n=r(7),o=n.Buffer;function s(){i.call(this)}s.alloc=function(e){return(s.alloc=n._Buffer_allocUnsafe)(e)};var a=o&&o.prototype instanceof Uint8Array&&"set"===o.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]};function u(e,t,r){e.length<40?n.utf8.write(e,t,r):t.utf8Write(e,r)}s.prototype.bytes=function(e){n.isString(e)&&(e=n._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(a,t,e),this},s.prototype.string=function(e){var t=o.byteLength(e);return this.uint32(t),t&&this._push(u,t,e),this}},function(e,t,r){"use strict";e.exports=o;var i=r(52);(o.prototype=Object.create(i.prototype)).constructor=o;var n=r(7);function o(e){i.call(this,e)}n.Buffer&&(o.prototype._slice=n.Buffer.prototype.slice),o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))}},function(e,t,r){"use strict";t.Service=r(136)},function(e,t,r){"use strict";e.exports=n;var i=r(7);function n(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");i.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(n.prototype=Object.create(i.EventEmitter.prototype)).constructor=n,n.prototype.rpcCall=function e(t,r,n,o,s){if(!o)throw TypeError("request must be specified");var a=this;if(!s)return i.asPromise(e,a,t,r,n,o);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,r){if(e)return a.emit("error",e,t),s(e);if(null!==r){if(!(r instanceof n))try{r=n[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),s(e)}return a.emit("data",r,t),s(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},n.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(e,t,r){"use strict";e.exports={}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2),n=r(48),o=r(139),s=r(1),a=r(49),u=r(0),l=r(3),c=r(28),h=r(22),d=r(45),p=r(140),f=s.LoggerManager.instance.create("OmvDecodedTileEmitter"),m=new u.Vector3,g=new u.Vector3,y=new u.Vector3,v=new u.Vector3,x=new u.Vector3,b=new u.Vector2,w=new u.Vector2,T=new u.Vector3,_=new u.Vector2,S=new u.Vector2,E=new u.Vector2,M=1e-18,P=5,A=.5,L=Math.PI/8,I=-1;class O{constructor(e){this.type=e,this.positions=[],this.normals=[],this.textureCoordinates=[],this.colors=[],this.extrusionAxis=[],this.indices=[],this.edgeIndices=[],this.groups=[],this.texts=[],this.pathLengths=[],this.stringCatalog=[],this.imageTextures=[],this.featureIds=[],this.featureStarts=[],this.objInfos=[]}addText(e){let t=this.stringCatalog.indexOf(e);return t<0&&(t=this.stringCatalog.length,this.stringCatalog.push(e)),t}}var q;!function(e){e[e.Simple=0]="Simple",e[e.Complex=1]="Complex"}(q=t.LineType||(t.LineType={}));const C=new u.Color;t.OmvDecodedTileEmitter=class{constructor(e,t,r,i,n,o){this.m_decodeInfo=e,this.m_styleSetEvaluator=t,this.m_gatherFeatureIds=r,this.m_skipShortLabels=i,this.m_enableElevationOverlay=n,this.m_languages=o,this.m_meshBuffers=new Map,this.m_geometries=[],this.m_textGeometries=[],this.m_textPathGeometries=[],this.m_pathGeometries=[],this.m_poiGeometries=[],this.m_simpleLines=[],this.m_solidLines=[],this.m_dashedLines=[],this.m_sources=[],this.m_maxGeometryHeight=0}get projection(){return this.m_decodeInfo.targetProjection}get center(){return this.m_decodeInfo.center}processPointFeature(e,t,r,n,o,s){const a=n.env;this.processFeatureCommon(a);for(const e of o){if(void 0===e)continue;const o=e._index,u=this.findOrCreateMeshBuffers(o,i.GeometryType.Point);if(void 0===u)continue;const{positions:l,texts:c,featureIds:p,imageTextures:f,objInfos:m}=u,g=i.isTextTechnique(e)||i.isPoiTechnique(e);let y;const v=i.isPoiTechnique(e);if(v){const t=e;if(y=d.evaluateTechniqueAttr(n,t.imageTexture),void 0!==t.poiName)y=d.evaluateTechniqueAttr(n,t.poiName);else if("string"==typeof t.poiNameField){y=a.lookup(t.poiNameField)}else if("string"==typeof t.imageTextureField){const e=a.lookup(t.imageTextureField);y=i.composeTechniqueTextureName(e,t)}}for(const o of r){if(g){const t=e,r=i.ExtendedTileInfo.getFeatureText(n,t,this.m_languages);void 0!==r&&r.length>0?c.push(u.addText(r)):c.push(I)}h.webMercatorTile2TargetWorld(t,this.m_decodeInfo,o,T),l.push(T.x,T.y,T.z),this.m_gatherFeatureIds&&(p.push(s),m.push(a.entries)),v&&(void 0===y?f.push(I):f.push(u.addText(y)))}}}processLineFeature(e,t,r,n,a,l){const c=n.env;this.processFeatureCommon(c);const p=[],m=[],{projectedTileBounds:g}=this.m_decodeInfo,y=g.max.x-g.min.x,v=g.max.y-g.min.y,x=Math.max(y,v);let b,w;for(const e of a)if(void 0!==e)if(b){const t=this.getTextureCoordinateType(e);s.assert(void 0===t||w===t)}else b=this.getComputeTexCoordsFunc(e),w=this.getTextureCoordinateType(e);for(const e of r){const r=[],i=[];e.positions.forEach(e=>{if(h.webMercatorTile2TargetWorld(t,this.m_decodeInfo,e,T),r.push(T.x,T.y,T.z),b){const{u:r,v:n}=b(e,t);i.push(r,n)}}),p.push(r),m.push(i)}const _=this.m_decodeInfo.tileKey.level>=11;for(const e of a){if(void 0===e)continue;const t=e._index,r=e.name;if(i.isLineTechnique(e)||i.isSolidLineTechnique(e)||i.isDashedLineTechnique(e)){const r=i.isLineTechnique(e)?this.m_simpleLines:i.isSolidLineTechnique(e)?this.m_solidLines:this.m_dashedLines,o=i.isLineTechnique(e)?q.Simple:q.Complex;this.applyLineTechnique(r,e,t,this.m_gatherFeatureIds,o,l,p,n,this.getTextureCoordinateType(e)?m:void 0)}else if(i.isTextTechnique(e)||i.isPoiTechnique(e)||i.isLineMarkerTechnique(e)){const r=e,o=i.ExtendedTileInfo.getFeatureText(n,r,this.m_languages);if(void 0===o||0===o.length)continue;let a=[];if(this.m_skipShortLabels){const e=x/this.m_decodeInfo.tileSizeOnScreen,t=P*o.length*e*A,r=t*t;a=this.splitJaggyLines(p,r,L)}else a=p;if(0===a.length)continue;if(i.isTextTechnique(e)){if(void 0===o)continue;for(const e of a){const r=s.Math2D.computeSquaredLineLength(e);this.m_textPathGeometries.push({technique:t,path:e,pathLengthSqr:r,text:String(o),featureId:l,objInfos:this.m_gatherFeatureIds?c.entries:void 0})}}else{const r=e;let i=d.evaluateTechniqueAttr(n,r.imageTexture);if("string"==typeof r.imageTextureField){i=c.lookup(r.imageTextureField),"string"==typeof r.imageTexturePrefix&&(i=r.imageTexturePrefix+i),"string"==typeof r.imageTexturePostfix&&(i+=r.imageTexturePostfix)}for(const e of a)this.m_poiGeometries.push({technique:t,positions:{name:"position",type:"float",buffer:new Float32Array(e).buffer,itemCount:3},texts:[0],stringCatalog:[o,i],imageTextures:[1],featureId:l,objInfos:this.m_gatherFeatureIds?[c.entries]:void 0})}}else if(i.isLabelRejectionLineTechnique(e)){const e=new u.Vector3;for(const t of p){const r=[];for(let i=0;i<t.length;i+=3)e.set(t[i],t[i+1],t[i+2]),e.add(this.m_decodeInfo.center),r.push(e.clone());this.m_pathGeometries.push({path:r})}}else if(i.isExtrudedLineTechnique(e)){const r=this.findOrCreateMeshBuffers(t,i.GeometryType.ExtrudedLine);if(void 0===r)continue;const{positions:s,indices:a,groups:u,featureIds:h,featureStarts:f,objInfos:m}=r,g=a.length,y=d.evaluateTechniqueAttr(n,e.lineWidth);if(void 0===y)continue;const v=d.evaluateTechniqueAttr(n,e.caps,"Circle"),x=_&&"Circle"===v;p.forEach(e=>{o.triangulateLine(e,y,s,a,x),this.m_gatherFeatureIds&&(h.push(l),f.push(g),m.push(c.entries))});const b=a.length-g;u.push({start:g,count:b,technique:t,featureId:l})}else f.warn(`OmvDecodedTileEmitter#processLineFeature: Invalid line technique\n                     ${r} for layer: ${c.entries.$layer} `)}}processPolygonFeature(e,t,r,n,o,s){const a=n.env;this.processFeatureCommon(a),o.forEach(e=>{if(void 0===e)return;const o=e._index;if(void 0===o)throw new Error("OmvDecodedTileEmitter#processPolygonFeature: Internal error - No technique index");const a=[],u=i.isExtrudedPolygonTechnique(e),l=i.isFillTechnique(e),d=u||l||i.isStandardTechnique(e),p=this.getComputeTexCoordsFunc(e),f=void 0!==p?4:2;for(const e of r){const r=[];for(const i of e.rings){const e=[];for(const r of i)if(e.push(r.x,r.y),void 0!==p){const{u:i,v:n}=p(r,t);e.push(i,n)}r.push(new c.Ring(t,f,e))}a.push(r)}const m=i.isSolidLineTechnique(e)||i.isDashedLineTechnique(e)||i.isLineTechnique(e);if(d)this.applyPolygonTechnique(a,e,o,s,n,t);else if(m){const r="line"===e.name?this.m_simpleLines:"solid-line"===e.name?this.m_solidLines:this.m_dashedLines,i="line"===e.name?q.Simple:q.Complex;a.forEach(a=>{const u=[];a.forEach(e=>{const r=e.contour.length/e.vertexStride;let i=[];for(let n=0;n<r;++n){const o=(n+1)%r,s=e.contour[n*e.vertexStride],a=e.contour[n*e.vertexStride+1],l=e.contour[o*e.vertexStride],c=e.contour[o*e.vertexStride+1],d=!(s<=0&&l<=0||s>=e.extents&&l>=e.extents||a<=0&&c<=0||a>=e.extents&&c>=e.extents);d||0===i.length?d&&0===i.length&&(h.webMercatorTile2TargetWorld(t,this.m_decodeInfo,b.set(s,a),T),i.push(T.x,T.y,T.z)):(u.push(i),i=[]),d&&(h.webMercatorTile2TargetWorld(t,this.m_decodeInfo,b.set(l,c),T),i.push(T.x,T.y,T.z))}i.length&&u.push(i)}),0!==u.length&&this.applyLineTechnique(r,e,o,this.m_gatherFeatureIds,i,s,u,n)})}})}getDecodedTile(){this.createGeometries(),this.processSimpleLines(this.m_simpleLines),this.processLines(this.m_solidLines),this.processLines(this.m_dashedLines);const e={techniques:this.m_styleSetEvaluator.decodedTechniques,geometries:this.m_geometries,decodeTime:void 0};return this.m_textGeometries.length>0&&(e.textGeometries=this.m_textGeometries),this.m_poiGeometries.length>0&&(e.poiGeometries=this.m_poiGeometries),this.m_textPathGeometries.length>0&&(e.textPathGeometries=this.m_textPathGeometries),this.m_pathGeometries.length>0&&(e.pathGeometries=this.m_pathGeometries),0!==this.m_sources.length&&(e.copyrightHolderIds=this.m_sources),e.maxGeometryHeight=this.m_maxGeometryHeight,e}splitJaggyLines(e,t,r){const i=[],n=(e,t,r)=>{let i=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(let a=t;a<r;a+=3){const t=e[a],r=e[a+1];t<i&&(i=t),t>n&&(n=t),r<o&&(o=r),r>s&&(s=r)}return(n-i)*(n-i)+(s-o)*(s-o)},o=e.slice();for(;o.length>0;){const e=o.pop();if(void 0===e||e.length<6)continue;let s=-1;for(let t=0;t<e.length-3;t+=3){_.set(e[t],e[t+1]),S.set(e[t+3],e[t+4]);const i=S.sub(_).normalize();if(t>0){const e=Math.atan2(E.x*i.y-i.x*E.y,i.dot(E));if(Math.abs(e)>r){s=t;break}}E.set(i.x,i.y)}if(s>0){const r=n(e,0,s+3),a=n(e,s,e.length);r>t&&i.push(e.slice(0,s+3)),a>t&&o.push(e.slice(s))}else{n(e,0,e.length)>t&&i.push(e)}}return i}getTextureCoordinateType(e){return(i.isFillTechnique(e)||i.isSolidLineTechnique(e)||i.isDashedLineTechnique(e)||i.isExtrudedPolygonTechnique(e))&&this.m_enableElevationOverlay?i.TextureCoordinateType.TileSpace:i.textureCoordinateType(e)}getComputeTexCoordsFunc(e){const t=this.getTextureCoordinateType(e);return t===i.TextureCoordinateType.TileSpace?(e,t)=>{const{x:r,y:i}=(new u.Vector2).copy(e).divideScalar(t);return{u:r,v:1-i}}:t===i.TextureCoordinateType.EquirectangularSpace?(e,t)=>{const r=h.tile2world(t,this.m_decodeInfo,e,!1,w),{x:i,y:n}=l.normalizedEquirectangularProjection.reprojectPoint(l.webMercatorProjection,new u.Vector3(r.x,r.y,0));return{u:i,v:n}}:void 0}applyLineTechnique(e,t,r,o,s=q.Complex,a,u,l,c){const h=d.evaluateTechniqueAttr(l,t.renderOrderOffset,0);let p;const f=e.find(e=>e.technique===r&&e.renderOrderOffset===h),m=void 0!==c;if(void 0===f){p=new n.LineGroup(m,void 0,s===q.Simple);const u={type:s===q.Complex?i.GeometryType.SolidLine:i.GeometryType.Line,technique:r,renderOrderOffset:void 0!==h?Number(h):void 0,lines:p};!d.evaluateTechniqueAttr(l,t.transient,!1)&&o&&(u.featureIds=[a],u.featureStarts=[0]),e.push(u)}else p=f.lines,o&&f.featureIds&&f.featureStarts&&(f.featureIds.push(a),f.featureStarts.push(p.indices.length));let g=0;u.forEach(e=>{p.add(this.m_decodeInfo.center,e,c?c[g++]:void 0)})}applyPolygonTechnique(e,t,r,n,o,c){const _=i.isExtrudedPolygonTechnique(t),S=_?i.GeometryType.ExtrudedPolygon:i.GeometryType.Polygon,E=this.findOrCreateMeshBuffers(r,S);if(void 0===E)return;const P=t,A=t,L=!1!==P.boundaryWalls,I=i.isFillTechnique(t),O=this.getTextureCoordinateType(t);let q=d.evaluateTechniqueAttr(o,P.height),G=d.evaluateTechniqueAttr(o,P.floorHeight);if(void 0===q){const e=o.env.lookup("height"),t=d.evaluateTechniqueAttr(o,P.defaultHeight);q=void 0!==e?e:void 0!==t?t:0}if(void 0===G){const e=o.env.lookup("min_height");G=void 0===e||I?0:e}q===G&&(q+=M);const R=s.getOptionValue(P.constantHeight,!1);this.m_decodeInfo.tileBounds.getCenter(m);const{positions:j,normals:F,textureCoordinates:z,colors:k,extrusionAxis:N,indices:B,edgeIndices:V,groups:D}=E,U=void 0!==O?4:2,W=U+2,$=this.m_decodeInfo.targetProjection.type===l.ProjectionType.Spherical,K=(_?P.lineWidth||0:I&&A.lineWidth||0)>0;let H;if(i.isExtrudedPolygonTechnique(t)&&s.getOptionValue(t.vertexColors,!1)){let e=d.evaluateTechniqueAttr(o,t.color);if(void 0===e){const t=o.env.lookup("color");this.isColorStringValid(t)&&(e=String(t))}void 0===e&&(e=d.evaluateTechniqueAttr(o,t.defaultColor,0)),void 0===e&&(e=0),C.set(e),H=C}for(const t of e){const e=B.length;for(let e=0;e<t.length;){const r=[],i=j.length/3,{contour:n,winding:o}=t[e++];for(let e=0;e<n.length/U;++e){for(let t=0;t<U;++t)r.push((1===t?-1:1)*n[e*U+t]);const t=(e+1)%(n.length/U),i=n[e*U],o=n[e*U+1],s=n[t*U],a=n[t*U+1],u=!(i<=0&&s<=0||i>=c&&s>=c||o<=0&&a<=0||o>=c&&a>=c);r.push(u?t:-1,L||u?t:-1)}const s=[];for(;e<t.length&&t[e].winding!==o;){const i=r.length/W;s.push(i);const n=t[e++].contour;for(let e=0;e<n.length/U;++e){for(let t=0;t<U;++t)r.push((1===t?-1:1)*n[e*U+t]);const t=(e+1)%(n.length/U),o=n[e*U],s=n[e*U+1],a=n[t*U],u=n[t*U+1],l=!(o<=0&&a<=0||o>=c&&a>=c||s<=0&&u<=0||s>=c&&u>=c);r.push(l?i+t:-1,L||l?i+t:-1)}}try{const e=a.default(r,s,W),t=r.length/W;if($){const t=new u.BufferGeometry,i=[],n=[],o=[],s=[];for(let e=0;e<r.length;e+=W){const t=h.tile2world(c,this.m_decodeInfo,b.set(r[e],r[e+1]),!0,w);i.push(t.x,t.y,0),void 0!==O&&n.push(r[e+2],r[e+3]),o.push(r[e+U]),s.push(r[e+U+1])}const a=new u.BufferAttribute(new Float32Array(i),3);let d;t.setAttribute("position",a),void 0!==O&&(d=new u.BufferAttribute(new Float32Array(n),2),t.setAttribute("uv",d));const f=new u.BufferAttribute(new Float32Array(o),1);t.setAttribute("edge",f);const m=new u.BufferAttribute(new Float32Array(s),1);t.setAttribute("wall",f);const g=new u.BufferAttribute(new Uint32Array(e),1);t.setIndex(g),new p.SphericalGeometrySubdivisionModifier(u.Math.degToRad(10),l.webMercatorProjection).modify(t),r.length=0,e.length=0;for(let e=0;e<a.array.length;e+=3){const t=h.world2tile(c,this.m_decodeInfo,b.set(a.array[e],a.array[e+1]),!0,w);r.push(t.x,t.y),void 0!==O&&(r.push(d.array[e/3*2]),r.push(d.array[e/3*2+1])),r.push(f.array[e/3]),r.push(m.array[e/3])}e.push(...t.getIndex().array)}y.set(0,0,1);for(let e=0;e<r.length;e+=W){h.webMercatorTile2TargetWorld(c,this.m_decodeInfo,b.set(r[e],r[e+1]),T,!0);let t=1;_&&!0!==R&&(g.set(m.x+T.x,m.y+T.y,m.z+T.z),t=this.m_decodeInfo.targetProjection.getScaleFactor(g)),this.m_maxGeometryHeight=Math.max(this.m_maxGeometryHeight,t*q),$&&y.set(T.x,T.y,T.z).add(this.center).normalize(),v.copy(y).multiplyScalar(G*t),x.copy(y).multiplyScalar(q*t),j.push(T.x+v.x,T.y+v.y,T.z+v.z),void 0!==O&&z.push(r[e+2],r[e+3]),this.m_enableElevationOverlay&&F.push(...y.toArray()),_&&(j.push(T.x+x.x,T.y+x.y,T.z+x.z),N.push(x.x-v.x,x.y-v.y,x.z-v.z,0,x.x-v.x,x.y-v.y,x.z-v.z,1),void 0!==O&&z.push(r[e+2],r[e+3]),this.m_enableElevationOverlay&&F.push(...y.toArray()),void 0!==H&&k.push(H.r,H.g,H.b,H.r,H.g,H.b))}for(let t=0;t<e.length;t+=3)if(_){const r=i+2*e[t+0]+1,n=i+2*e[t+1]+1,o=i+2*e[t+2]+1;B.push(r,n,o)}else{const r=i+e[t+0],n=i+e[t+1],o=i+e[t+2];B.push(r,n,o)}K&&this.addEdges(i,t,W,U,j,r,V,_,P.footprint,P.maxSlope),_&&this.addWalls(i,t,W,U,r,B)}catch(e){f.error("cannot triangulate geometry",e)}}this.m_gatherFeatureIds&&(E.objInfos.push(o.env.entries),E.featureIds.push(n),E.featureStarts.push(e));const i=B.length-e;i>0&&D.push({start:e,count:i,technique:r,featureId:n})}}createGeometries(){this.m_meshBuffers.forEach((e,t)=>{if(0===e.positions.length)return;if(!this.m_styleSetEvaluator.techniques||this.m_styleSetEvaluator.techniques.length<=t)throw new Error("Invalid technique index");const r=this.m_styleSetEvaluator.techniques[t];if(void 0===r)return;const n=new Float32Array(e.positions);if(e.texts.length>0&&i.isTextTechnique(r))return void this.m_textGeometries.push({positions:{name:"position",type:"float",buffer:n.buffer,itemCount:3},texts:e.texts,technique:t,featureId:e.featureIds?e.featureIds[0]:void 0,stringCatalog:e.stringCatalog,objInfos:this.m_gatherFeatureIds?e.objInfos:void 0});if(e.texts.length>0&&i.isPoiTechnique(r))return void this.m_poiGeometries.push({positions:{name:"position",type:"float",buffer:n.buffer,itemCount:3},texts:e.texts,technique:t,featureId:e.featureIds?e.featureIds[0]:void 0,stringCatalog:e.stringCatalog,imageTextures:e.imageTextures,objInfos:e.objInfos});0===e.groups.length&&e.groups.push({start:0,count:n.length/3,technique:t});const o={type:e.type,vertexAttributes:[{name:"position",buffer:n.buffer,itemCount:3,type:"float"}],groups:e.groups};if(e.normals.length>0){const t=new Float32Array(e.normals);s.assert(t.length===n.length,"length of normals buffer is different than the length of the position buffer"),o.vertexAttributes.push({name:"normal",buffer:t.buffer,itemCount:3,type:"float"})}if(e.colors.length>0){const t=new Float32Array(e.colors);s.assert(t.length===n.length,"length of colors buffer is different than the length of the position buffer"),o.vertexAttributes.push({name:"color",buffer:t.buffer,itemCount:3,type:"float"})}if(e.textureCoordinates.length>0){const t=e.positions.length/3,r=e.textureCoordinates.length/2;s.assert(r===t,"length of textureCoordinates buffer is different than the length of theposition buffer");const i=new Float32Array(e.textureCoordinates);o.vertexAttributes.push({name:"uv",buffer:i.buffer,itemCount:2,type:"float"})}if(e.extrusionAxis.length>0){const t=new Float32Array(e.extrusionAxis);s.assert(t.length/4==n.length/3,"length of extrusionAxis buffer is different than the length of the position buffer"),o.vertexAttributes.push({name:"extrusionAxis",buffer:t.buffer,itemCount:4,type:"float"})}e.indices.length>0&&(o.index={name:"index",buffer:new Uint32Array(e.indices).buffer,itemCount:1,type:"uint32"}),e.edgeIndices.length>0&&(o.edgeIndex={name:"edgeIndex",buffer:new Uint32Array(e.edgeIndices).buffer,itemCount:1,type:"uint32"}),this.m_gatherFeatureIds&&(o.featureIds=e.featureIds,o.featureStarts=e.featureStarts,o.objInfos=e.objInfos),this.m_geometries.push(o)})}processLines(e){e.forEach(e=>{const{vertices:t,indices:r}=e.lines,n=e.renderOrderOffset,o=e.technique,s=new Float32Array(t).buffer,a=new Uint32Array(r).buffer,u={type:"float",stride:e.lines.stride,buffer:s,attributes:e.lines.vertexAttributes},l={type:i.GeometryType.SolidLine,index:{buffer:a,itemCount:1,type:"uint32",name:"index"},interleavedVertexAttributes:[u],groups:[{start:0,count:r.length,technique:o,renderOrderOffset:n}],vertexAttributes:[]};this.m_gatherFeatureIds&&(l.featureIds=e.featureIds,l.featureStarts=e.featureStarts),this.m_geometries.push(l)})}processSimpleLines(e){e.forEach(e=>{const{vertices:t,indices:r}=e.lines,n=e.renderOrderOffset,o=e.technique,s=new Float32Array(t).buffer,a=new Uint32Array(r).buffer,u={buffer:s,itemCount:3,type:"float",name:"position"},l={type:i.GeometryType.Line,index:{buffer:a,itemCount:1,type:"uint32",name:"index"},vertexAttributes:[u],groups:[{start:0,count:r.length,technique:o,renderOrderOffset:n}]};this.m_gatherFeatureIds&&(l.featureIds=e.featureIds,l.featureStarts=e.featureStarts),this.m_geometries.push(l)})}findOrCreateMeshBuffers(e,t){let r=this.m_meshBuffers.get(e);return void 0!==r?r.type!==t?void f.error(`MeshBuffer has been created with wrong type "${i.GeometryType[t]}"\n                instead of "${i.GeometryType[r.type]}"`):r:(r=new O(t),this.m_meshBuffers.set(e,r),r)}processFeatureCommon(e){const t=e.lookup("source");"string"==typeof t&&""!==t&&(this.m_sources.includes(t)||this.m_sources.push(t))}isColorStringValid(e){return"string"==typeof e&&e.length>0}addEdges(e,t,r,i,n,o,s,a,l,c){const h=new u.Vector3,d=new u.Vector3;let p,f,m=0,g=0;for(;m<t;){for(;m!==p;){void 0===p&&(p=m),m<t&&(g=Math.max(g,m));const u=o[m*r+i];if(u<0)break;if(a)if(!0===l&&s.push(e+2*m,e+2*u),s.push(e+2*m+1,e+2*u+1),void 0!==c){if(void 0!==f){const t=3*(e+2*f),r=3*(e+2*m),i=3*(e+2*u);h.set(n[r]-n[t],n[r+1]-n[t+1],n[r+2]-n[t+2]).normalize(),d.set(n[i]-n[r],n[i+1]-n[r+1],n[i+2]-n[r+2]).normalize(),h.dot(d)<=c&&s.push(e+2*m,e+2*m+1)}}else s.push(e+2*m,e+2*m+1);else s.push(e+m,e+u);f=m,m=u}m=g+1,p=void 0,f=void 0}}addWalls(e,t,r,i,n,o){let s,a=0,u=0;for(;a<t;){for(;a!==s;){void 0===s&&(s=a),a<t&&(u=Math.max(u,a));const l=n[a*r+i+1];if(l<0)break;o.push(e+2*a,e+2*a+1,e+2*l+1,e+2*l+1,e+2*l,e+2*a),a=l}a=u+1,s=void 0}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),n=new i.Vector3(0,0,1),o=[0,1,2,1,3,2],s=[0,1,3,3,1,2,0,3,4,5,4,3],a=8,u=Math.PI/a;function l(e,t,r,i,n,o){const s=n.length/3;n.push(e,t,0);for(let l=0;l<a+1;++l){const c=u*l+Math.PI/2+r;n.push(e+i*Math.cos(c),t+i*Math.sin(c),0),o.push(s,s+l+1,s+(l+1)%(a+1)+1)}}t.numCirclePoints=function(e){return a+1},t.triangulateLine=function(e,t,r,a,u=!0,c=u){if(e.length<3)return;const h=new i.Vector2;if(u){const i=3!==e.length?h.set(e[3]-e[0],e[4]-e[1]).angle():0;l(e[0],e[1],i,t,r,a)}const d=r.length/3,p=new i.Vector3,f=new i.Vector3,m=new i.Vector3,g=new i.Vector3,y=new i.Vector3,v=new i.Vector3,x=new i.Vector3,b=new i.Vector3,w=new i.Vector3,T=e.length/3;let _=0;for(let i=0;i<T;++i){let u=!1;if(f.set(e[3*i],e[3*i+1],e[3*i+2]),i+1<T){if(m.set(e[3*(i+1)],e[3*(i+1)+1],e[3*(i+1)+2]),g.copy(m).sub(f).normalize().cross(n),y.copy(g),i>0&&(y.add(p).multiplyScalar(1-.5*g.dot(p)),u=p.angleTo(g)>Math.PI/2)){const e=t/Math.cos(g.angleTo(p)/2);v.copy(g).add(p).normalize().multiplyScalar(-e).add(f),x.copy(p).multiplyScalar(t).add(f),b.copy(g).add(p).normalize().multiplyScalar(e).add(f),w.copy(g).multiplyScalar(t).add(f)}u?r.push(v.x,v.y,v.z,x.x,x.y,x.z,b.x,b.y,b.z,w.x,w.y,w.z):(v.copy(y).multiplyScalar(-t).add(f),x.copy(y).multiplyScalar(t).add(f),r.push(v.x,v.y,v.z,x.x,x.y,x.z)),p.copy(g)}else v.copy(p).multiplyScalar(-t).add(f),x.copy(p).multiplyScalar(t).add(f),r.push(v.x,v.y,v.z,x.x,x.y,x.z);i!==T-1&&((u?s:o).forEach(e=>a.push(d+_+e)),_+=u?4:2)}if(c){const i=2!==e.length?h.set(e[3*(T-3)]-e[3*(T-2)],e[3*(T-3)+1]-e[3*(T-2)+1]).angle():Math.PI;l(e[3*(T-2)],e[3*(T-2)+1],i,t,r,a)}},t.reconstructLine=function(e,t){const r=new Float32Array(e.length/2);for(let i=3*t,n=2*i;i<r.length;i+=3,n+=6)r[i]=e[n]+.5*(e[n+3]-e[n]),r[i+1]=e[n+1]+.5*(e[n+3+1]-e[n+1]),r[i+2]=e[n+2]+.5*(e[n+3+2]-e[n+2]);return r},t.reconstructLineWidth=function(e,t){const r=e[2*t+3]-e[2*t],i=e[2*t+3+1]-e[2*t+1],n=e[2*t+3+2]-e[2*t+2];return.5*Math.sqrt(r*r+i*i+n*n)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(3),n=r(0),o=r(141),s=[new n.Vector3,new n.Vector3,new n.Vector3];t.SphericalGeometrySubdivisionModifier=class extends o.SubdivisionModifier{constructor(e,t=i.sphereProjection){super(),this.angle=e,this.projection=t}shouldSplitTriangle(e,t,r){const n=i.sphereProjection.reprojectPoint(this.projection,e,s[0]),o=i.sphereProjection.reprojectPoint(this.projection,t,s[1]),a=i.sphereProjection.reprojectPoint(this.projection,r,s[2]),u=n.angleTo(o),l=o.angleTo(a),c=a.angleTo(n),h=Math.max(u,Math.max(l,c));if(!(h<this.angle)){if(h===u)return 0;if(h===l)return 1;if(h===c)return 2;throw new Error("failed to split triangle")}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),n=new i.Vector3,o=new i.Vector3,s=new i.Vector3;t.SubdivisionModifier=class{constructor(){}modify(e){const t=e.getAttribute("position"),r=Array.from(t.array),i=e.getAttribute("uv"),a=void 0!==i?Array.from(i.array):void 0,u=e.getAttribute("edge"),l=void 0!==u?Array.from(u.array):void 0,c=e.getAttribute("wall"),h=void 0!==c?Array.from(c.array):void 0,d=e.getIndex(),p=Array.from(d.array),f=new Map;function m(e,t){const i=`${Math.min(e,t)}_${Math.max(e,t)}`,u=f.get(i);if(void 0!==u)return u;n.set(r[3*e],r[3*e+1],r[3*e+2]),o.set(r[3*t],r[3*t+1],r[3*t+2]),s.lerpVectors(n,o,.5);const c=r.length/3;return r.push(...s.toArray()),f.set(i,c),void 0!==a&&(n.set(a[2*e],a[2*e+1],0),o.set(a[2*t],a[2*t+1],0),s.lerpVectors(n,o,.5),a.push(s.x,s.y)),void 0!==l&&(l[e]===t?(l.push(t),l[e]=c):l[t]===e?(l.push(e),l[t]=c):l.push(-1)),void 0!==h&&(h[e]===t?(h.push(t),h[e]=c):h[t]===e?(h.push(e),h[t]=c):h.push(-1)),c}const g=[];for(;p.length>=3;){const e=p.shift(),t=p.shift(),i=p.shift();switch(n.set(r[3*e],r[3*e+1],r[3*e+2]),o.set(r[3*t],r[3*t+1],r[3*t+2]),s.set(r[3*i],r[3*i+1],r[3*i+2]),this.shouldSplitTriangle(n,o,s)){case 0:{const r=m(e,t);p.push(e,r,i,r,t,i);break}case 1:{const r=m(t,i);p.push(e,t,r,e,r,i);break}case 2:{const r=m(i,e);p.push(e,t,r,r,t,i);break}case void 0:g.push(e,t,i);break;default:throw new Error("failed to subdivide the given geometry")}}return t.array=new Float32Array(r),t.count=r.length/t.itemSize,t.needsUpdate=!0,e.setIndex(g),void 0!==a&&(i.array=new Float32Array(a),i.count=a.length/i.itemSize,i.needsUpdate=!0),void 0!==l&&(u.array=new Float32Array(l),u.count=l.length/u.itemSize,u.needsUpdate=!0),e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2),n=r(0),o=r(28),s=r(22);t.OmvTileInfoEmitter=class{constructor(e,t,r,n,o){this.m_decodeInfo=e,this.m_styleSetEvaluator=t,this.m_storeExtendedTags=r,this.m_gatherRoadSegments=n,this.m_languages=o,this.m_tileInfo=new i.ExtendedTileInfo(e.tileKey,this.m_storeExtendedTags),this.m_tileInfoWriter=new i.ExtendedTileInfoWriter(this.m_tileInfo,this.m_storeExtendedTags)}processPointFeature(e,t,r,o,a,u){const l=this.m_tileInfoWriter,c=new n.Vector3;for(const e of a){if(void 0===e)continue;const n=l.addTechnique(e),a=i.ExtendedTileInfo.getFeatureText(o,e,this.m_languages);for(const e of r)s.webMercatorTile2TargetWorld(t,this.m_decodeInfo,e,c),l.addFeature(this.m_tileInfo.pointGroup,o.env,u,a,n,i.FeatureGroupType.Point),l.addFeaturePoint(this.m_tileInfo.pointGroup,c.x,c.y)}}processLineFeature(e,t,r,o,a,u){const l=this.m_tileInfoWriter,c=o.env,h=new n.Vector3,d=[];for(const e of r){const r=[];for(const i of e.positions)s.webMercatorTile2TargetWorld(t,this.m_decodeInfo,i,h),r.push(h.x,h.y);d.push(r)}for(const e of a){if(void 0===e)continue;const t=l.addTechnique(e),r=i.ExtendedTileInfo.getFeatureText(o,e,this.m_languages);for(const e of d)l.addFeature(this.m_tileInfo.lineGroup,c,u,r,t,i.FeatureGroupType.Line),l.addFeaturePoints(this.m_tileInfo.lineGroup,e)}if(this.m_gatherRoadSegments){const e=c.lookup("segmentId");if(void 0!==e){const t=c.lookup("startOffset"),r=c.lookup("endOffset");l.addRoadSegments(this.m_tileInfo.lineGroup,e,void 0!==t?t:0,void 0!==r?r:1)}}}processPolygonFeature(e,t,r,a,u,l){if(0===u.length)throw new Error("OmvTileInfoEmitter#processPolygonFeature: Internal error - No technique index");const c=this.m_tileInfoWriter,h=new n.Vector3,d=[];for(const e of r){const r=[];for(const i of e.rings){const e=[];for(const r of i)s.webMercatorTile2TargetWorld(t,this.m_decodeInfo,r,h),e.push(h.x,h.y,h.z);r.push(new o.Ring(t,3,e))}d.push(r)}for(const e of u){if(void 0===e)continue;const t=c.addTechnique(e),r=i.ExtendedTileInfo.getFeatureText(a,e,this.m_languages);c.addFeature(this.m_tileInfo.polygonGroup,a.env,l,r,t,i.FeatureGroupType.Polygon)}for(const e of d){if(0===e.length)continue;const t=e[0].winding;for(const r of e)c.addRingPoints(this.m_tileInfo.polygonGroup,r.contour,r.winding===t)}}getTileInfo(){return this.m_tileInfoWriter.finish(),this.m_tileInfo}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),n=r(53),o=i.LoggerManager.instance.create("OmvTomTomFeatureModifier"),s="#AAAAAA",a="true",u="2",l="20";t.OmvTomTomFeatureModifier=class extends n.OmvGenericFeatureModifier{constructor(e){super(e)}doProcessFeature(e,t,r,i,n){return this.rewriteEnvironment(r,i),super.doProcessFeature(e,t,r,i,n)}rewriteEnvironment(e,t){this.isWood(e)?this.updateEnvironment(t,"landuse","wood"):this.isHospital(e)?this.updateEnvironment(t,"landuse","hospital"):this.isCemetery(e)?this.updateEnvironment(t,"landuse","cemetery"):this.isIndustrial(e)?this.updateEnvironment(t,"landuse","industrial"):this.isPark(e)?this.updateEnvironment(t,"landuse","park"):this.isBuiltup(e)?this.updateEnvironment(t,"landuse","builtup"):this.isWater(e)?this.updateEnvironment(t,"water"):this.isRoadLabel(e)?this.updateEnvironment(t,"road_label"):this.isRoadPath(e)?this.updateEnvironment(t,"road","path"):this.isRoadStreet(e)?this.updateEnvironment(t,"road","street"):this.isRoadPrimary(e)?this.updateEnvironment(t,"road","primary"):this.isRoadSecondary(e)?this.updateEnvironment(t,"road","secondary"):this.isRailway(e)?this.updateEnvironment(t,"road","major_rail"):this.isFerry(e)?this.updateEnvironment(t,"road","ferry"):this.isAeroway(e)?this.updateEnvironment(t,"aeroway"):this.isBorder(e)?this.updateEnvironment(t,"admin"):this.isCountryLabel(e)?this.updateEnvironment(t,"country_label"):this.isCountyLabel(e)?this.updateEnvironment(t,"county_label"):this.isRegionLabel(e)?this.updateEnvironment(t,"region_label"):this.isStateLabel(e)?this.updateEnvironment(t,"state_label"):this.isPlaceLabel(e)?this.updateEnvironment(t,"place_label"):this.isWaterLabel(e)?this.updateEnvironment(t,"water_label"):this.isMarineLabel(e)?this.updateEnvironment(t,"marine_label"):this.isPoiLabel(e)?this.updateEnvironment(t,"poi_label"):this.isBuilding(e)?(this.updateEnvironment(t,"building"),t.entries.color=s,t.entries.extrude=a,t.entries.min_height=u,t.entries.height=l):o.info(`Not yet rewritten layer: ##${t.entries.$layer}## `),this.isTunnel(e)&&(t.entries.structure="tunnel"),this.isBridge(e)&&(t.entries.structure="bridge")}updateEnvironment(e,t,r,i){e.entries.$layer=t,void 0!==r&&(e.entries.class=r),void 0!==i&&(e.entries.structure=i)}isWood(e){return"Woodland"===e||"Moor or heathland"===e}isHospital(e){return"Hospital"===e}isCemetery(e){return"Cemetery"===e}isIndustrial(e){return e.indexOf("Industrial")>=0||"Airport"===e}isPark(e){return"Park"===e||"City park"===e||"National park"===e||"Regional park"===e||e.indexOf("grass")>=0||e.indexOf("greens")>=0}isBuiltup(e){return"Built-up area"===e||"Town paved area"===e||"Shopping"===e||"University"===e||"Stadium"===e||e.indexOf("ground")>0}isWater(e){return"Other water"===e||"Ocean or sea"===e||"Ocean"===e||"Lake"===e||"Sea"===e||"Town swimming pool"===e||"River"===e}isRoadLabel(e){return e.indexOf("road label")>=0}isRoadPath(e){return e.indexOf("path")>0||"Parking road"===e||"Town walkway"===e||"Pedestrian road"===e||"Walkway road"===e||"Town carriageway divider"===e||"Runway"===e||"Non public road"===e}isRoadStreet(e){return e.indexOf("Minor local road")>=0||e.indexOf("minor local road")>=0||e.indexOf("Toll local road")>=0||e.indexOf("Local road")>=0}isRoadPrimary(e){return e.indexOf("Major local road")>=0||e.indexOf("Major road")>=0||e.indexOf("major road")>=0||e.indexOf("Motorway")>=0||e.indexOf("motorway")>=0||e.indexOf("International road")>=0||e.indexOf("international road")>=0}isRoadSecondary(e){return e.indexOf("connecting road")>=0||e.indexOf("Connecting road")>=0||e.indexOf("secondary road")>=0||e.indexOf("Secondary road")>=0}isRailway(e){return"Railway"===e}isFerry(e){return"Ferry road"===e}isBorder(e){return e.indexOf("border")>0}isCountryLabel(e){return"Country name"===e||"Country label"===e}isStateLabel(e){return"City"===e||e.indexOf("city")>0}isRegionLabel(e){return"Town"===e}isCountyLabel(e){return"Village"===e}isPlaceLabel(e){return"Park"===e||"Railway station"===e||"Airport POI"===e||"Town greens"===e}isWaterLabel(e){return"Ocean name"===e||"River label"===e||e.indexOf("water label")>0}isMarineLabel(e){return e.indexOf("water label")>0}isPoiLabel(e){return"National park name"===e||"Landmark label"===e||e.indexOf("label")>=0}isAeroway(e){return"Airport"===e}isBuilding(e){return e.indexOf("building")>=0}isTunnel(e){return e.indexOf("tunnel")>=0}isBridge(e){return e.indexOf("bridge")>=0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StyleSetDataFilter=class{constructor(e){this.styleSetEvaluator=e,this.hasKindFilter=!1}wantsLayer(e,t){return this.styleSetEvaluator.wantsLayer(e)}wantsPointFeature(e){return this.styleSetEvaluator.wantsFeature(e,"point")}wantsLineFeature(e){return this.styleSetEvaluator.wantsFeature(e,"line")}wantsPolygonFeature(e){return this.styleSetEvaluator.wantsFeature(e,"polygon")}wantsKind(){return!0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(27),n=r(15);t.OmvTilerService=class{static start(){i.WorkerServiceManager.getInstance().register({serviceType:n.OMV_TILER_SERVICE_TYPE,factory:e=>i.TilerService.start(e)})}}},function(e,t,r){"use strict";function i(e,t,r,i,n,o){var s=n-r,a=o-i;if(0!==s||0!==a){var u=((e-r)*s+(t-i)*a)/(s*s+a*a);u>1?(r=n,i=o):u>0&&(r+=s*u,i+=a*u)}return(s=e-r)*s+(a=t-i)*a}function n(e,t,r,i){var n={id:void 0===e?null:e,type:t,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,r=e.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)o(e,t);else if("Polygon"===r||"MultiLineString"===r)for(var i=0;i<t.length;i++)o(e,t[i]);else if("MultiPolygon"===r)for(i=0;i<t.length;i++)for(var n=0;n<t[i].length;n++)o(e,t[i][n])}(n),n}function o(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function s(e,t,r,i){if(t.geometry){var o=t.geometry.coordinates,c=t.geometry.type,h=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),d=[],p=t.id;if(r.promoteId?p=t.properties[r.promoteId]:r.generateId&&(p=i||0),"Point"===c)a(o,d);else if("MultiPoint"===c)for(var f=0;f<o.length;f++)a(o[f],d);else if("LineString"===c)u(o,d,h,!1);else if("MultiLineString"===c){if(r.lineMetrics){for(f=0;f<o.length;f++)d=[],u(o[f],d,h,!1),e.push(n(p,"LineString",d,t.properties));return}l(o,d,h,!1)}else if("Polygon"===c)l(o,d,h,!0);else{if("MultiPolygon"!==c){if("GeometryCollection"===c){for(f=0;f<t.geometry.geometries.length;f++)s(e,{id:p,geometry:t.geometry.geometries[f],properties:t.properties},r,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(f=0;f<o.length;f++){var m=[];l(o[f],m,h,!0),d.push(m)}}e.push(n(p,c,d,t.properties))}}function a(e,t){t.push(c(e[0])),t.push(h(e[1])),t.push(0)}function u(e,t,r,n){for(var o,s,a=0,u=0;u<e.length;u++){var l=c(e[u][0]),d=h(e[u][1]);t.push(l),t.push(d),t.push(0),u>0&&(a+=n?(o*d-l*s)/2:Math.sqrt(Math.pow(l-o,2)+Math.pow(d-s,2))),o=l,s=d}var p=t.length-3;t[2]=1,function e(t,r,n,o){for(var s,a=o,u=n-r>>1,l=n-r,c=t[r],h=t[r+1],d=t[n],p=t[n+1],f=r+3;f<n;f+=3){var m=i(t[f],t[f+1],c,h,d,p);if(m>a)s=f,a=m;else if(m===a){var g=Math.abs(f-u);g<l&&(s=f,l=g)}}a>o&&(s-r>3&&e(t,r,s,o),t[s+2]=a,n-s>3&&e(t,s,n,o))}(t,0,p,r),t[p+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function l(e,t,r,i){for(var n=0;n<e.length;n++){var o=[];u(e[n],o,r,i),t.push(o)}}function c(e){return e/360+.5}function h(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function d(e,t,r,i,o,s,a,u){if(i/=t,s>=(r/=t)&&a<i)return e;if(a<r||s>=i)return null;for(var l=[],c=0;c<e.length;c++){var h=e[c],d=h.geometry,m=h.type,y=0===o?h.minX:h.minY,v=0===o?h.maxX:h.maxY;if(y>=r&&v<i)l.push(h);else if(!(v<r||y>=i)){var x=[];if("Point"===m||"MultiPoint"===m)p(d,x,r,i,o);else if("LineString"===m)f(d,x,r,i,o,!1,u.lineMetrics);else if("MultiLineString"===m)g(d,x,r,i,o,!1);else if("Polygon"===m)g(d,x,r,i,o,!0);else if("MultiPolygon"===m)for(var b=0;b<d.length;b++){var w=[];g(d[b],w,r,i,o,!0),w.length&&x.push(w)}if(x.length){if(u.lineMetrics&&"LineString"===m){for(b=0;b<x.length;b++)l.push(n(h.id,m,x[b],h.tags));continue}"LineString"!==m&&"MultiLineString"!==m||(1===x.length?(m="LineString",x=x[0]):m="MultiLineString"),"Point"!==m&&"MultiPoint"!==m||(m=3===x.length?"Point":"MultiPoint"),l.push(n(h.id,m,x,h.tags))}}}return l.length?l:null}function p(e,t,r,i,n){for(var o=0;o<e.length;o+=3){var s=e[o+n];s>=r&&s<=i&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function f(e,t,r,i,n,o,s){for(var a,u,l=m(e),c=0===n?v:x,h=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],g=e[d+2],b=e[d+3],w=e[d+4],T=0===n?p:f,_=0===n?b:w,S=!1;s&&(a=Math.sqrt(Math.pow(p-b,2)+Math.pow(f-w,2))),T<r?_>r&&(u=c(l,p,f,b,w,r),s&&(l.start=h+a*u)):T>i?_<i&&(u=c(l,p,f,b,w,i),s&&(l.start=h+a*u)):y(l,p,f,g),_<r&&T>=r&&(u=c(l,p,f,b,w,r),S=!0),_>i&&T<=i&&(u=c(l,p,f,b,w,i),S=!0),!o&&S&&(s&&(l.end=h+a*u),t.push(l),l=m(e)),s&&(h+=a)}var E=e.length-3;p=e[E],f=e[E+1],g=e[E+2],(T=0===n?p:f)>=r&&T<=i&&y(l,p,f,g),E=l.length-3,o&&E>=3&&(l[E]!==l[0]||l[E+1]!==l[1])&&y(l,l[0],l[1],l[2]),l.length&&t.push(l)}function m(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function g(e,t,r,i,n,o){for(var s=0;s<e.length;s++)f(e[s],t,r,i,n,o,!1)}function y(e,t,r,i){e.push(t),e.push(r),e.push(i)}function v(e,t,r,i,n,o){var s=(o-t)/(i-t);return e.push(o),e.push(r+(n-r)*s),e.push(1),s}function x(e,t,r,i,n,o){var s=(o-r)/(n-r);return e.push(t+(i-t)*s),e.push(o),e.push(1),s}function b(e,t){for(var r=[],i=0;i<e.length;i++){var o,s=e[i],a=s.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=w(s.geometry,t);else if("MultiLineString"===a||"Polygon"===a){o=[];for(var u=0;u<s.geometry.length;u++)o.push(w(s.geometry[u],t))}else if("MultiPolygon"===a)for(o=[],u=0;u<s.geometry.length;u++){for(var l=[],c=0;c<s.geometry[u].length;c++)l.push(w(s.geometry[u][c],t));o.push(l)}r.push(n(s.id,a,o,s.tags))}return r}function w(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var i=0;i<e.length;i+=3)r.push(e[i]+t,e[i+1],e[i+2]);return r}function T(e,t){if(e.transformed)return e;var r,i,n,o=1<<e.z,s=e.x,a=e.y;for(r=0;r<e.features.length;r++){var u=e.features[r],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(i=0;i<l.length;i+=2)u.geometry.push(_(l[i],l[i+1],t,o,s,a));else for(i=0;i<l.length;i++){var h=[];for(n=0;n<l[i].length;n+=2)h.push(_(l[i][n],l[i][n+1],t,o,s,a));u.geometry.push(h)}}return e.transformed=!0,e}function _(e,t,r,i,n,o){return[Math.round(r*(e*i-n)),Math.round(r*(t*i-o))]}function S(e,t,r,i,n){for(var o=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,E(s,e[a],o,n);var u=e[a].minX,l=e[a].minY,c=e[a].maxX,h=e[a].maxY;u<s.minX&&(s.minX=u),l<s.minY&&(s.minY=l),c>s.maxX&&(s.maxX=c),h>s.maxY&&(s.maxY=h)}return s}function E(e,t,r,i){var n=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<n.length;a+=3)s.push(n[a]),s.push(n[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)M(s,n,e,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<n.length;a++)M(s,n[a],e,r,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var u=0;u<n.length;u++){var l=n[u];for(a=0;a<l.length;a++)M(s,l[a],e,r,!0,0===a)}if(s.length){var c=t.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=n.start/n.size,c.mapbox_clip_end=n.end/n.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(d.id=t.id),e.features.push(d)}}function M(e,t,r,i,n,o){var s=i*i;if(i>0&&t.size<(n?s:i))r.numPoints+=t.length/3;else{for(var a=[],u=0;u<t.length;u+=3)(0===i||t[u+2]>s)&&(r.numSimplified++,a.push(t[u]),a.push(t[u+1])),r.numPoints++;n&&function(e,t){for(var r=0,i=0,n=e.length,o=n-2;i<n;o=i,i+=2)r+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(r>0===t)for(i=0,n=e.length;i<n/2;i+=2){var s=e[i],a=e[i+1];e[i]=e[n-2-i],e[i+1]=e[n-1-i],e[n-2-i]=s,e[n-1-i]=a}}(a,o),e.push(a)}}function P(e,t){return new A(e,t)}function A(e,t){var r=(t=this.options=function(e,t){for(var r in t)e[r]=t[r];return e}(Object.create(this.options),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(e,t){var r=[];if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)s(r,e.features[i],t,i);else"Feature"===e.type?s(r,e,t):s(r,{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(e,t){var r=t.buffer/t.extent,i=e,n=d(e,1,-1-r,r,0,-1,2,t),o=d(e,1,1-r,2+r,0,-1,2,t);return(n||o)&&(i=d(e,1,-r,1+r,0,-1,2,t)||[],n&&(i=b(n,1).concat(i)),o&&(i=i.concat(b(o,-1)))),i}(i,t)).length&&this.splitTile(i,0,0,0),r&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function L(e,t,r){return 32*((1<<e)*r+t)+e}r.r(t),r.d(t,"default",(function(){return P})),A.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},A.prototype.splitTile=function(e,t,r,i,n,o,s){for(var a=[e,t,r,i],u=this.options,l=u.debug;a.length;){i=a.pop(),r=a.pop(),t=a.pop(),e=a.pop();var c=1<<t,h=L(t,r,i),p=this.tiles[h];if(!p&&(l>1&&console.time("creation"),p=this.tiles[h]=S(e,t,r,i,u),this.tileCoords.push({z:t,x:r,y:i}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=e,n){if(t===u.maxZoom||t===n)continue;var m=1<<n-t;if(r!==Math.floor(o/m)||i!==Math.floor(s/m))continue}else if(t===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==e.length){l>1&&console.time("clipping");var g,y,v,x,b,w,T=.5*u.buffer/u.extent,_=.5-T,E=.5+T,M=1+T;g=y=v=x=null,b=d(e,c,r-T,r+E,0,p.minX,p.maxX,u),w=d(e,c,r+_,r+M,0,p.minX,p.maxX,u),e=null,b&&(g=d(b,c,i-T,i+E,1,p.minY,p.maxY,u),y=d(b,c,i+_,i+M,1,p.minY,p.maxY,u),b=null),w&&(v=d(w,c,i-T,i+E,1,p.minY,p.maxY,u),x=d(w,c,i+_,i+M,1,p.minY,p.maxY,u),w=null),l>1&&console.timeEnd("clipping"),a.push(g||[],t+1,2*r,2*i),a.push(y||[],t+1,2*r,2*i+1),a.push(v||[],t+1,2*r+1,2*i),a.push(x||[],t+1,2*r+1,2*i+1)}}},A.prototype.getTile=function(e,t,r){var i=this.options,n=i.extent,o=i.debug;if(e<0||e>24)return null;var s=1<<e,a=L(e,t=(t%s+s)%s,r);if(this.tiles[a])return T(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var u,l=e,c=t,h=r;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[L(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,e,t,r),o>1&&console.timeEnd("drilling down"),this.tiles[a]?T(this.tiles[a],n):null):null}}]);
//# sourceMappingURL=harp-decoders.min.js.map